{"code":"(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[3],{\"6Joi\":function(t,e,n){\"use strict\";(function(t){Object.defineProperty(e,\"__esModule\",{value:!0});var r=n(\"mrSG\"),i=n(\"wj3C\"),o=n(\"q/0M\"),s=n(\"zVF4\"),u=n(\"x7I3\"),a=n(\"S+S0\");var c=function(t){return t&&\"object\"==typeof t&&\"default\"in t?t:{default:t}}(i),h={OK:\"ok\",CANCELLED:\"cancelled\",UNKNOWN:\"unknown\",INVALID_ARGUMENT:\"invalid-argument\",DEADLINE_EXCEEDED:\"deadline-exceeded\",NOT_FOUND:\"not-found\",ALREADY_EXISTS:\"already-exists\",PERMISSION_DENIED:\"permission-denied\",UNAUTHENTICATED:\"unauthenticated\",RESOURCE_EXHAUSTED:\"resource-exhausted\",FAILED_PRECONDITION:\"failed-precondition\",ABORTED:\"aborted\",OUT_OF_RANGE:\"out-of-range\",UNIMPLEMENTED:\"unimplemented\",INTERNAL:\"internal\",UNAVAILABLE:\"unavailable\",DATA_LOSS:\"data-loss\"},f=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name=\"FirebaseError\",r.toString=function(){return r.name+\": [code=\"+r.code+\"]: \"+r.message},r}return r.__extends(e,t),e}(Error),l=new o.Logger(\"@firebase/firestore\");function p(){return l.logLevel}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=o.LogLevel.DEBUG){var i=e.map(g);l.debug.apply(l,r.__spreadArrays([\"Firestore (7.20.0): \"+t],i))}}function v(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=o.LogLevel.ERROR){var i=e.map(g);l.error.apply(l,r.__spreadArrays([\"Firestore (7.20.0): \"+t],i))}}function y(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(l.logLevel<=o.LogLevel.WARN){var i=e.map(g);l.warn.apply(l,r.__spreadArrays([\"Firestore (7.20.0): \"+t],i))}}function g(t){if(\"string\"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function m(t){void 0===t&&(t=\"Unexpected state\");var e=\"FIRESTORE (7.20.0) INTERNAL ASSERTION FAILED: \"+t;throw v(e),new Error(e)}function w(t,e){t||m()}function _(t,e){return t}function b(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function I(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function E(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var T=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&m(),void 0===n?n=t.length-e:n>t.length-e&&m(),this.segments=t,this.offset=e,this.t=n}return Object.defineProperty(t.prototype,\"length\",{get:function(){return this.t},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.i(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach((function(t){n.push(t)})):n.push(e),this.o(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.u=function(t){return t=void 0===t?1:t,this.o(this.segments,this.offset+t,this.length-t)},t.prototype.h=function(){return this.o(this.segments,this.offset,this.length-1)},t.prototype.l=function(){return this.segments[this.offset]},t.prototype._=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.m=function(){return 0===this.length},t.prototype.T=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.I=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.A=function(){return this.segments.slice(this.offset,this.limit())},t.i=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),A=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.o=function(t,n,r){return new e(t,n,r)},e.prototype.R=function(){return this.A().join(\"/\")},e.prototype.toString=function(){return this.R()},e.P=function(t){if(t.indexOf(\"//\")>=0)throw new f(h.INVALID_ARGUMENT,\"Invalid path (\"+t+\"). Paths must not contain // in them.\");return new e(t.split(\"/\").filter((function(t){return t.length>0})))},e.g=function(){return new e([])},e}(T),N=/^[_a-zA-Z][_a-zA-Z0-9]*$/,D=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.o=function(t,n,r){return new e(t,n,r)},e.V=function(t){return N.test(t)},e.prototype.R=function(){return this.A().map((function(t){return t=t.replace(\"\\\\\",\"\\\\\\\\\").replace(\"`\",\"\\\\`\"),e.V(t)||(t=\"`\"+t+\"`\"),t})).join(\".\")},e.prototype.toString=function(){return this.R()},e.prototype.p=function(){return 1===this.length&&\"__name__\"===this.get(0)},e.v=function(){return new e([\"__name__\"])},e.S=function(t){for(var n=[],r=\"\",i=0,o=function(){if(0===r.length)throw new f(h.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\");n.push(r),r=\"\"},s=!1;i<t.length;){var u=t[i];if(\"\\\\\"===u){if(i+1===t.length)throw new f(h.INVALID_ARGUMENT,\"Path has trailing escape character: \"+t);var a=t[i+1];if(\"\\\\\"!==a&&\".\"!==a&&\"`\"!==a)throw new f(h.INVALID_ARGUMENT,\"Path has invalid escape sequence: \"+t);r+=a,i+=2}else\"`\"===u?(s=!s,i++):\".\"!==u||s?(r+=u,i++):(o(),i++)}if(o(),s)throw new f(h.INVALID_ARGUMENT,\"Unterminated ` in path: \"+t);return new e(n)},e.g=function(){return new e([])},e}(T),S=function(){function t(t){this.path=t}return t.D=function(e){return new t(A.P(e))},t.C=function(e){return new t(A.P(e).u(5))},t.prototype.N=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===A.i(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.i=function(t,e){return A.i(t.path,e.path)},t.F=function(t){return t.length%2==0},t.$=function(e){return new t(new A(e.slice()))},t}();function x(t,e){if(0!==e.length)throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() does not support arguments, but was called with \"+K(e.length,\"argument\")+\".\")}function k(t,e,n){if(e.length!==n)throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires \"+K(n,\"argument\")+\", but was called with \"+K(e.length,\"argument\")+\".\")}function L(t,e,n){if(e.length<n)throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires at least \"+K(n,\"argument\")+\", but was called with \"+K(e.length,\"argument\")+\".\")}function R(t,e,n,r){if(e.length<n||e.length>r)throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires between \"+n+\" and \"+r+\" arguments, but was called with \"+K(e.length,\"argument\")+\".\")}function O(t,e,n,r){F(t,e,W(n)+\" argument\",r)}function U(t,e,n,r){void 0!==r&&O(t,e,n,r)}function P(t,e,n,r){F(t,e,n+\" option\",r)}function V(t,e,n,r){void 0!==r&&P(t,e,n,r)}function C(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],s=0,u=i;s<u.length;s++){var a=u[s];if(a===r)return;o.push(j(a))}var c=j(r);throw new f(h.INVALID_ARGUMENT,\"Invalid value \"+c+\" provided to function \"+t+'() for option \"'+n+'\". Acceptable values: '+o.join(\", \"))}(t,0,n,r,i)}function M(t,e,n,r){if(!e.some((function(t){return t===r})))throw new f(h.INVALID_ARGUMENT,\"Invalid value \"+j(r)+\" provided to function \"+t+\"() for its \"+W(n)+\" argument. Acceptable values: \"+e.join(\", \"));return r}function F(t,e,n,r){if(!(\"object\"===e?q(r):\"non-empty string\"===e?\"string\"==typeof r&&\"\"!==r:typeof r===e)){var i=j(r);throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires its \"+n+\" to be of type \"+e+\", but it was: \"+i)}}function q(t){return\"object\"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function j(t){if(void 0===t)return\"undefined\";if(null===t)return\"null\";if(\"string\"==typeof t)return t.length>20&&(t=t.substring(0,20)+\"...\"),JSON.stringify(t);if(\"number\"==typeof t||\"boolean\"==typeof t)return\"\"+t;if(\"object\"==typeof t){if(t instanceof Array)return\"an array\";var e=function(t){if(t.constructor){var e=/function\\s+([^\\s(]+)\\s*\\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?\"a custom \"+e+\" object\":\"an object\"}return\"function\"==typeof t?\"a function\":m()}function z(t,e,n){if(void 0===n)throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires a valid \"+W(e)+\" argument, but it was undefined.\")}function B(t,e,n){I(e,(function(e,r){if(n.indexOf(e)<0)throw new f(h.INVALID_ARGUMENT,\"Unknown option '\"+e+\"' passed to function \"+t+\"(). Available options: \"+n.join(\", \"))}))}function G(t,e,n,r){var i=j(r);return new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires its \"+W(n)+\" argument to be a \"+e+\", but it was: \"+i)}function Q(t,e,n){if(n<=0)throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires its \"+W(e)+\" argument to be a positive number, but it was: \"+n+\".\")}function W(t){switch(t){case 1:return\"first\";case 2:return\"second\";case 3:return\"third\";default:return t+\"th\"}}function K(t,e){return t+\" \"+e+(1===t?\"\":\"s\")}function H(t){var e=\"undefined\"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&\"function\"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Y=function(){function t(){}return t.k=function(){for(var t=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\",e=Math.floor(256/t.length)*t.length,n=\"\";n.length<20;)for(var r=H(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function $(t,e){return t<e?-1:t>e?1:0}function X(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function J(t){return t+\"\\0\"}var Z=function(){function t(t){this.M=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e=\"\",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return t=this.M,btoa(t);var t},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.M)},t.prototype.O=function(){return 2*this.M.length},t.prototype.L=function(t){return $(this.M,t.M)},t.prototype.isEqual=function(t){return this.M===t.M},t}();Z.B=new Z(\"\");var tt=function(){function t(t){this.q=t}return t.fromBase64String=function(e){try{return new t(Z.fromBase64String(e))}catch(e){throw new f(h.INVALID_ARGUMENT,\"Failed to construct Bytes from Base64 string: \"+e)}},t.fromUint8Array=function(e){return new t(Z.fromUint8Array(e))},t.prototype.toBase64=function(){return this.q.toBase64()},t.prototype.toUint8Array=function(){return this.q.toUint8Array()},t.prototype.toString=function(){return\"Bytes(base64: \"+this.toBase64()+\")\"},t.prototype.isEqual=function(t){return this.q.isEqual(t.q)},t}();function et(){if(\"undefined\"==typeof Uint8Array)throw new f(h.UNIMPLEMENTED,\"Uint8Arrays are not available in this environment.\")}function nt(){if(\"undefined\"==typeof atob)throw new f(h.UNIMPLEMENTED,\"Blobs are unavailable in Firestore in this environment.\")}var rt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.fromBase64String=function(t){k(\"Blob.fromBase64String\",arguments,1),O(\"Blob.fromBase64String\",\"string\",1,t),nt();try{return new e(Z.fromBase64String(t))}catch(t){throw new f(h.INVALID_ARGUMENT,\"Failed to construct Blob from Base64 string: \"+t)}},e.fromUint8Array=function(t){if(k(\"Blob.fromUint8Array\",arguments,1),et(),!(t instanceof Uint8Array))throw G(\"Blob.fromUint8Array\",\"Uint8Array\",1,t);return new e(Z.fromUint8Array(t))},e.prototype.toBase64=function(){return k(\"Blob.toBase64\",arguments,0),nt(),t.prototype.toBase64.call(this)},e.prototype.toUint8Array=function(){return k(\"Blob.toUint8Array\",arguments,0),et(),t.prototype.toUint8Array.call(this)},e.prototype.toString=function(){return\"Blob(base64: \"+this.toBase64()+\")\"},e}(tt),it=function(t,e,n,r,i){this.U=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i},ot=function(){function t(t,e){this.projectId=t,this.database=e||\"(default)\"}return Object.defineProperty(t.prototype,\"W\",{get:function(){return\"(default)\"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.L=function(t){return $(this.projectId,t.projectId)||$(this.database,t.database)},t}(),st=function(){function t(t,e){this.j=t,this.K=e,this.G={}}return t.prototype.get=function(t){var e=this.j(t),n=this.G[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.K(s,t))return u}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.j(t),r=this.G[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.K(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.G[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.j(t),n=this.G[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.K(n[r][0],t))return 1===n.length?delete this.G[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){I(this.G,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},t.prototype.m=function(){return E(this.G)},t}(),ut=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new f(h.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(e>=1e9)throw new f(h.INVALID_ARGUMENT,\"Timestamp nanoseconds out of range: \"+e);if(t<-62135596800)throw new f(h.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t);if(t>=253402300800)throw new f(h.INVALID_ARGUMENT,\"Timestamp seconds out of range: \"+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype.H=function(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return\"Timestamp(seconds=\"+this.seconds+\", nanoseconds=\"+this.nanoseconds+\")\"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,\"0\")+\".\"+String(this.nanoseconds).padStart(9,\"0\")},t}(),at=function(){function t(t){this.timestamp=t}return t.Y=function(e){return new t(e)},t.min=function(){return new t(new ut(0,0))},t.prototype.L=function(t){return this.timestamp.H(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.J=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return\"SnapshotVersion(\"+this.timestamp.toString()+\")\"},t.prototype.X=function(){return this.timestamp},t}();function ct(t){return null==t}function ht(t){return-0===t&&1/t==-1/0}function ft(t){return\"number\"==typeof t&&Number.isInteger(t)&&!ht(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var lt=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Z=null};function pt(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new lt(t,e,n,r,i,o,s)}function dt(t){var e=_(t);if(null===e.Z){var n=e.path.R();null!==e.collectionGroup&&(n+=\"|cg:\"+e.collectionGroup),n+=\"|f:\",n+=e.filters.map((function(t){return function(t){return t.field.R()+t.op.toString()+ie(t.value)}(t)})).join(\",\"),n+=\"|ob:\",n+=e.orderBy.map((function(t){return(e=t).field.R()+e.dir;var e})).join(\",\"),ct(e.limit)||(n+=\"|l:\",n+=e.limit),e.startAt&&(n+=\"|lb:\",n+=ur(e.startAt)),e.endAt&&(n+=\"|ub:\",n+=ur(e.endAt)),e.Z=n}return e.Z}function vt(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!lr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if(i=t.filters[r],o=e.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!te(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!cr(t.startAt,e.startAt)&&cr(t.endAt,e.endAt)}function yt(t){return S.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}var gt,mt,wt=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=at.min()),void 0===o&&(o=at.min()),void 0===s&&(s=Z.B),this.target=t,this.targetId=e,this.tt=n,this.sequenceNumber=r,this.et=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.nt=function(e){return new t(this.target,this.targetId,this.tt,e,this.et,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.st=function(e,n){return new t(this.target,this.targetId,this.tt,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.it=function(e){return new t(this.target,this.targetId,this.tt,this.sequenceNumber,this.et,e,this.resumeToken)},t}(),_t=function(t){this.count=t};function bt(t){switch(t){case h.OK:return m();case h.CANCELLED:case h.UNKNOWN:case h.DEADLINE_EXCEEDED:case h.RESOURCE_EXHAUSTED:case h.INTERNAL:case h.UNAVAILABLE:case h.UNAUTHENTICATED:return!1;case h.INVALID_ARGUMENT:case h.NOT_FOUND:case h.ALREADY_EXISTS:case h.PERMISSION_DENIED:case h.FAILED_PRECONDITION:case h.ABORTED:case h.OUT_OF_RANGE:case h.UNIMPLEMENTED:case h.DATA_LOSS:return!0;default:return m()}}function It(t){if(void 0===t)return v(\"GRPC error has no .code\"),h.UNKNOWN;switch(t){case gt.OK:return h.OK;case gt.CANCELLED:return h.CANCELLED;case gt.UNKNOWN:return h.UNKNOWN;case gt.DEADLINE_EXCEEDED:return h.DEADLINE_EXCEEDED;case gt.RESOURCE_EXHAUSTED:return h.RESOURCE_EXHAUSTED;case gt.INTERNAL:return h.INTERNAL;case gt.UNAVAILABLE:return h.UNAVAILABLE;case gt.UNAUTHENTICATED:return h.UNAUTHENTICATED;case gt.INVALID_ARGUMENT:return h.INVALID_ARGUMENT;case gt.NOT_FOUND:return h.NOT_FOUND;case gt.ALREADY_EXISTS:return h.ALREADY_EXISTS;case gt.PERMISSION_DENIED:return h.PERMISSION_DENIED;case gt.FAILED_PRECONDITION:return h.FAILED_PRECONDITION;case gt.ABORTED:return h.ABORTED;case gt.OUT_OF_RANGE:return h.OUT_OF_RANGE;case gt.UNIMPLEMENTED:return h.UNIMPLEMENTED;case gt.DATA_LOSS:return h.DATA_LOSS;default:return m()}}(mt=gt||(gt={}))[mt.OK=0]=\"OK\",mt[mt.CANCELLED=1]=\"CANCELLED\",mt[mt.UNKNOWN=2]=\"UNKNOWN\",mt[mt.INVALID_ARGUMENT=3]=\"INVALID_ARGUMENT\",mt[mt.DEADLINE_EXCEEDED=4]=\"DEADLINE_EXCEEDED\",mt[mt.NOT_FOUND=5]=\"NOT_FOUND\",mt[mt.ALREADY_EXISTS=6]=\"ALREADY_EXISTS\",mt[mt.PERMISSION_DENIED=7]=\"PERMISSION_DENIED\",mt[mt.UNAUTHENTICATED=16]=\"UNAUTHENTICATED\",mt[mt.RESOURCE_EXHAUSTED=8]=\"RESOURCE_EXHAUSTED\",mt[mt.FAILED_PRECONDITION=9]=\"FAILED_PRECONDITION\",mt[mt.ABORTED=10]=\"ABORTED\",mt[mt.OUT_OF_RANGE=11]=\"OUT_OF_RANGE\",mt[mt.UNIMPLEMENTED=12]=\"UNIMPLEMENTED\",mt[mt.INTERNAL=13]=\"INTERNAL\",mt[mt.UNAVAILABLE=14]=\"UNAVAILABLE\",mt[mt.DATA_LOSS=15]=\"DATA_LOSS\";var Et=function(){function t(t,e){this.i=t,this.root=e||At.EMPTY}return t.prototype.rt=function(e,n){return new t(this.i,this.root.rt(e,n,this.i).copy(null,null,At.ot,null,null))},t.prototype.remove=function(e){return new t(this.i,this.root.remove(e,this.i).copy(null,null,At.ot,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.m();){var n=this.i(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.m();){var r=this.i(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.m=function(){return this.root.m()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.at=function(){return this.root.at()},t.prototype.ct=function(){return this.root.ct()},t.prototype.ut=function(t){return this.root.ut(t)},t.prototype.forEach=function(t){this.ut((function(e,n){return t(e,n),!1}))},t.prototype.toString=function(){var t=[];return this.ut((function(e,n){return t.push(e+\":\"+n),!1})),\"{\"+t.join(\", \")+\"}\"},t.prototype.ht=function(t){return this.root.ht(t)},t.prototype.lt=function(){return new Tt(this.root,null,this.i,!1)},t.prototype._t=function(t){return new Tt(this.root,t,this.i,!1)},t.prototype.ft=function(){return new Tt(this.root,null,this.i,!0)},t.prototype.dt=function(t){return new Tt(this.root,t,this.i,!0)},t}(),Tt=function(){function t(t,e,n,r){this.wt=r,this.Tt=[];for(var i=1;!t.m();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.wt?t.left:t.right;else{if(0===i){this.Tt.push(t);break}this.Tt.push(t),t=this.wt?t.right:t.left}}return t.prototype.Et=function(){var t=this.Tt.pop(),e={key:t.key,value:t.value};if(this.wt)for(t=t.left;!t.m();)this.Tt.push(t),t=t.right;else for(t=t.right;!t.m();)this.Tt.push(t),t=t.left;return e},t.prototype.It=function(){return this.Tt.length>0},t.prototype.At=function(){if(0===this.Tt.length)return null;var t=this.Tt[this.Tt.length-1];return{key:t.key,value:t.value}},t}(),At=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.m=function(){return!1},t.prototype.ut=function(t){return this.left.ut(t)||t(this.key,this.value)||this.right.ut(t)},t.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},t.prototype.min=function(){return this.left.m()?this:this.left.min()},t.prototype.at=function(){return this.min().key},t.prototype.ct=function(){return this.right.m()?this.key:this.right.ct()},t.prototype.rt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.rt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.rt(t,e,n))).Rt()},t.prototype.Pt=function(){if(this.left.m())return t.EMPTY;var e=this;return e.left.gt()||e.left.left.gt()||(e=e.yt()),(e=e.copy(null,null,null,e.left.Pt(),null)).Rt()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.m()||i.left.gt()||i.left.left.gt()||(i=i.yt()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.gt()&&(i=i.Vt()),i.right.m()||i.right.gt()||i.right.left.gt()||(i=i.bt()),0===n(e,i.key)){if(i.right.m())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.Pt())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.Rt()},t.prototype.gt=function(){return this.color},t.prototype.Rt=function(){var t=this;return t.right.gt()&&!t.left.gt()&&(t=t.vt()),t.left.gt()&&t.left.left.gt()&&(t=t.Vt()),t.left.gt()&&t.right.gt()&&(t=t.St()),t},t.prototype.yt=function(){var t=this.St();return t.right.left.gt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Vt())).vt()).St()),t},t.prototype.bt=function(){var t=this.St();return t.left.left.gt()&&(t=(t=t.Vt()).St()),t},t.prototype.vt=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.Vt=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.St=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.Dt=function(){var t=this.Ct();return Math.pow(2,t)<=this.size+1},t.prototype.Ct=function(){if(this.gt()&&this.left.gt())throw m();if(this.right.gt())throw m();var t=this.left.Ct();if(t!==this.right.Ct())throw m();return t+(this.gt()?0:1)},t}();At.EMPTY=null,At.RED=!0,At.ot=!1,At.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,\"key\",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"value\",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"color\",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"left\",{get:function(){throw m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"right\",{get:function(){throw m()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.rt=function(t,e,n){return new At(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.m=function(){return!0},t.prototype.ut=function(t){return!1},t.prototype.ht=function(t){return!1},t.prototype.at=function(){return null},t.prototype.ct=function(){return null},t.prototype.gt=function(){return!1},t.prototype.Dt=function(){return!0},t.prototype.Ct=function(){return 0},t}());var Nt=function(){function t(t){this.i=t,this.data=new Et(this.i)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.at()},t.prototype.last=function(){return this.data.ct()},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.ut((function(e,n){return t(e),!1}))},t.prototype.Nt=function(t,e){for(var n=this.data._t(t[0]);n.It();){var r=n.Et();if(this.i(r.key,t[1])>=0)return;e(r.key)}},t.prototype.Ft=function(t,e){var n;for(n=void 0!==e?this.data._t(e):this.data.lt();n.It();)if(!t(n.Et().key))return},t.prototype.$t=function(t){var e=this.data._t(t);return e.It()?e.Et().key:null},t.prototype.lt=function(){return new Dt(this.data.lt())},t.prototype._t=function(t){return new Dt(this.data._t(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).rt(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.m=function(){return this.data.m()},t.prototype.xt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.lt(),r=e.data.lt();n.It();){var i=n.Et().key,o=r.Et().key;if(0!==this.i(i,o))return!1}return!0},t.prototype.A=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},t.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),\"SortedSet(\"+t.toString()+\")\"},t.prototype.copy=function(e){var n=new t(this.i);return n.data=e,n},t}(),Dt=function(){function t(t){this.kt=t}return t.prototype.Et=function(){return this.kt.Et().key},t.prototype.It=function(){return this.kt.It()},t}(),St=new Et(S.i);function xt(){return St}function kt(){return xt()}var Lt=new Et(S.i);function Rt(){return Lt}var Ot=new Et(S.i),Ut=new Nt(S.i);function Pt(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ut,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Vt=new Nt($);function Ct(){return Vt}var Mt=function(){function t(t){this.i=t?function(e,n){return t(e,n)||S.i(e.key,n.key)}:function(t,e){return S.i(t.key,e.key)},this.Mt=Rt(),this.Ot=new Et(this.i)}return t.Lt=function(e){return new t(e.i)},t.prototype.has=function(t){return null!=this.Mt.get(t)},t.prototype.get=function(t){return this.Mt.get(t)},t.prototype.first=function(){return this.Ot.at()},t.prototype.last=function(){return this.Ot.ct()},t.prototype.m=function(){return this.Ot.m()},t.prototype.indexOf=function(t){var e=this.Mt.get(t);return e?this.Ot.indexOf(e):-1},Object.defineProperty(t.prototype,\"size\",{get:function(){return this.Ot.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.Ot.ut((function(e,n){return t(e),!1}))},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Mt.rt(t.key,t),e.Ot.rt(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Mt.remove(t),this.Ot.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.Ot.lt(),r=e.Ot.lt();n.It();){var i=n.Et().key,o=r.Et().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?\"DocumentSet ()\":\"DocumentSet (\\n  \"+t.join(\"  \\n\")+\"\\n)\"},t.prototype.copy=function(e,n){var r=new t;return r.i=this.i,r.Mt=e,r.Ot=n,r},t}(),Ft=function(){function t(){this.Bt=new Et(S.i)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Bt.get(e);n?0!==t.type&&3===n.type?this.Bt=this.Bt.rt(e,t):3===t.type&&1!==n.type?this.Bt=this.Bt.rt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Bt=this.Bt.rt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Bt=this.Bt.remove(e):1===t.type&&2===n.type?this.Bt=this.Bt.rt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Bt=this.Bt.rt(e,{type:2,doc:t.doc}):m():this.Bt=this.Bt.rt(e,t)},t.prototype.qt=function(){var t=[];return this.Bt.ut((function(e,n){t.push(n)})),t},t}(),qt=function(){function t(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ut=n,this.docChanges=r,this.Qt=i,this.fromCache=o,this.Wt=s,this.jt=u}return t.Kt=function(e,n,r,i){var o=[];return n.forEach((function(t){o.push({type:0,doc:t})})),new t(e,n,Mt.Lt(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,\"hasPendingWrites\",{get:function(){return!this.Qt.m()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Wt===t.Wt&&this.Qt.isEqual(t.Qt)&&Wn(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ut.isEqual(t.Ut)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),jt=function(){function t(t,e,n,r,i){this.et=t,this.Gt=e,this.zt=n,this.Ht=r,this.Yt=i}return t.Jt=function(e,n){var r=new Map;return r.set(e,zt.Xt(e,n)),new t(at.min(),r,Ct(),xt(),Pt())},t}(),zt=function(){function t(t,e,n,r,i){this.resumeToken=t,this.Zt=e,this.te=n,this.ee=r,this.ne=i}return t.Xt=function(e,n){return new t(Z.B,n,Pt(),Pt(),Pt())},t}(),Bt=function(t,e,n,r){this.se=t,this.removedTargetIds=e,this.key=n,this.ie=r},Gt=function(t,e){this.targetId=t,this.re=e},Qt=function(t,e,n,r){void 0===n&&(n=Z.B),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Wt=function(){function t(){this.oe=0,this.ae=Yt(),this.ce=Z.B,this.ue=!1,this.he=!0}return Object.defineProperty(t.prototype,\"Zt\",{get:function(){return this.ue},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"resumeToken\",{get:function(){return this.ce},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"le\",{get:function(){return 0!==this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"_e\",{get:function(){return this.he},enumerable:!1,configurable:!0}),t.prototype.fe=function(t){t.O()>0&&(this.he=!0,this.ce=t)},t.prototype.de=function(){var t=Pt(),e=Pt(),n=Pt();return this.ae.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:m()}})),new zt(this.ce,this.ue,t,e,n)},t.prototype.we=function(){this.he=!1,this.ae=Yt()},t.prototype.me=function(t,e){this.he=!0,this.ae=this.ae.rt(t,e)},t.prototype.Te=function(t){this.he=!0,this.ae=this.ae.remove(t)},t.prototype.Ee=function(){this.oe+=1},t.prototype.Ie=function(){this.oe-=1},t.prototype.Ae=function(){this.he=!0,this.ue=!0},t}(),Kt=function(){function t(t){this.Re=t,this.Pe=new Map,this.ge=xt(),this.ye=Ht(),this.Ve=new Nt($)}return t.prototype.pe=function(t){for(var e=0,n=t.se;e<n.length;e++){var r=n[e];t.ie instanceof xn?this.be(r,t.ie):t.ie instanceof kn&&this.ve(r,t.key,t.ie)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ve(s,t.key,t.ie)}},t.prototype.Se=function(t){var e=this;this.De(t,(function(n){var r=e.Ce(n);switch(t.state){case 0:e.Ne(n)&&r.fe(t.resumeToken);break;case 1:r.Ie(),r.le||r.we(),r.fe(t.resumeToken);break;case 2:r.Ie(),r.le||e.removeTarget(n);break;case 3:e.Ne(n)&&(r.Ae(),r.fe(t.resumeToken));break;case 4:e.Ne(n)&&(e.Fe(n),r.fe(t.resumeToken));break;default:m()}}))},t.prototype.De=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.Pe.forEach((function(t,r){n.Ne(r)&&e(r)}))},t.prototype.$e=function(t){var e=t.targetId,n=t.re.count,r=this.xe(e);if(r){var i=r.target;if(yt(i))if(0===n){var o=new S(i.path);this.ve(e,o,new kn(o,at.min()))}else w(1===n);else this.ke(e)!==n&&(this.Fe(e),this.Ve=this.Ve.add(e))}},t.prototype.Me=function(t){var e=this,n=new Map;this.Pe.forEach((function(r,i){var o=e.xe(i);if(o){if(r.Zt&&yt(o.target)){var s=new S(o.target.path);null!==e.ge.get(s)||e.Oe(i,s)||e.ve(i,s,new kn(s,t))}r._e&&(n.set(i,r.de()),r.we())}}));var r=Pt();this.ye.forEach((function(t,n){var i=!0;n.Ft((function(t){var n=e.xe(t);return!n||2===n.tt||(i=!1,!1)})),i&&(r=r.add(t))}));var i=new jt(t,n,this.Ve,this.ge,r);return this.ge=xt(),this.ye=Ht(),this.Ve=new Nt($),i},t.prototype.be=function(t,e){if(this.Ne(t)){var n=this.Oe(t,e.key)?2:0;this.Ce(t).me(e.key,n),this.ge=this.ge.rt(e.key,e),this.ye=this.ye.rt(e.key,this.Le(e.key).add(t))}},t.prototype.ve=function(t,e,n){if(this.Ne(t)){var r=this.Ce(t);this.Oe(t,e)?r.me(e,1):r.Te(e),this.ye=this.ye.rt(e,this.Le(e).delete(t)),n&&(this.ge=this.ge.rt(e,n))}},t.prototype.removeTarget=function(t){this.Pe.delete(t)},t.prototype.ke=function(t){var e=this.Ce(t).de();return this.Re.Be(t).size+e.te.size-e.ne.size},t.prototype.Ee=function(t){this.Ce(t).Ee()},t.prototype.Ce=function(t){var e=this.Pe.get(t);return e||(e=new Wt,this.Pe.set(t,e)),e},t.prototype.Le=function(t){var e=this.ye.get(t);return e||(e=new Nt($),this.ye=this.ye.rt(t,e)),e},t.prototype.Ne=function(t){var e=null!==this.xe(t);return e||d(\"WatchChangeAggregator\",\"Detected inactive target\",t),e},t.prototype.xe=function(t){var e=this.Pe.get(t);return e&&e.le?null:this.Re.qe(t)},t.prototype.Fe=function(t){var e=this;this.Pe.set(t,new Wt),this.Re.Be(t).forEach((function(n){e.ve(t,n,null)}))},t.prototype.Oe=function(t,e){return this.Re.Be(t).has(e)},t}();function Ht(){return new Et(S.i)}function Yt(){return new Et(S.i)}function $t(t){var e,n;return\"server_timestamp\"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Xt(t){var e=oe(t.mapValue.fields.__local_write_time__.timestampValue);return new ut(e.seconds,e.nanos)}var Jt=new RegExp(/^\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.(\\d+))?Z$/);function Zt(t){return\"nullValue\"in t?0:\"booleanValue\"in t?1:\"integerValue\"in t||\"doubleValue\"in t?2:\"timestampValue\"in t?3:\"stringValue\"in t?5:\"bytesValue\"in t?6:\"referenceValue\"in t?7:\"geoPointValue\"in t?8:\"arrayValue\"in t?9:\"mapValue\"in t?$t(t)?4:10:m()}function te(t,e){var n=Zt(t);if(n!==Zt(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Xt(t).isEqual(Xt(e));case 3:return function(t,e){if(\"string\"==typeof t.timestampValue&&\"string\"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=oe(t.timestampValue),r=oe(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return ue(t.bytesValue).isEqual(ue(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return se(t.geoPointValue.latitude)===se(e.geoPointValue.latitude)&&se(t.geoPointValue.longitude)===se(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if(\"integerValue\"in t&&\"integerValue\"in e)return se(t.integerValue)===se(e.integerValue);if(\"doubleValue\"in t&&\"doubleValue\"in e){var n=se(t.doubleValue),r=se(e.doubleValue);return n===r?ht(n)===ht(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return X(t.arrayValue.values||[],e.arrayValue.values||[],te);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(b(n)!==b(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!te(n[i],r[i])))return!1;return!0}(t,e);default:return m()}}function ee(t,e){return void 0!==(t.values||[]).find((function(t){return te(t,e)}))}function ne(t,e){var n=Zt(t),r=Zt(e);if(n!==r)return $(n,r);switch(n){case 0:return 0;case 1:return $(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=se(t.integerValue||t.doubleValue),r=se(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return re(t.timestampValue,e.timestampValue);case 4:return re(Xt(t),Xt(e));case 5:return $(t.stringValue,e.stringValue);case 6:return function(t,e){var n=ue(t),r=ue(e);return n.L(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split(\"/\"),r=e.split(\"/\"),i=0;i<n.length&&i<r.length;i++){var o=$(n[i],r[i]);if(0!==o)return o}return $(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=$(se(t.latitude),se(e.latitude));return 0!==n?n:$(se(t.longitude),se(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=ne(n[i],r[i]);if(o)return o}return $(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=$(r[s],o[s]);if(0!==u)return u;var a=ne(n[r[s]],i[o[s]]);if(0!==a)return a}return $(r.length,o.length)}(t.mapValue,e.mapValue);default:throw m()}}function re(t,e){if(\"string\"==typeof t&&\"string\"==typeof e&&t.length===e.length)return $(t,e);var n=oe(t),r=oe(e),i=$(n.seconds,r.seconds);return 0!==i?i:$(n.nanos,r.nanos)}function ie(t){return function t(e){return\"nullValue\"in e?\"null\":\"booleanValue\"in e?\"\"+e.booleanValue:\"integerValue\"in e?\"\"+e.integerValue:\"doubleValue\"in e?\"\"+e.doubleValue:\"timestampValue\"in e?function(t){var e=oe(t);return\"time(\"+e.seconds+\",\"+e.nanos+\")\"}(e.timestampValue):\"stringValue\"in e?e.stringValue:\"bytesValue\"in e?ue(e.bytesValue).toBase64():\"referenceValue\"in e?(r=e.referenceValue,S.C(r).toString()):\"geoPointValue\"in e?\"geo(\"+(n=e.geoPointValue).latitude+\",\"+n.longitude+\")\":\"arrayValue\"in e?function(e){for(var n=\"[\",r=!0,i=0,o=e.values||[];i<o.length;i++){var s=o[i];r?r=!1:n+=\",\",n+=t(s)}return n+\"]\"}(e.arrayValue):\"mapValue\"in e?function(e){for(var n=\"{\",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=\",\",n+=s+\":\"+t(e.fields[s])}return n+\"}\"}(e.mapValue):m();var n,r}(t)}function oe(t){if(w(!!t),\"string\"==typeof t){var e=0,n=Jt.exec(t);if(w(!!n),n[1]){var r=n[1];r=(r+\"000000000\").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:se(t.seconds),nanos:se(t.nanos)}}function se(t){return\"number\"==typeof t?t:\"string\"==typeof t?Number(t):0}function ue(t){return\"string\"==typeof t?Z.fromBase64String(t):Z.fromUint8Array(t)}function ae(t,e){return{referenceValue:\"projects/\"+t.projectId+\"/databases/\"+t.database+\"/documents/\"+e.path.R()}}function ce(t){return!!t&&\"integerValue\"in t}function he(t){return!!t&&\"arrayValue\"in t}function fe(t){return!!t&&\"nullValue\"in t}function le(t){return!!t&&\"doubleValue\"in t&&isNaN(Number(t.doubleValue))}function pe(t){return!!t&&\"mapValue\"in t}var de={asc:\"ASCENDING\",desc:\"DESCENDING\"},ve={\"<\":\"LESS_THAN\",\"<=\":\"LESS_THAN_OR_EQUAL\",\">\":\"GREATER_THAN\",\">=\":\"GREATER_THAN_OR_EQUAL\",\"==\":\"EQUAL\",\"!=\":\"NOT_EQUAL\",\"array-contains\":\"ARRAY_CONTAINS\",in:\"IN\",\"not-in\":\"NOT_IN\",\"array-contains-any\":\"ARRAY_CONTAINS_ANY\"},ye=function(t,e){this.U=t,this.Ue=e};function ge(t){return{integerValue:\"\"+t}}function me(t,e){if(t.Ue){if(isNaN(e))return{doubleValue:\"NaN\"};if(e===1/0)return{doubleValue:\"Infinity\"};if(e===-1/0)return{doubleValue:\"-Infinity\"}}return{doubleValue:ht(e)?\"-0\":e}}function we(t,e){return ft(e)?ge(e):me(t,e)}function _e(t,e){return t.Ue?new Date(1e3*e.seconds).toISOString().replace(/\\.\\d*/,\"\").replace(\"Z\",\"\")+\".\"+(\"000000000\"+e.nanoseconds).slice(-9)+\"Z\":{seconds:\"\"+e.seconds,nanos:e.nanoseconds}}function be(t,e){return t.Ue?e.toBase64():e.toUint8Array()}function Ie(t,e){return _e(t,e.X())}function Ee(t){return w(!!t),at.Y(function(t){var e=oe(t);return new ut(e.seconds,e.nanos)}(t))}function Te(t,e){return function(t){return new A([\"projects\",t.projectId,\"databases\",t.database])}(t).child(\"documents\").child(e).R()}function Ae(t){var e=A.P(t);return w(We(e)),e}function Ne(t,e){return Te(t.U,e.path)}function De(t,e){var n=Ae(e);return w(n.get(1)===t.U.projectId),w(!n.get(3)&&!t.U.database||n.get(3)===t.U.database),new S(Le(n))}function Se(t,e){return Te(t.U,e)}function xe(t){var e=Ae(t);return 4===e.length?A.g():Le(e)}function ke(t){return new A([\"projects\",t.U.projectId,\"databases\",t.U.database]).R()}function Le(t){return w(t.length>4&&\"documents\"===t.get(4)),t.u(5)}function Re(t,e,n){return{name:Ne(t,e),fields:n.proto.mapValue.fields}}function Oe(t,e){var n;if(e instanceof gn)n={update:Re(t,e.key,e.value)};else if(e instanceof En)n={delete:Ne(t,e.key)};else if(e instanceof mn)n={update:Re(t,e.key,e.data),updateMask:Qe(e.Qe)};else if(e instanceof _n)n={transform:{document:Ne(t,e.key),fieldTransforms:e.fieldTransforms.map((function(t){return function(t,e){var n=e.transform;if(n instanceof Xe)return{fieldPath:e.field.R(),setToServerValue:\"REQUEST_TIME\"};if(n instanceof Je)return{fieldPath:e.field.R(),appendMissingElements:{values:n.elements}};if(n instanceof tn)return{fieldPath:e.field.R(),removeAllFromArray:{values:n.elements}};if(n instanceof nn)return{fieldPath:e.field.R(),increment:n.We};throw m()}(0,t)}))}};else{if(!(e instanceof Tn))return m();n={verify:Ne(t,e.key)}}return e.Ke.je||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Ie(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:m()}(t,e.Ke)),n}function Ue(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?cn.updateTime(Ee(t.updateTime)):void 0!==t.exists?cn.exists(t.exists):cn.Ge()}(e.currentDocument):cn.Ge();if(e.update){e.update.name;var r=De(t,e.update.name),i=new An({mapValue:{fields:e.update.fields}});if(e.updateMask){var o=function(t){var e=t.fieldPaths||[];return new sn(e.map((function(t){return D.S(t)})))}(e.updateMask);return new mn(r,i,o,n)}return new gn(r,i,n)}if(e.delete){var s=De(t,e.delete);return new En(s,n)}if(e.transform){var u=De(t,e.transform.document),a=e.transform.fieldTransforms.map((function(e){return function(t,e){var n=null;if(\"setToServerValue\"in e)w(\"REQUEST_TIME\"===e.setToServerValue),n=new Xe;else if(\"appendMissingElements\"in e){var r=e.appendMissingElements.values||[];n=new Je(r)}else if(\"removeAllFromArray\"in e){var i=e.removeAllFromArray.values||[];n=new tn(i)}else\"increment\"in e?n=new nn(t,e.increment):m();var o=D.S(e.fieldPath);return new un(o,n)}(t,e)}));return w(!0===n.exists),new _n(u,a)}if(e.verify){var c=De(t,e.verify);return new Tn(c,n)}return m()}function Pe(t,e){return{documents:[Se(t,e.path)]}}function Ve(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Se(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Se(t,r.h()),n.structuredQuery.from=[{collectionId:r._()}]);var i=function(t){if(0!==t.length){var e=t.map((function(t){return function(t){if(\"==\"===t.op){if(le(t.value))return{unaryFilter:{field:je(t.field),op:\"IS_NAN\"}};if(fe(t.value))return{unaryFilter:{field:je(t.field),op:\"IS_NULL\"}}}else if(\"!=\"===t.op){if(le(t.value))return{unaryFilter:{field:je(t.field),op:\"IS_NOT_NAN\"}};if(fe(t.value))return{unaryFilter:{field:je(t.field),op:\"IS_NOT_NULL\"}}}return{fieldFilter:{field:je(t.field),op:qe(t.op),value:t.value}}}(t)}));return 1===e.length?e[0]:{compositeFilter:{op:\"AND\",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map((function(t){return function(t){return{field:je(t.field),direction:Fe(t.dir)}}(t)}))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.Ue||ct(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Ce(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ce(e.endAt)),n}function Ce(t){return{before:t.before,values:t.position}}function Me(t){var e=!!t.before,n=t.values||[];return new sr(n,e)}function Fe(t){return de[t]}function qe(t){return ve[t]}function je(t){return{fieldPath:t.R()}}function ze(t){return D.S(t.fieldPath)}function Be(t){return Xn.create(ze(t.fieldFilter.field),function(t){switch(t){case\"EQUAL\":return\"==\";case\"NOT_EQUAL\":return\"!=\";case\"GREATER_THAN\":return\">\";case\"GREATER_THAN_OR_EQUAL\":return\">=\";case\"LESS_THAN\":return\"<\";case\"LESS_THAN_OR_EQUAL\":return\"<=\";case\"ARRAY_CONTAINS\":return\"array-contains\";case\"IN\":return\"in\";case\"NOT_IN\":return\"not-in\";case\"ARRAY_CONTAINS_ANY\":return\"array-contains-any\";case\"OPERATOR_UNSPECIFIED\":default:return m()}}(t.fieldFilter.op),t.fieldFilter.value)}function Ge(t){switch(t.unaryFilter.op){case\"IS_NAN\":var e=ze(t.unaryFilter.field);return Xn.create(e,\"==\",{doubleValue:NaN});case\"IS_NULL\":var n=ze(t.unaryFilter.field);return Xn.create(n,\"==\",{nullValue:\"NULL_VALUE\"});case\"IS_NOT_NAN\":var r=ze(t.unaryFilter.field);return Xn.create(r,\"!=\",{doubleValue:NaN});case\"IS_NOT_NULL\":var i=ze(t.unaryFilter.field);return Xn.create(i,\"!=\",{nullValue:\"NULL_VALUE\"});case\"OPERATOR_UNSPECIFIED\":default:return m()}}function Qe(t){var e=[];return t.fields.forEach((function(t){return e.push(t.R())})),{fieldPaths:e}}function We(t){return t.length>=4&&\"projects\"===t.get(0)&&\"databases\"===t.get(2)}var Ke=function(){this.ze=void 0};function He(t,e,n){return t instanceof Xe?function(t,e){var n={fields:{__type__:{stringValue:\"server_timestamp\"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Je?Ze(t,e):t instanceof tn?en(t,e):function(t,e){var n=$e(t,e),r=rn(n)+rn(t.We);return ce(n)&&ce(t.We)?ge(r):me(t.serializer,r)}(t,e)}function Ye(t,e,n){return t instanceof Je?Ze(t,e):t instanceof tn?en(t,e):n}function $e(t,e){return t instanceof nn?ce(n=e)||function(t){return!!t&&\"doubleValue\"in t}(n)?e:{integerValue:0}:null;var n}var Xe=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e}(Ke),Je=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return r.__extends(e,t),e}(Ke);function Ze(t,e){for(var n=on(e),r=function(t){n.some((function(e){return te(e,t)}))||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var tn=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return r.__extends(e,t),e}(Ke);function en(t,e){for(var n=on(e),r=function(t){n=n.filter((function(e){return!te(e,t)}))},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var nn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).serializer=e,r.We=n,r}return r.__extends(e,t),e}(Ke);function rn(t){return se(t.integerValue||t.doubleValue)}function on(t){return he(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var sn=function(){function t(t){this.fields=t,t.sort(D.i)}return t.prototype.He=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].T(t))return!0;return!1},t.prototype.isEqual=function(t){return X(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},t}(),un=function(t,e){this.field=t,this.transform=e},an=function(t,e){this.version=t,this.transformResults=e},cn=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.Ge=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,\"je\",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function hn(t,e){return void 0!==t.updateTime?e instanceof xn&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof xn}var fn=function(){};function ln(t,e,n){return t instanceof gn?function(t,e,n){return new xn(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof mn?function(t,e,n){if(!hn(t.Ke,e))return new Ln(t.key,n.version);var r=wn(t,e);return new xn(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof _n?function(t,e,n){if(w(null!=n.transformResults),!hn(t.Ke,e))return new Ln(t.key,n.version);var r=bn(t,e),i=function(t,e,n){var r=[];w(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,u=null;e instanceof xn&&(u=e.field(o.field)),r.push(Ye(s,u,n[i]))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=In(t,r.data(),i);return new xn(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new kn(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function pn(t,e,n,r){return t instanceof gn?function(t,e){if(!hn(t.Ke,e))return e;var n=yn(e);return new xn(t.key,n,t.value,{Ye:!0})}(t,e):t instanceof mn?function(t,e){if(!hn(t.Ke,e))return e;var n=yn(e),r=wn(t,e);return new xn(t.key,n,r,{Ye:!0})}(t,e):t instanceof _n?function(t,e,n,r){if(!hn(t.Ke,e))return e;var i=bn(t,e),o=function(t,e,n,r){for(var i=[],o=0,s=t;o<s.length;o++){var u=s[o],a=u.transform,c=null;n instanceof xn&&(c=n.field(u.field)),null===c&&r instanceof xn&&(c=r.field(u.field)),i.push(He(a,c,e))}return i}(t.fieldTransforms,n,e,r),s=In(t,i.data(),o);return new xn(t.key,i.version,s,{Ye:!0})}(t,e,r,n):function(t,e){return hn(t.Ke,e)?new kn(t.key,at.min()):e}(t,e)}function dn(t,e){return t instanceof _n?function(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e instanceof xn?e.field(o.field):void 0,u=$e(o.transform,s||null);null!=u&&(n=null==n?(new Nn).set(o.field,u):n.set(o.field,u))}return n?n.Je():null}(t,e):null}function vn(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ke.isEqual(e.Ke)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Qe.isEqual(e.Qe):2!==t.type||X(t.fieldTransforms,t.fieldTransforms,(function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Je&&e instanceof Je||t instanceof tn&&e instanceof tn?X(t.elements,e.elements,te):t instanceof nn&&e instanceof nn?te(t.We,e.We):t instanceof Xe&&e instanceof Xe}(t.transform,e.transform)}(t,e)})))}function yn(t){return t instanceof xn?t.version:at.min()}var gn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).key=e,i.value=n,i.Ke=r,i.type=0,i}return r.__extends(e,t),e}(fn),mn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this)||this).key=e,o.data=n,o.Qe=r,o.Ke=i,o.type=1,o}return r.__extends(e,t),e}(fn);function wn(t,e){return function(t,e){var n=new Nn(e);return t.Qe.fields.forEach((function(e){if(!e.m()){var r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}})),n.Je()}(t,e instanceof xn?e.data():An.empty())}var _n=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.fieldTransforms=n,r.type=2,r.Ke=cn.exists(!0),r}return r.__extends(e,t),e}(fn);function bn(t,e){return e}function In(t,e,n){for(var r=new Nn(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.Je()}var En=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ke=n,r.type=3,r}return r.__extends(e,t),e}(fn),Tn=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.Ke=n,r.type=4,r}return r.__extends(e,t),e}(fn),An=function(){function t(t){this.proto=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.m())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!pe(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t._()])||null},t.prototype.isEqual=function(t){return te(this.proto,t.proto)},t}(),Nn=function(){function t(t){void 0===t&&(t=An.empty()),this.Xe=t,this.Ze=new Map}return t.prototype.set=function(t,e){return this.tn(t,e),this},t.prototype.delete=function(t){return this.tn(t,null),this},t.prototype.tn=function(t,e){for(var n=this.Ze,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map?n=o:o&&10===Zt(o)?(o=new Map(Object.entries(o.mapValue.fields||{})),n.set(i,o),n=o):(o=new Map,n.set(i,o),n=o)}n.set(t._(),e)},t.prototype.Je=function(){var t=this.en(D.g(),this.Ze);return null!=t?new An(t):this.Xe},t.prototype.en=function(t,e){var n=this,r=!1,i=this.Xe.field(t),o=pe(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.en(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},t}();function Dn(t){var e=[];return I(t.fields||{},(function(t,n){var r=new D([t]);if(pe(n)){var i=Dn(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new sn(e)}var Sn=function(t,e){this.key=t,this.version=e},xn=function(t){function e(e,n,r,i){var o=this;return(o=t.call(this,e,n)||this).nn=r,o.Ye=!!i.Ye,o.hasCommittedMutations=!!i.hasCommittedMutations,o}return r.__extends(e,t),e.prototype.field=function(t){return this.nn.field(t)},e.prototype.data=function(){return this.nn},e.prototype.sn=function(){return this.nn.proto},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ye===t.Ye&&this.hasCommittedMutations===t.hasCommittedMutations&&this.nn.isEqual(t.nn)},e.prototype.toString=function(){return\"Document(\"+this.key+\", \"+this.version+\", \"+this.nn.toString()+\", {hasLocalMutations: \"+this.Ye+\"}), {hasCommittedMutations: \"+this.hasCommittedMutations+\"})\"},Object.defineProperty(e.prototype,\"hasPendingWrites\",{get:function(){return this.Ye||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e}(Sn),kn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n)||this).hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return r.__extends(e,t),e.prototype.toString=function(){return\"NoDocument(\"+this.key+\", \"+this.version+\")\"},Object.defineProperty(e.prototype,\"hasPendingWrites\",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Sn),Ln=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.toString=function(){return\"UnknownDocument(\"+this.key+\", \"+this.version+\")\"},Object.defineProperty(e.prototype,\"hasPendingWrites\",{get:function(){return!0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Sn);function Rn(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new f(h.INVALID_ARGUMENT,\"Type does not match the expected instance. Did you pass '\"+e.name+\"' from a different Firestore SDK?\"):new f(h.INVALID_ARGUMENT,\"Expected type '\"+e.name+\"', but was '\"+t.constructor.name+\"'\");return t}var On=function(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=\"F\"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.rn=n,this.filters=r,this.limit=i,this.on=o,this.startAt=s,this.endAt=u,this.an=null,this.cn=null,this.startAt,this.endAt};function Un(t,e,n,r,i,o,s,u){return new On(t,e,n,r,i,o,s,u)}function Pn(t){return new On(t)}function Vn(t){return!ct(t.limit)&&\"F\"===t.on}function Cn(t){return!ct(t.limit)&&\"L\"===t.on}function Mn(t){return t.rn.length>0?t.rn[0].field:null}function Fn(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.un())return r.field}return null}function qn(t){return null!==t.collectionGroup}function jn(t){var e=Rn(t,On);if(null===e.an){e.an=[];var n=Fn(e),r=Mn(e);if(null!==n&&null===r)n.p()||e.an.push(new hr(n)),e.an.push(new hr(D.v(),\"asc\"));else{for(var i=!1,o=0,s=e.rn;o<s.length;o++){var u=s[o];e.an.push(u),u.field.p()&&(i=!0)}if(!i){var a=e.rn.length>0?e.rn[e.rn.length-1].dir:\"asc\";e.an.push(new hr(D.v(),a))}}}return e.an}function zn(t){var e=Rn(t,On);if(!e.cn)if(\"F\"===e.on)e.cn=pt(e.path,e.collectionGroup,jn(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=jn(e);r<i.length;r++){var o=i[r],s=\"desc\"===o.dir?\"asc\":\"desc\";n.push(new hr(o.field,s))}var u=e.endAt?new sr(e.endAt.position,!e.endAt.before):null,a=e.startAt?new sr(e.startAt.position,!e.startAt.before):null;e.cn=pt(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.cn}function Bn(t,e,n){return new On(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Gn(t,e){return new On(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,e,t.endAt)}function Qn(t,e){return new On(t.path,t.collectionGroup,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,e)}function Wn(t,e){return vt(zn(t),zn(e))&&t.on===e.on}function Kn(t){return dt(zn(t))+\"|lt:\"+t.on}function Hn(t){return\"Query(target=\"+function(t){var e=t.path.R();return null!==t.collectionGroup&&(e+=\" collectionGroup=\"+t.collectionGroup),t.filters.length>0&&(e+=\", filters: [\"+t.filters.map((function(t){return(e=t).field.R()+\" \"+e.op+\" \"+ie(e.value);var e})).join(\", \")+\"]\"),ct(t.limit)||(e+=\", limit: \"+t.limit),t.orderBy.length>0&&(e+=\", orderBy: [\"+t.orderBy.map((function(t){return(e=t).field.R()+\" (\"+e.dir+\")\";var e})).join(\", \")+\"]\"),t.startAt&&(e+=\", startAt: \"+ur(t.startAt)),t.endAt&&(e+=\", endAt: \"+ur(t.endAt)),\"Target(\"+e+\")\"}(zn(t))+\"; limitType=\"+t.on+\")\"}function Yn(t,e){return function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.N(t.collectionGroup)&&t.path.T(n):S.F(t.path)?t.path.isEqual(n):t.path.I(n)}(t,e)&&function(t,e){for(var n=0,r=t.rn;n<r.length;n++){var i=r[n];if(!i.field.p()&&null===e.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!ar(t.startAt,jn(t),e))&&(!t.endAt||!ar(t.endAt,jn(t),e))}(t,e)}function $n(t){return function(e,n){for(var r=!1,i=0,o=jn(t);i<o.length;i++){var s=o[i],u=fr(s,e,n);if(0!==u)return u;r=r||s.field.p()}return 0}}var Xn=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return r.__extends(e,t),e.create=function(t,n,r){if(t.p())return\"in\"===n||\"not-in\"===n?this.hn(t,n,r):new Jn(t,n,r);if(fe(r)){if(\"==\"!==n&&\"!=\"!==n)throw new f(h.INVALID_ARGUMENT,\"Invalid query. Null supports only equality comparisons.\");return new e(t,n,r)}if(le(r)){if(\"==\"!==n&&\"!=\"!==n)throw new f(h.INVALID_ARGUMENT,\"Invalid query. NaN supports only equality comparisons.\");return new e(t,n,r)}return\"array-contains\"===n?new nr(t,r):\"in\"===n?new rr(t,r):\"not-in\"===n?new ir(t,r):\"array-contains-any\"===n?new or(t,r):new e(t,n,r)},e.hn=function(t,e,n){return\"in\"===e?new Zn(t,n):new tr(t,n)},e.prototype.matches=function(t){var e=t.field(this.field);return\"!=\"===this.op?null!==e&&this.ln(ne(e,this.value)):null!==e&&Zt(this.value)===Zt(e)&&this.ln(ne(e,this.value))},e.prototype.ln=function(t){switch(this.op){case\"<\":return t<0;case\"<=\":return t<=0;case\"==\":return 0===t;case\"!=\":return 0!==t;case\">\":return t>0;case\">=\":return t>=0;default:return m()}},e.prototype.un=function(){return[\"<\",\"<=\",\">\",\">=\",\"!=\"].indexOf(this.op)>=0},e}((function(){})),Jn=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=S.C(r.referenceValue),i}return r.__extends(e,t),e.prototype.matches=function(t){var e=S.i(t.key,this.key);return this.ln(e)},e}(Xn),Zn=function(t){function e(e,n){var r=this;return(r=t.call(this,e,\"in\",n)||this).keys=er(\"in\",n),r}return r.__extends(e,t),e.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Xn),tr=function(t){function e(e,n){var r=this;return(r=t.call(this,e,\"not-in\",n)||this).keys=er(\"not-in\",n),r}return r.__extends(e,t),e.prototype.matches=function(t){return!this.keys.some((function(e){return e.isEqual(t.key)}))},e}(Xn);function er(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(t){return S.C(t.referenceValue)}))}var nr=function(t){function e(e,n){return t.call(this,e,\"array-contains\",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return he(e)&&ee(e.arrayValue,this.value)},e}(Xn),rr=function(t){function e(e,n){return t.call(this,e,\"in\",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ee(this.value.arrayValue,e)},e}(Xn),ir=function(t){function e(e,n){return t.call(this,e,\"not-in\",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&!ee(this.value.arrayValue,e)},e}(Xn),or=function(t){function e(e,n){return t.call(this,e,\"array-contains-any\",n)||this}return r.__extends(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!he(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return ee(e.value.arrayValue,t)}))},e}(Xn),sr=function(t,e){this.position=t,this.before=e};function ur(t){return(t.before?\"b\":\"a\")+\":\"+t.position.map((function(t){return ie(t)})).join(\",\")}function ar(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.p()?S.i(S.C(s.referenceValue),n.key):ne(s,n.field(o.field)),\"desc\"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function cr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!te(t.position[n],e.position[n]))return!1;return!0}var hr=function(t,e){void 0===e&&(e=\"asc\"),this.field=t,this.dir=e};function fr(t,e,n){var r=t.field.p()?S.i(e.key,n.key):function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?ne(r,i):m()}(t.field,e,n);switch(t.dir){case\"asc\":return r;case\"desc\":return-1*r;default:return m()}}function lr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var pr=function(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))},dr=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this._n=t,this.fn=e,this.dn=n,this.wn=r,this.mn=i,this.Tn=0,this.En=null,this.In=Date.now(),this.reset()}return t.prototype.reset=function(){this.Tn=0},t.prototype.An=function(){this.Tn=this.mn},t.prototype.Rn=function(t){var e=this;this.cancel();var n=Math.floor(this.Tn+this.Pn()),r=Math.max(0,Date.now()-this.In),i=Math.max(0,n-r);i>0&&d(\"ExponentialBackoff\",\"Backing off for \"+i+\" ms (base delay: \"+this.Tn+\" ms, delay with jitter: \"+n+\" ms, last attempt: \"+r+\" ms ago)\"),this.En=this._n.gn(this.fn,i,(function(){return e.In=Date.now(),t()})),this.Tn*=this.wn,this.Tn<this.dn&&(this.Tn=this.dn),this.Tn>this.mn&&(this.Tn=this.mn)},t.prototype.yn=function(){null!==this.En&&(this.En.Vn(),this.En=null)},t.prototype.cancel=function(){null!==this.En&&(this.En.cancel(),this.En=null)},t.prototype.Pn=function(){return(Math.random()-.5)*this.Tn},t}(),vr=function(){function t(t){var e=this;this.pn=null,this.bn=null,this.result=void 0,this.error=void 0,this.vn=!1,this.Sn=!1,t((function(t){e.vn=!0,e.result=t,e.pn&&e.pn(t)}),(function(t){e.vn=!0,e.error=t,e.bn&&e.bn(t)}))}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.Sn&&m(),this.Sn=!0,this.vn?this.error?this.Dn(n,this.error):this.Cn(e,this.result):new t((function(t,i){r.pn=function(n){r.Cn(e,n).next(t,i)},r.bn=function(e){r.Dn(n,e).next(t,i)}}))},t.prototype.Nn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},t.prototype.Fn=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.Cn=function(e,n){return e?this.Fn((function(){return e(n)})):t.resolve(n)},t.prototype.Dn=function(e,n){return e?this.Fn((function(){return e(n)})):t.reject(n)},t.resolve=function(e){return new t((function(t,n){t(e)}))},t.reject=function(e){return new t((function(t,n){n(e)}))},t.$n=function(e){return new t((function(t,n){var r=0,i=0,o=!1;e.forEach((function(e){++r,e.next((function(){++i,o&&i===r&&t()}),(function(t){return n(t)}))})),o=!0,i===r&&t()}))},t.xn=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next((function(n){return n?t.resolve(n):e()}))},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.$n(r)},t}(),yr=function(){function e(t,n,r){this.name=t,this.version=n,this.kn=r,12.2===e.Mn(s.getUA())&&v(\"Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\")}return e.delete=function(t){return d(\"SimpleDb\",\"Removing database:\",t),Ir(window.indexedDB.deleteDatabase(t)).Nn()},e.On=function(){if(\"undefined\"==typeof indexedDB)return!1;if(e.Ln())return!0;var t=s.getUA(),n=e.Mn(t),r=0<n&&n<10,i=e.Bn(t),o=0<i&&i<4.5;return!(t.indexOf(\"MSIE \")>0||t.indexOf(\"Trident/\")>0||t.indexOf(\"Edge/\")>0||r||o)},e.Ln=function(){var e;return\"undefined\"!=typeof t&&\"YES\"===(null===(e=t.env)||void 0===e?void 0:e.qn)},e.Un=function(t,e){return t.store(e)},e.Mn=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\\d_]+)/i),n=e?e[1].split(\"_\").slice(0,2).join(\".\"):\"-1\";return Number(n)},e.Bn=function(t){var e=t.match(/Android ([\\d.]+)/i),n=e?e[1].split(\".\").slice(0,2).join(\".\"):\"-1\";return Number(n)},e.prototype.Qn=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){switch(n.label){case 0:return this.db?[3,2]:(d(\"SimpleDb\",\"Opening database:\",this.name),t=this,[4,new Promise((function(t,n){var r=indexedDB.open(e.name,e.version);r.onsuccess=function(e){var n=e.target.result;t(n)},r.onblocked=function(){n(new mr(\"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed.\"))},r.onerror=function(t){var e=t.target.error;\"VersionError\"===e.name?n(new f(h.FAILED_PRECONDITION,\"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.\")):n(new mr(e))},r.onupgradeneeded=function(t){d(\"SimpleDb\",'Database \"'+e.name+'\" requires upgrade from version:',t.oldVersion);var n=t.target.result;e.kn.createOrUpgrade(n,r.transaction,t.oldVersion,e.version).next((function(){d(\"SimpleDb\",\"Database upgrade to version \"+e.version+\" complete\")}))}}))]);case 1:t.db=n.sent(),n.label=2;case 2:return[2,(this.Wn&&(this.db.onversionchange=function(t){return e.Wn(t)}),this.db)]}}))}))},e.prototype.jn=function(t){this.Wn=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},e.prototype.runTransaction=function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u,a;return r.__generator(this,(function(c){switch(c.label){case 0:i=\"readonly\"===t,o=0,s=function(){var t,s,a,c,h;return r.__generator(this,(function(r){switch(r.label){case 0:++o,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,u.Qn()];case 2:return u.db=r.sent(),t=_r.open(u.db,i?\"readonly\":\"readwrite\",e),s=n(t).catch((function(e){return t.abort(e),vr.reject(e)})).Nn(),a={},s.catch((function(){})),[4,t.Kn];case 3:return[2,(a.value=(r.sent(),s),a)];case 4:return c=r.sent(),h=\"FirebaseError\"!==c.name&&o<3,d(\"SimpleDb\",\"Transaction failed with error: %s. Retrying: %s.\",c.message,h),u.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}}))},u=this,c.label=1;case 1:return[5,s()];case 2:if(\"object\"==typeof(a=c.sent()))return[2,a.value];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e}(),gr=function(){function t(t){this.Gn=t,this.zn=!1,this.Hn=null}return Object.defineProperty(t.prototype,\"vn\",{get:function(){return this.zn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"Yn\",{get:function(){return this.Hn},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"cursor\",{set:function(t){this.Gn=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.zn=!0},t.prototype.Jn=function(t){this.Hn=t},t.prototype.delete=function(){return Ir(this.Gn.delete())},t}(),mr=function(t){function e(e){var n=this;return(n=t.call(this,h.UNAVAILABLE,\"IndexedDB transaction failed: \"+e)||this).name=\"IndexedDbTransactionError\",n}return r.__extends(e,t),e}(f);function wr(t){return\"IndexedDbTransactionError\"===t.name}var _r=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.Xn=new pr,this.transaction.oncomplete=function(){e.Xn.resolve()},this.transaction.onabort=function(){t.error?e.Xn.reject(new mr(t.error)):e.Xn.resolve()},this.transaction.onerror=function(t){var n=Tr(t.target.error);e.Xn.reject(new mr(n))}}return t.open=function(e,n,r){try{return new t(e.transaction(r,n))}catch(e){throw new mr(e)}},Object.defineProperty(t.prototype,\"Kn\",{get:function(){return this.Xn.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.Xn.reject(t),this.aborted||(d(\"SimpleDb\",\"Aborting transaction:\",t?t.message:\"Client-initiated abort\"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new br(e)},t}(),br=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(d(\"SimpleDb\",\"PUT\",this.store.name,t,e),n=this.store.put(e,t)):(d(\"SimpleDb\",\"PUT\",this.store.name,\"<auto-key>\",t),n=this.store.put(t)),Ir(n)},t.prototype.add=function(t){return d(\"SimpleDb\",\"ADD\",this.store.name,t,t),Ir(this.store.add(t))},t.prototype.get=function(t){var e=this;return Ir(this.store.get(t)).next((function(n){return void 0===n&&(n=null),d(\"SimpleDb\",\"GET\",e.store.name,t,n),n}))},t.prototype.delete=function(t){return d(\"SimpleDb\",\"DELETE\",this.store.name,t),Ir(this.store.delete(t))},t.prototype.count=function(){return d(\"SimpleDb\",\"COUNT\",this.store.name),Ir(this.store.count())},t.prototype.Zn=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.ts(n,(function(t,e){r.push(e)})).next((function(){return r}))},t.prototype.es=function(t,e){d(\"SimpleDb\",\"DELETE ALL\",this.store.name);var n=this.options(t,e);n.ns=!1;var r=this.cursor(n);return this.ts(r,(function(t,e,n){return n.delete()}))},t.prototype.ss=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.ts(r,e)},t.prototype.rs=function(t){var e=this.cursor({});return new vr((function(n,r){e.onerror=function(t){var e=Tr(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},t.prototype.ts=function(t,e){var n=[];return new vr((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new gr(i),s=e(i.primaryKey,i.value,o);if(s instanceof vr){var u=s.catch((function(t){return o.done(),vr.reject(t)}));n.push(u)}o.vn?r():null===o.Yn?i.continue():i.continue(o.Yn)}else r()}})).next((function(){return vr.$n(n)}))},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&(\"string\"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e=\"next\";if(t.reverse&&(e=\"prev\"),t.index){var n=this.store.index(t.index);return t.ns?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Ir(t){return new vr((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=Tr(t.target.error);n(e)}}))}var Er=!1;function Tr(t){var e=yr.Mn(s.getUA());if(e>=12.2&&e<13){var n=\"An internal error was encountered in the Indexed Database server\";if(t.message.indexOf(n)>=0){var r=new f(\"internal\",\"IOS_INDEXEDDB_BUG1: IndexedDb has thrown '\"+n+\"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.\");return Er||(Er=!0,setTimeout((function(){throw r}),0)),r}}return t}function Ar(){return\"undefined\"!=typeof window?window:null}function Nr(){return\"undefined\"!=typeof document?document:null}var Dr=function(){function t(t,e,n,r,i){this.os=t,this.fn=e,this.cs=n,this.op=r,this.us=i,this.hs=new pr,this.then=this.hs.promise.then.bind(this.hs.promise),this.hs.promise.catch((function(t){}))}return t.ls=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this._s=setTimeout((function(){return e.fs()}),t)},t.prototype.Vn=function(){return this.fs()},t.prototype.cancel=function(t){null!==this._s&&(this.clearTimeout(),this.hs.reject(new f(h.CANCELLED,\"Operation cancelled\"+(t?\": \"+t:\"\"))))},t.prototype.fs=function(){var t=this;this.os.ds((function(){return null!==t._s?(t.clearTimeout(),t.op().then((function(e){return t.hs.resolve(e)}))):Promise.resolve()}))},t.prototype.clearTimeout=function(){null!==this._s&&(this.us(this),clearTimeout(this._s),this._s=null)},t}(),Sr=function(){function t(){var t=this;this.ws=Promise.resolve(),this.Ts=[],this.Es=!1,this.Is=[],this.As=null,this.Rs=!1,this.Ps=[],this.gs=new dr(this,\"async_queue_retry\"),this.ys=function(){var e=Nr();e&&d(\"AsyncQueue\",\"Visibility state changed to  \",e.visibilityState),t.gs.yn()};var e=Nr();e&&\"function\"==typeof e.addEventListener&&e.addEventListener(\"visibilitychange\",this.ys)}return Object.defineProperty(t.prototype,\"Vs\",{get:function(){return this.Es},enumerable:!1,configurable:!0}),t.prototype.ds=function(t){this.enqueue(t)},t.prototype.ps=function(t){this.bs(),this.vs(t)},t.prototype.Ss=function(){if(!this.Es){this.Es=!0;var t=Nr();t&&\"function\"==typeof t.removeEventListener&&t.removeEventListener(\"visibilitychange\",this.ys)}},t.prototype.enqueue=function(t){return this.bs(),this.Es?new Promise((function(t){})):this.vs(t)},t.prototype.Ds=function(t){var e=this;this.Ts.push(t),this.ds((function(){return e.Cs()}))},t.prototype.Cs=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){switch(n.label){case 0:if(0===this.Ts.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.Ts[0]()];case 2:return n.sent(),this.Ts.shift(),this.gs.reset(),[3,4];case 3:if(!wr(t=n.sent()))throw t;return d(\"AsyncQueue\",\"Operation failed with retryable error: \"+t),[3,4];case 4:this.Ts.length>0&&this.gs.Rn((function(){return e.Cs()})),n.label=5;case 5:return[2]}}))}))},t.prototype.vs=function(t){var e=this,n=this.ws.then((function(){return e.Rs=!0,t().catch((function(t){throw e.As=t,e.Rs=!1,v(\"INTERNAL UNHANDLED ERROR: \",function(t){var e=t.message||\"\";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+\"\\n\"+t.stack),e}(t)),t})).then((function(t){return e.Rs=!1,t}))}));return this.ws=n,n},t.prototype.gn=function(t,e,n){var r=this;this.bs(),this.Ps.indexOf(t)>-1&&(e=0);var i=Dr.ls(this,t,e,n,(function(t){return r.Ns(t)}));return this.Is.push(i),i},t.prototype.bs=function(){this.As&&m()},t.prototype.Fs=function(){},t.prototype.$s=function(){return r.__awaiter(this,void 0,void 0,(function(){var t;return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t=this.ws];case 1:e.sent(),e.label=2;case 2:if(t!==this.ws)return[3,0];e.label=3;case 3:return[2]}}))}))},t.prototype.xs=function(t){for(var e=0,n=this.Is;e<n.length;e++)if(n[e].fn===t)return!0;return!1},t.prototype.ks=function(t){var e=this;return this.$s().then((function(){e.Is.sort((function(t,e){return t.cs-e.cs}));for(var n=0,r=e.Is;n<r.length;n++){var i=r[n];if(i.Vn(),\"all\"!==t&&i.fn===t)break}return e.$s()}))},t.prototype.Ms=function(t){this.Ps.push(t)},t.prototype.Ns=function(t){var e=this.Is.indexOf(t);this.Is.splice(e,1)},t}();function xr(t,e){if(v(\"AsyncQueue\",e+\": \"+t),wr(t))return new f(h.UNAVAILABLE,e+\": \"+t);throw t}var kr=function(){this.Os=void 0,this.listeners=[]},Lr=function(){this.Ls=new st((function(t){return Kn(t)}),Wn),this.onlineState=\"Unknown\",this.Bs=new Set};function Rr(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c;return r.__generator(this,(function(r){switch(r.label){case 0:if(n=_(t),i=e.query,o=!1,(s=n.Ls.get(i))||(o=!0,s=new kr),!o)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),u=s,[4,n.qs(i)];case 2:return u.Os=r.sent(),[3,4];case 3:return a=r.sent(),c=xr(a,\"Initialization of query '\"+Hn(e.query)+\"' failed\"),[2,void e.onError(c)];case 4:return n.Ls.set(i,s),s.listeners.push(e),e.Us(n.onlineState),s.Os&&e.Qs(s.Os)&&Cr(n),[2]}}))}))}function Or(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u;return r.__generator(this,(function(r){return n=_(t),i=e.query,o=!1,(s=n.Ls.get(i))&&(u=s.listeners.indexOf(e))>=0&&(s.listeners.splice(u,1),o=0===s.listeners.length),o?[2,(n.Ls.delete(i),n.Ws(i))]:[2]}))}))}function Ur(t,e){for(var n=_(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],u=s.query,a=n.Ls.get(u);if(a){for(var c=0,h=a.listeners;c<h.length;c++)h[c].Qs(s)&&(r=!0);a.Os=s}}r&&Cr(n)}function Pr(t,e,n){var r=_(t),i=r.Ls.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.Ls.delete(e)}function Vr(t,e){var n=_(t);n.onlineState=e;var r=!1;n.Ls.forEach((function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].Us(e)&&(r=!0)})),r&&Cr(n)}function Cr(t){t.Bs.forEach((function(t){t.next()}))}var Mr=function(){function t(t,e,n){this.query=t,this.js=e,this.Ks=!1,this.Gs=null,this.onlineState=\"Unknown\",this.options=n||{}}return t.prototype.Qs=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new qt(t.query,t.docs,t.Ut,e,t.Qt,t.fromCache,t.Wt,!0)}var o=!1;return this.Ks?this.zs(t)&&(this.js.next(t),o=!0):this.Hs(t,this.onlineState)&&(this.Ys(t),o=!0),this.Gs=t,o},t.prototype.onError=function(t){this.js.error(t)},t.prototype.Us=function(t){this.onlineState=t;var e=!1;return this.Gs&&!this.Ks&&this.Hs(this.Gs,t)&&(this.Ys(this.Gs),e=!0),e},t.prototype.Hs=function(t,e){if(!t.fromCache)return!0;var n=\"Offline\"!==e;return!(this.options.Js&&n||t.docs.m()&&\"Offline\"!==e)},t.prototype.zs=function(t){if(t.docChanges.length>0)return!0;var e=this.Gs&&this.Gs.hasPendingWrites!==t.hasPendingWrites;return!(!t.Wt&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.Ys=function(t){t=qt.Kt(t.query,t.docs,t.Qt,t.fromCache),this.Ks=!0,this.js.next(t)},t}(),Fr=function(){function t(t){this.uid=t}return t.prototype.Xs=function(){return null!=this.uid},t.prototype.Zs=function(){return this.Xs()?\"uid:\"+this.uid:\"anonymous-user\"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();Fr.UNAUTHENTICATED=new Fr(null),Fr.ti=new Fr(\"google-credentials-uid\"),Fr.ei=new Fr(\"first-party-uid\");var qr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.ni=function(t){return n.si(t)},this.ii=function(t){return e.ri(t)})}return t.prototype.si=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.ii&&this.ii(t),t},t}();function jr(t,e){return\"firestore_clients_\"+t+\"_\"+e}function zr(t,e,n){var r=\"firestore_mutations_\"+t+\"_\"+n;return e.Xs()&&(r+=\"_\"+e.uid),r}function Br(t,e){return\"firestore_targets_\"+t+\"_\"+e}qr.oi=-1;var Gr=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.ai=function(e,n,r){var i=JSON.parse(r),o=\"object\"==typeof i&&-1!==[\"pending\",\"acknowledged\",\"rejected\"].indexOf(i.state)&&(void 0===i.error||\"object\"==typeof i.error),s=void 0;return o&&i.error&&(o=\"string\"==typeof i.error.message&&\"string\"==typeof i.error.code)&&(s=new f(i.error.code,i.error.message)),o?new t(e,n,i.state,s):(v(\"SharedClientState\",\"Failed to parse mutation state for ID '\"+n+\"': \"+r),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Qr=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.ai=function(e,n){var r=JSON.parse(n),i=\"object\"==typeof r&&-1!==[\"not-current\",\"current\",\"rejected\"].indexOf(r.state)&&(void 0===r.error||\"object\"==typeof r.error),o=void 0;return i&&r.error&&(i=\"string\"==typeof r.error.message&&\"string\"==typeof r.error.code)&&(o=new f(r.error.code,r.error.message)),i?new t(e,r.state,o):(v(\"SharedClientState\",\"Failed to parse target state for ID '\"+e+\"': \"+n),null)},t.prototype.ci=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Wr=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.ai=function(e,n){for(var r=JSON.parse(n),i=\"object\"==typeof r&&r.activeTargetIds instanceof Array,o=Ct(),s=0;i&&s<r.activeTargetIds.length;++s)i=ft(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(v(\"SharedClientState\",\"Failed to parse client data for instance '\"+e+\"': \"+n),null)},t}(),Kr=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.ai=function(e){var n=JSON.parse(e);return\"object\"==typeof n&&-1!==[\"Unknown\",\"Online\",\"Offline\"].indexOf(n.onlineState)&&\"string\"==typeof n.clientId?new t(n.clientId,n.onlineState):(v(\"SharedClientState\",\"Failed to parse online state: \"+e),null)},t}(),Hr=function(){function t(){this.activeTargetIds=Ct()}return t.prototype.ui=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.hi=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.ci=function(){var t={activeTargetIds:this.activeTargetIds.A(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Yr=function(){function t(t,e,n,r,i){this.window=t,this._n=e,this.persistenceKey=n,this.li=r,this._i=null,this.fi=null,this.ni=null,this.di=this.wi.bind(this),this.mi=new Et($),this.Ti=!1,this.Ei=[];var o=n.replace(/[.*+?^${}()|[\\]\\\\]/g,\"\\\\$&\");this.storage=this.window.localStorage,this.currentUser=i,this.Ii=jr(this.persistenceKey,this.li),this.Ai=function(t){return\"firestore_sequence_number_\"+t}(this.persistenceKey),this.mi=this.mi.rt(this.li,new Hr),this.Ri=new RegExp(\"^firestore_clients_\"+o+\"_([^_]*)$\"),this.Pi=new RegExp(\"^firestore_mutations_\"+o+\"_(\\\\d+)(?:_(.*))?$\"),this.gi=new RegExp(\"^firestore_targets_\"+o+\"_(\\\\d+)$\"),this.yi=function(t){return\"firestore_online_state_\"+t}(this.persistenceKey),this.window.addEventListener(\"storage\",this.di)}return t.On=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e,n,i,o,s,u,a,c,h,f,l=this;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,this._i.Vi()];case 1:for(t=r.sent(),e=0,n=t;e<n.length;e++)(i=n[e])!==this.li&&(o=this.getItem(jr(this.persistenceKey,i)))&&(s=Wr.ai(i,o))&&(this.mi=this.mi.rt(s.clientId,s));for(this.pi(),(u=this.storage.getItem(this.yi))&&(a=this.bi(u))&&this.vi(a),c=0,h=this.Ei;c<h.length;c++)f=h[c],this.wi(f);return this.Ei=[],this.window.addEventListener(\"unload\",(function(){return l.Si()})),this.Ti=!0,[2]}}))}))},t.prototype.ri=function(t){this.setItem(this.Ai,JSON.stringify(t))},t.prototype.Di=function(){return this.Ci(this.mi)},t.prototype.Ni=function(t){var e=!1;return this.mi.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},t.prototype.Fi=function(t){this.$i(t,\"pending\")},t.prototype.xi=function(t,e,n){this.$i(t,e,n),this.ki(t)},t.prototype.Mi=function(t){var e=\"not-current\";if(this.Ni(t)){var n=this.storage.getItem(Br(this.persistenceKey,t));if(n){var r=Qr.ai(t,n);r&&(e=r.state)}}return this.Oi.ui(t),this.pi(),e},t.prototype.Li=function(t){this.Oi.hi(t),this.pi()},t.prototype.Bi=function(t){return this.Oi.activeTargetIds.has(t)},t.prototype.qi=function(t){this.removeItem(Br(this.persistenceKey,t))},t.prototype.Ui=function(t,e,n){this.Qi(t,e,n)},t.prototype.Wi=function(t,e,n){var r=this;e.forEach((function(t){r.ki(t)})),this.currentUser=t,n.forEach((function(t){r.Fi(t)}))},t.prototype.ji=function(t){this.Ki(t)},t.prototype.Si=function(){this.Ti&&(this.window.removeEventListener(\"storage\",this.di),this.removeItem(this.Ii),this.Ti=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return d(\"SharedClientState\",\"READ\",t,e),e},t.prototype.setItem=function(t,e){d(\"SharedClientState\",\"SET\",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){d(\"SharedClientState\",\"REMOVE\",t),this.storage.removeItem(t)},t.prototype.wi=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(d(\"SharedClientState\",\"EVENT\",n.key,n.newValue),n.key===this.Ii)return void v(\"Received WebStorage notification for local change. Another client might have garbage-collected our state\");this._n.Ds((function(){return r.__awaiter(e,void 0,void 0,(function(){var t,e,i,o,s,u;return r.__generator(this,(function(r){if(this.Ti){if(null!==n.key)if(this.Ri.test(n.key)){if(null==n.newValue)return t=this.Gi(n.key),[2,this.zi(t,null)];if(e=this.Hi(n.key,n.newValue))return[2,this.zi(e.clientId,e)]}else if(this.Pi.test(n.key)){if(null!==n.newValue&&(i=this.Yi(n.key,n.newValue)))return[2,this.Ji(i)]}else if(this.gi.test(n.key)){if(null!==n.newValue&&(o=this.Xi(n.key,n.newValue)))return[2,this.Zi(o)]}else if(n.key===this.yi){if(null!==n.newValue&&(s=this.bi(n.newValue)))return[2,this.vi(s)]}else n.key===this.Ai&&(u=function(t){var e=qr.oi;if(null!=t)try{var n=JSON.parse(t);w(\"number\"==typeof n),e=n}catch(t){v(\"SharedClientState\",\"Failed to read sequence number from WebStorage\",t)}return e}(n.newValue))!==qr.oi&&this.ni(u)}else this.Ei.push(n);return[2]}))}))}))}},Object.defineProperty(t.prototype,\"Oi\",{get:function(){return this.mi.get(this.li)},enumerable:!1,configurable:!0}),t.prototype.pi=function(){this.setItem(this.Ii,this.Oi.ci())},t.prototype.$i=function(t,e,n){var r=new Gr(this.currentUser,t,e,n),i=zr(this.persistenceKey,this.currentUser,t);this.setItem(i,r.ci())},t.prototype.ki=function(t){var e=zr(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Ki=function(t){var e={clientId:this.li,onlineState:t};this.storage.setItem(this.yi,JSON.stringify(e))},t.prototype.Qi=function(t,e,n){var r=Br(this.persistenceKey,t),i=new Qr(t,e,n);this.setItem(r,i.ci())},t.prototype.Gi=function(t){var e=this.Ri.exec(t);return e?e[1]:null},t.prototype.Hi=function(t,e){var n=this.Gi(t);return Wr.ai(n,e)},t.prototype.Yi=function(t,e){var n=this.Pi.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Gr.ai(new Fr(i),r,e)},t.prototype.Xi=function(t,e){var n=this.gi.exec(t),r=Number(n[1]);return Qr.ai(r,e)},t.prototype.bi=function(t){return Kr.ai(t)},t.prototype.Ji=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this._i.tr(t.batchId,t.state,t.error)]:(d(\"SharedClientState\",\"Ignoring mutation for non-active user \"+t.user.uid),[2])}))}))},t.prototype.Zi=function(t){return this._i.er(t.targetId,t.state,t.error)},t.prototype.zi=function(t,e){var n=this,r=e?this.mi.rt(t,e):this.mi.remove(t),i=this.Ci(this.mi),o=this.Ci(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this._i.nr(s,u).then((function(){n.mi=r}))},t.prototype.vi=function(t){this.mi.get(t.clientId)&&this.fi(t.onlineState)},t.prototype.Ci=function(t){var e=Ct();return t.forEach((function(t,n){e=e.xt(n.activeTargetIds)})),e},t}(),$r=function(){function t(){this.sr=new Hr,this.ir={},this.fi=null,this.ni=null}return t.prototype.Fi=function(t){},t.prototype.xi=function(t,e,n){},t.prototype.Mi=function(t){return this.sr.ui(t),this.ir[t]||\"not-current\"},t.prototype.Ui=function(t,e,n){this.ir[t]=e},t.prototype.Li=function(t){this.sr.hi(t)},t.prototype.Bi=function(t){return this.sr.activeTargetIds.has(t)},t.prototype.qi=function(t){delete this.ir[t]},t.prototype.Di=function(){return this.sr.activeTargetIds},t.prototype.Ni=function(t){return this.sr.activeTargetIds.has(t)},t.prototype.start=function(){return this.sr=new Hr,Promise.resolve()},t.prototype.Wi=function(t,e,n){},t.prototype.ji=function(t){},t.prototype.Si=function(){},t.prototype.ri=function(t){},t}(),Xr=function(){function t(t,e,n,r){this.batchId=t,this.rr=e,this.baseMutations=n,this.mutations=r}return t.prototype.ar=function(t,e,n){for(var r=n.cr,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=ln(o,e,r[i]))}return e},t.prototype.ur=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=pn(i,e,e,this.rr))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=pn(a,e,o,this.rr))}return e},t.prototype.hr=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.ur(r.key,t.get(r.key));i&&(n=n.rt(r.key,i))})),n},t.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),Pt())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&X(this.mutations,t.mutations,(function(t,e){return vn(t,e)}))&&X(this.baseMutations,t.baseMutations,(function(t,e){return vn(t,e)}))},t}(),Jr=function(){function t(t,e,n,r){this.batch=t,this.lr=e,this.cr=n,this._r=r}return t.from=function(e,n,r){w(e.mutations.length===r.length);for(var i=Ot,o=e.mutations,s=0;s<o.length;s++)i=i.rt(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Zr=function(){function t(){this.dr=new st((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),this.wr=!1}return Object.defineProperty(t.prototype,\"readTime\",{get:function(){return this.mr},set:function(t){this.mr=t},enumerable:!1,configurable:!0}),t.prototype.Tr=function(t,e){this.Er(),this.readTime=e,this.dr.set(t.key,t)},t.prototype.Ir=function(t,e){this.Er(),e&&(this.readTime=e),this.dr.set(t,null)},t.prototype.Ar=function(t,e){this.Er();var n=this.dr.get(e);return void 0!==n?vr.resolve(n):this.Rr(t,e)},t.prototype.getEntries=function(t,e){return this.Pr(t,e)},t.prototype.apply=function(t){return this.Er(),this.wr=!0,this.gr(t)},t.prototype.Er=function(){},t}(),ti=\"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.\",ei=function(){function t(){this.yr=[]}return t.prototype.Vr=function(t){this.yr.push(t)},t.prototype.pr=function(){this.yr.forEach((function(t){return t()}))},t}(),ni=function(){function t(t,e,n){this.br=t,this.vr=e,this.Sr=n}return t.prototype.Dr=function(t,e){var n=this;return this.vr.Cr(t,e).next((function(r){return n.Nr(t,e,r)}))},t.prototype.Nr=function(t,e,n){return this.br.Ar(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].ur(e,t);return t}))},t.prototype.Fr=function(t,e,n){var r=kt();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].ur(t,e);r=r.rt(t,e)})),r},t.prototype.$r=function(t,e){var n=this;return this.br.getEntries(t,e).next((function(e){return n.kr(t,e)}))},t.prototype.kr=function(t,e){var n=this;return this.vr.Mr(t,e).next((function(r){var i=n.Fr(t,e,r),o=xt();return i.forEach((function(t,e){e||(e=new kn(t,at.min())),o=o.rt(t,e)})),o}))},t.prototype.Or=function(t,e,n){return function(t){return S.F(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Lr(t,e.path):qn(e)?this.Br(t,e,n):this.qr(t,e,n)},t.prototype.Lr=function(t,e){return this.Dr(t,new S(e)).next((function(t){var e=Rt();return t instanceof xn&&(e=e.rt(t.key,t)),e}))},t.prototype.Br=function(t,e,n){var r=this,i=e.collectionGroup,o=Rt();return this.Sr.Ur(t,i).next((function(s){return vr.forEach(s,(function(s){var u=function(t,e){return new On(e,null,t.rn.slice(),t.filters.slice(),t.limit,t.on,t.startAt,t.endAt)}(e,s.child(i));return r.qr(t,u,n).next((function(t){t.forEach((function(t,e){o=o.rt(t,e)}))}))})).next((function(){return o}))}))},t.prototype.qr=function(t,e,n){var r,i,o=this;return this.br.Or(t,e,n).next((function(n){return r=n,o.vr.Qr(t,e)})).next((function(e){return i=e,o.Wr(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],c=a.key,h=r.get(c),f=pn(a,h,h,o.rr);r=f instanceof xn?r.rt(c,f):r.remove(c)}}))})).next((function(){return r.forEach((function(t,n){Yn(e,n)||(r=r.remove(t))})),r}))},t.prototype.Wr=function(t,e,n){for(var r=Pt(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof mn&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.br.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof xn&&(c=c.rt(t,e))})),c}))},t}(),ri=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.jr=n,this.Kr=r}return t.Gr=function(e,n){for(var r=Pt(),i=Pt(),o=0,s=n.docChanges;o<s.length;o++){var u=s[o];switch(u.type){case 0:r=r.add(u.doc.key);break;case 1:i=i.add(u.doc.key)}}return new t(e,n.fromCache,r,i)},t}();function ii(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=$(n,i);return 0===s?$(r,o):s}var oi=function(){function t(t){this.zr=t,this.buffer=new Nt(ii),this.Hr=0}return t.prototype.Yr=function(){return++this.Hr},t.prototype.Jr=function(t){var e=[t,this.Yr()];if(this.buffer.size<this.zr)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();ii(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,\"maxValue\",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),si={Xr:!1,Zr:0,eo:0,no:0},ui=function(){function t(t,e,n){this.so=t,this.io=e,this.ro=n}return t.oo=function(e){return new t(e,t.ao,t.co)},t}();ui.uo=-1,ui.ho=1048576,ui.lo=41943040,ui.ao=10,ui.co=1e3,ui._o=new ui(ui.lo,ui.ao,ui.co),ui.fo=new ui(ui.uo,0,0);var ai=function(){function t(t,e){this.do=t,this.os=e,this.wo=!1,this.mo=null}return t.prototype.start=function(t){this.do.params.so!==ui.uo&&this.To(t)},t.prototype.stop=function(){this.mo&&(this.mo.cancel(),this.mo=null)},Object.defineProperty(t.prototype,\"Ti\",{get:function(){return null!==this.mo},enumerable:!1,configurable:!0}),t.prototype.To=function(t){var e=this,n=this.wo?3e5:6e4;d(\"LruGarbageCollector\",\"Garbage collection scheduled in \"+n+\"ms\"),this.mo=this.os.gn(\"lru_garbage_collection\",n,(function(){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:this.mo=null,this.wo=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Eo(this.do)];case 2:return n.sent(),[3,7];case 3:return wr(e=n.sent())?(d(\"LruGarbageCollector\",\"Ignoring IndexedDB error during garbage collection: \",e),[3,6]):[3,4];case 4:return[4,Ao(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.To(t)];case 8:return n.sent(),[2]}}))}))}))},t}(),ci=function(){function t(t,e){this.Io=t,this.params=e}return t.prototype.Ao=function(t,e){return this.Io.Ro(t).next((function(t){return Math.floor(e/100*t)}))},t.prototype.Po=function(t,e){var n=this;if(0===e)return vr.resolve(qr.oi);var r=new oi(e);return this.Io.De(t,(function(t){return r.Jr(t.sequenceNumber)})).next((function(){return n.Io.yo(t,(function(t){return r.Jr(t)}))})).next((function(){return r.maxValue}))},t.prototype.Vo=function(t,e,n){return this.Io.Vo(t,e,n)},t.prototype.po=function(t,e){return this.Io.po(t,e)},t.prototype.bo=function(t,e){var n=this;return this.params.so===ui.uo?(d(\"LruGarbageCollector\",\"Garbage collection skipped; disabled\"),vr.resolve(si)):this.vo(t).next((function(r){return r<n.params.so?(d(\"LruGarbageCollector\",\"Garbage collection skipped; Cache size \"+r+\" is lower than threshold \"+n.params.so),si):n.So(t,e)}))},t.prototype.vo=function(t){return this.Io.vo(t)},t.prototype.So=function(t,e){var n,r,i,s,u,a,c,h=this,f=Date.now();return this.Ao(t,this.params.io).next((function(e){return e>h.params.ro?(d(\"LruGarbageCollector\",\"Capping sequence numbers to collect down to the maximum of \"+h.params.ro+\" from \"+e),r=h.params.ro):r=e,s=Date.now(),h.Po(t,r)})).next((function(r){return n=r,u=Date.now(),h.Vo(t,n,e)})).next((function(e){return i=e,a=Date.now(),h.po(t,n)})).next((function(t){return c=Date.now(),p()<=o.LogLevel.DEBUG&&d(\"LruGarbageCollector\",\"LRU Garbage Collection\\n\\tCounted targets in \"+(s-f)+\"ms\\n\\tDetermined least recently used \"+r+\" in \"+(u-s)+\"ms\\n\\tRemoved \"+i+\" targets in \"+(a-u)+\"ms\\n\\tRemoved \"+t+\" documents in \"+(c-a)+\"ms\\nTotal Duration: \"+(c-f)+\"ms\"),vr.resolve({Xr:!0,Zr:r,eo:i,no:t})}))},t}();function hi(t){for(var e=\"\",n=0;n<t.length;n++)e.length>0&&(e=li(e)),e=fi(t.get(n),e);return li(e)}function fi(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case\"\\0\":n+=\"\\x01\\x10\";break;case\"\\x01\":n+=\"\\x01\\x11\";break;default:n+=o}}return n}function li(t){return t+\"\\x01\\x01\"}function pi(t){var e=t.length;if(w(e>=2),2===e)return w(\"\\x01\"===t.charAt(0)&&\"\\x01\"===t.charAt(1)),A.g();for(var n=e-2,r=[],i=\"\",o=0;o<e;){var s=t.indexOf(\"\\x01\",o);switch((s<0||s>n)&&m(),t.charAt(s+1)){case\"\\x01\":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=\"\"),r.push(a);break;case\"\\x10\":i+=t.substring(o,s),i+=\"\\0\";break;case\"\\x11\":i+=t.substring(o,s+1);break;default:m()}o=s+2}return new A(r)}var di=function(t){this.Do=t};function vi(t,e){if(e.document)return function(t,e,n){var r=De(t,e.name),i=Ee(e.updateTime),o=new An({mapValue:{fields:e.fields}});return new xn(r,i,o,{hasCommittedMutations:!!n})}(t.Do,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=S.$(e.noDocument.path),r=_i(e.noDocument.readTime);return new kn(n,r,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var i=S.$(e.unknownDocument.path),o=_i(e.unknownDocument.version);return new Ln(i,o)}return m()}function yi(t,e,n){var r=gi(n),i=e.key.path.h().A();if(e instanceof xn){var o=function(t,e){return{name:Ne(t,e.key),fields:e.sn().mapValue.fields,updateTime:_e(t,e.version.X())}}(t.Do,e),s=e.hasCommittedMutations;return new Qi(null,null,o,s,r,i)}if(e instanceof kn){var u=e.key.path.A(),a=wi(e.version),c=e.hasCommittedMutations;return new Qi(null,new Bi(u,a),null,c,r,i)}if(e instanceof Ln){var h=e.key.path.A(),f=wi(e.version);return new Qi(new Gi(h,f),null,null,!0,r,i)}return m()}function gi(t){var e=t.X();return[e.seconds,e.nanoseconds]}function mi(t){var e=new ut(t[0],t[1]);return at.Y(e)}function wi(t){var e=t.X();return new Mi(e.seconds,e.nanoseconds)}function _i(t){var e=new ut(t.seconds,t.nanoseconds);return at.Y(e)}function bi(t,e){var n=(e.baseMutations||[]).map((function(e){return Ue(t.Do,e)})),r=e.mutations.map((function(e){return Ue(t.Do,e)})),i=ut.fromMillis(e.localWriteTimeMs);return new Xr(e.batchId,i,n,r)}function Ii(t){var e,n,r=_i(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?_i(t.lastLimboFreeSnapshotVersion):at.min();return void 0!==t.query.documents?(w(1===(n=t.query).documents.length),e=zn(Pn(xe(n.documents[0])))):e=function(t){var e=xe(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){w(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[Ge(e)]:void 0!==e.fieldFilter?[Be(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return t(e)})).reduce((function(t,e){return t.concat(e)})):m():[]}(n.where));var u=[];n.orderBy&&(u=n.orderBy.map((function(t){return function(t){return new hr(ze(t.field),function(t){switch(t){case\"ASCENDING\":return\"asc\";case\"DESCENDING\":return\"desc\";default:return}}(t.direction))}(t)})));var a=null;n.limit&&(a=function(t){var e;return ct(e=\"object\"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=Me(n.startAt));var h=null;return n.endAt&&(h=Me(n.endAt)),zn(Un(e,i,u,s,a,\"F\",c,h))}(t.query),new wt(e,t.targetId,0,t.lastListenSequenceNumber,r,i,Z.fromBase64String(t.resumeToken))}function Ei(t,e){var n,r=wi(e.et),i=wi(e.lastLimboFreeSnapshotVersion);n=yt(e.target)?Pe(t.Do,e.target):Ve(t.Do,e.target);var o=e.resumeToken.toBase64();return new Ki(e.targetId,dt(e.target),r,o,e.sequenceNumber,i,n)}var Ti=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.Sr=n,this.Co=r,this.No={}}return t.Fo=function(e,n,r,i){return w(\"\"!==e.uid),new t(e.Xs()?e.uid:\"\",n,r,i)},t.prototype.$o=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Di(t).ss({index:ji.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},t.prototype.xo=function(t,e,n,r){var i=this,o=Si(t),s=Di(t);return s.add({}).next((function(u){w(\"number\"==typeof u);for(var a=new Xr(u,e,n,r),c=function(t,e,n){var r=n.baseMutations.map((function(e){return Oe(t.Do,e)})),i=n.mutations.map((function(e){return Oe(t.Do,e)}));return new ji(e,n.batchId,n.rr.toMillis(),r,i)}(i.serializer,i.userId,a),h=[],f=new Nt((function(t,e){return $(t.R(),e.R())})),l=0,p=r;l<p.length;l++){var d=p[l],v=zi.key(i.userId,d.key.path,u);f=f.add(d.key.path.h()),h.push(s.put(c)),h.push(o.put(v,zi.PLACEHOLDER))}return f.forEach((function(e){h.push(i.Sr.ko(t,e))})),t.Vr((function(){i.No[u]=a.keys()})),vr.$n(h).next((function(){return a}))}))},t.prototype.Mo=function(t,e){var n=this;return Di(t).get(e).next((function(t){return t?(w(t.userId===n.userId),bi(n.serializer,t)):null}))},t.prototype.Oo=function(t,e){var n=this;return this.No[e]?vr.resolve(this.No[e]):this.Mo(t,e).next((function(t){if(t){var r=t.keys();return n.No[e]=r,r}return null}))},t.prototype.Lo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return Di(t).ss({index:ji.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(w(e.batchId>=r),o=bi(n.serializer,e)),i.done()})).next((function(){return o}))},t.prototype.Bo=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Di(t).ss({index:ji.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},t.prototype.qo=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Di(t).Zn(ji.userMutationsIndex,n).next((function(t){return t.map((function(t){return bi(e.serializer,t)}))}))},t.prototype.Cr=function(t,e){var n=this,r=zi.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Si(t).ss({range:i},(function(r,i,s){var u=r[0],a=r[1],c=r[2],h=pi(a);if(u===n.userId&&e.path.isEqual(h))return Di(t).get(c).next((function(t){if(!t)throw m();w(t.userId===n.userId),o.push(bi(n.serializer,t))}));s.done()})).next((function(){return o}))},t.prototype.Mr=function(t,e){var n=this,r=new Nt($),i=[];return e.forEach((function(e){var o=zi.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Si(t).ss({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],c=pi(u);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()}));i.push(u)})),vr.$n(i).next((function(){return n.Uo(t,r)}))},t.prototype.Qr=function(t,e){var n=this,r=e.path,i=r.length+1,o=zi.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new Nt($);return Si(t).ss({range:s},(function(t,e,o){var s=t[0],a=t[1],c=t[2],h=pi(a);s===n.userId&&r.T(h)?h.length===i&&(u=u.add(c)):o.done()})).next((function(){return n.Uo(t,u)}))},t.prototype.Uo=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(Di(t).get(e).next((function(t){if(null===t)throw m();w(t.userId===n.userId),r.push(bi(n.serializer,t))})))})),vr.$n(i).next((function(){return r}))},t.prototype.Qo=function(t,e){var n=this;return Ni(t.Wo,this.userId,e).next((function(r){return t.Vr((function(){n.jo(e.batchId)})),vr.forEach(r,(function(e){return n.Co.Ko(t,e)}))}))},t.prototype.jo=function(t){delete this.No[t]},t.prototype.Go=function(t){var e=this;return this.$o(t).next((function(n){if(!n)return vr.resolve();var r=IDBKeyRange.lowerBound(zi.prefixForUser(e.userId)),i=[];return Si(t).ss({range:r},(function(t,n,r){if(t[0]===e.userId){var o=pi(t[1]);i.push(o)}else r.done()})).next((function(){w(0===i.length)}))}))},t.prototype.zo=function(t,e){return Ai(t,this.userId,e)},t.prototype.Ho=function(t){var e=this;return xi(t).get(this.userId).next((function(t){return t||new qi(e.userId,-1,\"\")}))},t}();function Ai(t,e,n){var r=zi.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Si(t).ss({range:o,ns:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function Ni(t,e,n){var r=t.store(ji.store),i=t.store(zi.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ss({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){w(1===u)})));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=zi.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return vr.$n(o).next((function(){return c}))}function Di(t){return co.Un(t,ji.store)}function Si(t){return co.Un(t,zi.store)}function xi(t){return co.Un(t,qi.store)}var ki=function(){function t(t,e){this.serializer=t,this.Sr=e}return t.prototype.Tr=function(t,e,n){return Ri(t).put(Oi(e),n)},t.prototype.Ir=function(t,e){var n=Ri(t),r=Oi(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Yo(t,r)}))},t.prototype.Ar=function(t,e){var n=this;return Ri(t).get(Oi(e)).next((function(t){return n.Jo(t)}))},t.prototype.Xo=function(t,e){var n=this;return Ri(t).get(Oi(e)).next((function(t){var e=n.Jo(t);return e?{Zo:e,size:Ui(t)}:null}))},t.prototype.getEntries=function(t,e){var n=this,r=kt();return this.ta(t,e,(function(t,e){var i=n.Jo(e);r=r.rt(t,i)})).next((function(){return r}))},t.prototype.ea=function(t,e){var n=this,r=kt(),i=new Et(S.i);return this.ta(t,e,(function(t,e){var o=n.Jo(e);o?(r=r.rt(t,o),i=i.rt(t,Ui(e))):(r=r.rt(t,null),i=i.rt(t,0))})).next((function(){return{na:r,sa:i}}))},t.prototype.ta=function(t,e,n){if(e.m())return vr.resolve();var r=IDBKeyRange.bound(e.first().path.A(),e.last().path.A()),i=e.lt(),o=i.Et();return Ri(t).ss({range:r},(function(t,e,r){for(var s=S.$(t);o&&S.i(o,s)<0;)n(o,null),o=i.Et();o&&o.isEqual(s)&&(n(o,e),o=i.It()?i.Et():null),o?r.Jn(o.path.A()):r.done()})).next((function(){for(;o;)n(o,null),o=i.It()?i.Et():null}))},t.prototype.Or=function(t,e,n){var r=this,i=Rt(),o=e.path.length+1,s={};if(n.isEqual(at.min())){var u=e.path.A();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.A(),c=gi(n);s.range=IDBKeyRange.lowerBound([a,c],!0),s.index=Qi.collectionReadTimeIndex}return Ri(t).ss(s,(function(t,n,s){if(t.length===o){var u=vi(r.serializer,n);e.path.T(u.key.path)?u instanceof xn&&Yn(e,u)&&(i=i.rt(u.key,u)):s.done()}})).next((function(){return i}))},t.prototype.ia=function(t,e){var n=this,r=xt(),i=gi(e),o=Ri(t),s=IDBKeyRange.lowerBound(i,!0);return o.ss({index:Qi.readTimeIndex,range:s},(function(t,e){var o=vi(n.serializer,e);r=r.rt(o.key,o),i=e.readTime})).next((function(){return{ra:r,readTime:mi(i)}}))},t.prototype.oa=function(t){var e=Ri(t),n=at.min();return e.ss({index:Qi.readTimeIndex,reverse:!0},(function(t,e,r){e.readTime&&(n=mi(e.readTime)),r.done()})).next((function(){return n}))},t.prototype.aa=function(e){return new t.ca(this,!!e&&e.ua)},t.prototype.ha=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},t.prototype.getMetadata=function(t){return Li(t).get(Wi.key).next((function(t){return w(!!t),t}))},t.prototype.Yo=function(t,e){return Li(t).put(Wi.key,e)},t.prototype.Jo=function(t){if(t){var e=vi(this.serializer,t);return e instanceof kn&&e.version.isEqual(at.min())?null:e}return null},t}();function Li(t){return co.Un(t,Wi.store)}function Ri(t){return co.Un(t,Qi.store)}function Oi(t){return t.path.A()}function Ui(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw m();e=t.noDocument}return JSON.stringify(e).length}ki.ca=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).la=e,r.ua=n,r._a=new st((function(t){return t.toString()}),(function(t,e){return t.isEqual(e)})),r}return r.__extends(e,t),e.prototype.gr=function(t){var e=this,n=[],r=0,i=new Nt((function(t,e){return $(t.R(),e.R())}));return this.dr.forEach((function(o,s){var u=e._a.get(o);if(s){var a=yi(e.la.serializer,s,e.readTime);i=i.add(o.path.h());var c=Ui(a);r+=c-u,n.push(e.la.Tr(t,o,a))}else if(r-=u,e.ua){var h=yi(e.la.serializer,new kn(o,at.min()),e.readTime);n.push(e.la.Tr(t,o,h))}else n.push(e.la.Ir(t,o))})),i.forEach((function(r){n.push(e.la.Sr.ko(t,r))})),n.push(this.la.updateMetadata(t,r)),vr.$n(n)},e.prototype.Rr=function(t,e){var n=this;return this.la.Xo(t,e).next((function(t){return null===t?(n._a.set(e,0),null):(n._a.set(e,t.size),t.Zo)}))},e.prototype.Pr=function(t,e){var n=this;return this.la.ea(t,e).next((function(t){var e=t.na;return t.sa.forEach((function(t,e){n._a.set(t,e)})),e}))},e}(Zr);var Pi=function(){function t(){this.fa=new Vi}return t.prototype.ko=function(t,e){return this.fa.add(e),vr.resolve()},t.prototype.Ur=function(t,e){return vr.resolve(this.fa.getEntries(e))},t}(),Vi=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t._(),n=t.h(),r=this.index[e]||new Nt(A.i),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t._(),n=t.h(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new Nt(A.i)).A()},t}(),Ci=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;w(n<r&&n>=0&&r<=10);var o=new _r(e);n<1&&r>=1&&(function(t){t.createObjectStore(Fi.store)}(t),function(t){t.createObjectStore(qi.store,{keyPath:qi.keyPath}),t.createObjectStore(ji.store,{keyPath:ji.keyPath,autoIncrement:!0}).createIndex(ji.userMutationsIndex,ji.userMutationsKeyPath,{unique:!0}),t.createObjectStore(zi.store)}(t),Xi(t),function(t){t.createObjectStore(Qi.store)}(t));var s=vr.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Hi.store),t.deleteObjectStore(Ki.store),t.deleteObjectStore(Yi.store)}(t),Xi(t)),s=s.next((function(){return function(t){var e=t.store(Yi.store),n=new Yi(0,0,at.min().X(),0);return e.put(Yi.key,n)}(o)}))),n<4&&r>=4&&(0!==n&&(s=s.next((function(){return function(t,e){return e.store(ji.store).Zn().next((function(n){t.deleteObjectStore(ji.store),t.createObjectStore(ji.store,{keyPath:ji.keyPath,autoIncrement:!0}).createIndex(ji.userMutationsIndex,ji.userMutationsKeyPath,{unique:!0});var r=e.store(ji.store),i=n.map((function(t){return r.put(t)}));return vr.$n(i)}))}(t,o)}))),s=s.next((function(){!function(t){t.createObjectStore(Ji.store,{keyPath:Ji.keyPath})}(t)}))),n<5&&r>=5&&(s=s.next((function(){return i.removeAcknowledgedMutations(o)}))),n<6&&r>=6&&(s=s.next((function(){return function(t){t.createObjectStore(Wi.store)}(t),i.addDocumentGlobal(o)}))),n<7&&r>=7&&(s=s.next((function(){return i.ensureSequenceNumbers(o)}))),n<8&&r>=8&&(s=s.next((function(){return i.createCollectionParentIndex(t,o)}))),n<9&&r>=9&&(s=s.next((function(){!function(t){t.objectStoreNames.contains(\"remoteDocumentChanges\")&&t.deleteObjectStore(\"remoteDocumentChanges\")}(t),function(t){var e=t.objectStore(Qi.store);e.createIndex(Qi.readTimeIndex,Qi.readTimeIndexPath,{unique:!1}),e.createIndex(Qi.collectionReadTimeIndex,Qi.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&r>=10&&(s=s.next((function(){return i.rewriteCanonicalIds(o)}))),s},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Qi.store).ss((function(t,n){e+=Ui(n)})).next((function(){var n=new Wi(e);return t.store(Wi.store).put(Wi.key,n)}))},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(qi.store),r=t.store(ji.store);return n.Zn().next((function(n){return vr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Zn(ji.userMutationsIndex,i).next((function(r){return vr.forEach(r,(function(r){w(r.userId===n.userId);var i=bi(e.serializer,r);return Ni(t,n.userId,i).next((function(){}))}))}))}))}))},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Hi.store),n=t.store(Qi.store);return t.store(Yi.store).get(Yi.key).next((function(t){var r=[];return n.ss((function(n,i){var o=new A(n),s=function(t){return[0,hi(t)]}(o);r.push(e.get(s).next((function(n){return n?vr.resolve():function(n){return e.put(new Hi(0,hi(n),t.highestListenSequenceNumber))}(o)})))})).next((function(){return vr.$n(r)}))}))},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore($i.store,{keyPath:$i.keyPath});var n=e.store($i.store),r=new Vi,i=function(t){if(r.add(t)){var e=t._(),i=t.h();return n.put({collectionId:e,parent:hi(i)})}};return e.store(Qi.store).ss({ns:!0},(function(t,e){var n=new A(t);return i(n.h())})).next((function(){return e.store(zi.store).ss({ns:!0},(function(t,e){t[0];var n=t[1],r=(t[2],pi(n));return i(r.h())}))}))},t.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Ki.store);return n.ss((function(t,r){var i=Ii(r),o=Ei(e.serializer,i);return n.put(o)}))},t}(),Mi=function(t,e){this.seconds=t,this.nanoseconds=e},Fi=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};Fi.store=\"owner\",Fi.key=\"owner\";var qi=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};qi.store=\"mutationQueues\",qi.keyPath=\"userId\";var ji=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ji.store=\"mutations\",ji.keyPath=\"batchId\",ji.userMutationsIndex=\"userMutationsIndex\",ji.userMutationsKeyPath=[\"userId\",\"batchId\"];var zi=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,hi(e)]},t.key=function(t,e,n){return[t,hi(e),n]},t}();zi.store=\"documentMutations\",zi.PLACEHOLDER=new zi;var Bi=function(t,e){this.path=t,this.readTime=e},Gi=function(t,e){this.path=t,this.version=e},Qi=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Qi.store=\"remoteDocuments\",Qi.readTimeIndex=\"readTimeIndex\",Qi.readTimeIndexPath=\"readTime\",Qi.collectionReadTimeIndex=\"collectionReadTimeIndex\",Qi.collectionReadTimeIndexPath=[\"parentPath\",\"readTime\"];var Wi=function(t){this.byteSize=t};Wi.store=\"remoteDocumentGlobal\",Wi.key=\"remoteDocumentGlobalKey\";var Ki=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ki.store=\"targets\",Ki.keyPath=\"targetId\",Ki.queryTargetsIndexName=\"queryTargetsIndex\",Ki.queryTargetsKeyPath=[\"canonicalId\",\"targetId\"];var Hi=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Hi.store=\"targetDocuments\",Hi.keyPath=[\"targetId\",\"path\"],Hi.documentTargetsIndex=\"documentTargetsIndex\",Hi.documentTargetsKeyPath=[\"path\",\"targetId\"];var Yi=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Yi.key=\"targetGlobalKey\",Yi.store=\"targetGlobal\";var $i=function(t,e){this.collectionId=t,this.parent=e};function Xi(t){t.createObjectStore(Hi.store,{keyPath:Hi.keyPath}).createIndex(Hi.documentTargetsIndex,Hi.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ki.store,{keyPath:Ki.keyPath}).createIndex(Ki.queryTargetsIndexName,Ki.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Yi.store)}$i.store=\"collectionParents\",$i.keyPath=[\"collectionId\",\"parent\"];var Ji=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ji.store=\"clientMetadata\",Ji.keyPath=\"clientId\";var Zi=r.__spreadArrays(r.__spreadArrays(r.__spreadArrays([qi.store,ji.store,zi.store,Qi.store,Ki.store,Fi.store,Yi.store,Hi.store],[Ji.store]),[Wi.store]),[$i.store]),to=function(){function t(){this.da=new Vi}return t.prototype.ko=function(t,e){var n=this;if(!this.da.has(e)){var r=e._(),i=e.h();t.Vr((function(){n.da.add(e)}));var o={collectionId:r,parent:hi(i)};return eo(t).put(o)}return vr.resolve()},t.prototype.Ur=function(t,e){var n=[],r=IDBKeyRange.bound([e,\"\"],[J(e),\"\"],!1,!0);return eo(t).Zn(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(pi(o.parent))}return n}))},t}();function eo(t){return co.Un(t,$i.store)}var no=function(){function t(t){this.wa=t}return t.prototype.next=function(){return this.wa+=2,this.wa},t.ma=function(){return new t(0)},t.Ta=function(){return new t(-1)},t}(),ro=function(){function t(t,e){this.Co=t,this.serializer=e}return t.prototype.Ea=function(t){var e=this;return this.Ia(t).next((function(n){var r=new no(n.highestTargetId);return n.highestTargetId=r.next(),e.Aa(t,n).next((function(){return n.highestTargetId}))}))},t.prototype.Ra=function(t){return this.Ia(t).next((function(t){return at.Y(new ut(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},t.prototype.Pa=function(t){return this.Ia(t).next((function(t){return t.highestListenSequenceNumber}))},t.prototype.ga=function(t,e,n){var r=this;return this.Ia(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.X()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Aa(t,i)}))},t.prototype.ya=function(t,e){var n=this;return this.Va(t,e).next((function(){return n.Ia(t).next((function(r){return r.targetCount+=1,n.pa(e,r),n.Aa(t,r)}))}))},t.prototype.ba=function(t,e){return this.Va(t,e)},t.prototype.va=function(t,e){var n=this;return this.Sa(t,e.targetId).next((function(){return io(t).delete(e.targetId)})).next((function(){return n.Ia(t)})).next((function(e){return w(e.targetCount>0),e.targetCount-=1,n.Aa(t,e)}))},t.prototype.Vo=function(t,e,n){var r=this,i=0,o=[];return io(t).ss((function(s,u){var a=Ii(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.va(t,a)))})).next((function(){return vr.$n(o)})).next((function(){return i}))},t.prototype.De=function(t,e){return io(t).ss((function(t,n){var r=Ii(n);e(r)}))},t.prototype.Ia=function(t){return oo(t).get(Yi.key).next((function(t){return w(null!==t),t}))},t.prototype.Aa=function(t,e){return oo(t).put(Yi.key,e)},t.prototype.Va=function(t,e){return io(t).put(Ei(this.serializer,e))},t.prototype.pa=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.Da=function(t){return this.Ia(t).next((function(t){return t.targetCount}))},t.prototype.Ca=function(t,e){var n=dt(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return io(t).ss({range:r,index:Ki.queryTargetsIndexName},(function(t,n,r){var o=Ii(n);vt(e,o.target)&&(i=o,r.done())})).next((function(){return i}))},t.prototype.Na=function(t,e,n){var r=this,i=[],o=so(t);return e.forEach((function(e){var s=hi(e.path);i.push(o.put(new Hi(n,s))),i.push(r.Co.Fa(t,n,e))})),vr.$n(i)},t.prototype.$a=function(t,e,n){var r=this,i=so(t);return vr.forEach(e,(function(e){var o=hi(e.path);return vr.$n([i.delete([n,o]),r.Co.xa(t,n,e)])}))},t.prototype.Sa=function(t,e){var n=so(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.ka=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=so(t),i=Pt();return r.ss({range:n,ns:!0},(function(t,e,n){var r=pi(t[1]),o=new S(r);i=i.add(o)})).next((function(){return i}))},t.prototype.zo=function(t,e){var n=hi(e.path),r=IDBKeyRange.bound([n],[J(n)],!1,!0),i=0;return so(t).ss({index:Hi.documentTargetsIndex,ns:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return i>0}))},t.prototype.qe=function(t,e){return io(t).get(e).next((function(t){return t?Ii(t):null}))},t}();function io(t){return co.Un(t,Ki.store)}function oo(t){return co.Un(t,Yi.store)}function so(t){return co.Un(t,Hi.store)}var uo=\"Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.\",ao=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Wo=e,r.Ma=n,r}return r.__extends(e,t),e}(ei),co=function(){function t(e,n,r,i,o,s,u,a,c,l){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this._n=o,this.window=s,this.document=u,this.Oa=c,this.La=l,this.Ba=null,this.qa=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Ua=null,this.inForeground=!1,this.Qa=null,this.Wa=null,this.ja=Number.NEGATIVE_INFINITY,this.Ka=function(t){return Promise.resolve()},!t.On())throw new f(h.UNIMPLEMENTED,\"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.\");this.Co=new lo(this,i),this.Ga=n+\"main\",this.serializer=new di(a),this.za=new yr(this.Ga,10,new Ci(this.serializer)),this.Ha=new ro(this.Co,this.serializer),this.Sr=new to,this.br=new ki(this.serializer,this.Sr),this.window&&this.window.localStorage?this.Ya=this.window.localStorage:(this.Ya=null,!1===l&&v(\"IndexedDbPersistence\",\"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page.\"))}return t.Un=function(t,e){if(t instanceof ao)return yr.Un(t.Wo,e);throw m()},t.prototype.start=function(){var t=this;return this.Ja().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new f(h.FAILED_PRECONDITION,uo);return t.Xa(),t.Za(),t.tc(),t.runTransaction(\"getHighestListenSequenceNumber\",\"readonly\",(function(e){return t.Ha.Pa(e)}))})).then((function(e){t.Ba=new qr(e,t.Oa)})).then((function(){t.qa=!0})).catch((function(e){return t.za&&t.za.close(),Promise.reject(e)}))},t.prototype.ec=function(t){var e=this;return this.Ka=function(n){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){return this.Ti?[2,t(n)]:[2]}))}))},t(this.isPrimary)},t.prototype.nc=function(t){var e=this;this.za.jn((function(n){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},t.prototype.sc=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this._n.ds((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.Ti?[4,this.Ja()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},t.prototype.Ja=function(){var t=this;return this.runTransaction(\"updateClientMetadataAndTryBecomePrimary\",\"readwrite\",(function(e){return fo(e).put(new Ji(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.ic(e).next((function(e){e||(t.isPrimary=!1,t._n.Ds((function(){return t.Ka(!1)})))}))})).next((function(){return t.rc(e)})).next((function(n){return t.isPrimary&&!n?t.oc(e).next((function(){return!1})):!!n&&t.ac(e).next((function(){return!0}))}))})).catch((function(e){if(wr(e))return d(\"IndexedDbPersistence\",\"Failed to extend owner lease: \",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return d(\"IndexedDbPersistence\",\"Releasing owner lease after error during lease refresh\",e),!1})).then((function(e){t.isPrimary!==e&&t._n.Ds((function(){return t.Ka(e)})),t.isPrimary=e}))},t.prototype.ic=function(t){var e=this;return ho(t).get(Fi.key).next((function(t){return vr.resolve(e.cc(t))}))},t.prototype.uc=function(t){return fo(t).delete(this.clientId)},t.prototype.hc=function(){return r.__awaiter(this,void 0,void 0,(function(){var e,n,i,o,s=this;return r.__generator(this,(function(r){switch(r.label){case 0:return!this.isPrimary||this.lc(this.ja,18e5)?[3,2]:(this.ja=Date.now(),[4,this.runTransaction(\"maybeGarbageCollectMultiClientState\",\"readwrite-primary\",(function(e){var n=t.Un(e,Ji.store);return n.Zn().next((function(t){var e=s._c(t,18e5),r=t.filter((function(t){return-1===e.indexOf(t)}));return vr.forEach(r,(function(t){return n.delete(t.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}))]);case 1:if(e=r.sent(),this.Ya)for(n=0,i=e;n<i.length;n++)o=i[n],this.Ya.removeItem(this.fc(o.clientId));r.label=2;case 2:return[2]}}))}))},t.prototype.tc=function(){var t=this;this.Wa=this._n.gn(\"client_metadata_refresh\",4e3,(function(){return t.Ja().then((function(){return t.hc()})).then((function(){return t.tc()}))}))},t.prototype.cc=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.rc=function(t){var e=this;return this.La?vr.resolve(!0):ho(t).get(Fi.key).next((function(n){if(null!==n&&e.lc(n.leaseTimestampMs,5e3)&&!e.dc(n.ownerId)){if(e.cc(n)&&e.networkEnabled)return!0;if(!e.cc(n)){if(!n.allowTabSynchronization)throw new f(h.FAILED_PRECONDITION,uo);return!1}}return!(!e.networkEnabled||!e.inForeground)||fo(t).Zn().next((function(t){return void 0===e._c(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&d(\"IndexedDbPersistence\",\"Client \"+(t?\"is\":\"is not\")+\" eligible for a primary lease.\"),t}))},t.prototype.Si=function(){return r.__awaiter(this,void 0,void 0,(function(){var t=this;return r.__generator(this,(function(e){switch(e.label){case 0:return this.qa=!1,this.wc(),this.Wa&&(this.Wa.cancel(),this.Wa=null),this.mc(),this.Tc(),[4,this.za.runTransaction(\"readwrite\",[Fi.store,Ji.store],(function(e){var n=new ao(e,qr.oi);return t.oc(n).next((function(){return t.uc(n)}))}))];case 1:return e.sent(),this.za.close(),this.Ec(),[2]}}))}))},t.prototype._c=function(t,e){var n=this;return t.filter((function(t){return n.lc(t.updateTimeMs,e)&&!n.dc(t.clientId)}))},t.prototype.Vi=function(){var t=this;return this.runTransaction(\"getActiveClients\",\"readonly\",(function(e){return fo(e).Zn().next((function(e){return t._c(e,18e5).map((function(t){return t.clientId}))}))}))},Object.defineProperty(t.prototype,\"Ti\",{get:function(){return this.qa},enumerable:!1,configurable:!0}),t.prototype.Ic=function(t){return Ti.Fo(t,this.serializer,this.Sr,this.Co)},t.prototype.Ac=function(){return this.Ha},t.prototype.Rc=function(){return this.br},t.prototype.Pc=function(){return this.Sr},t.prototype.runTransaction=function(t,e,n){var r=this;d(\"IndexedDbPersistence\",\"Starting transaction:\",t);var i,o=\"readonly\"===e?\"readonly\":\"readwrite\";return this.za.runTransaction(o,Zi,(function(o){return i=new ao(o,r.Ba?r.Ba.next():qr.oi),\"readwrite-primary\"===e?r.ic(i).next((function(t){return!!t||r.rc(i)})).next((function(e){if(!e)throw v(\"Failed to obtain primary lease for action '\"+t+\"'.\"),r.isPrimary=!1,r._n.Ds((function(){return r.Ka(!1)})),new f(h.FAILED_PRECONDITION,ti);return n(i)})).next((function(t){return r.ac(i).next((function(){return t}))})):r.gc(i).next((function(){return n(i)}))})).then((function(t){return i.pr(),t}))},t.prototype.gc=function(t){var e=this;return ho(t).get(Fi.key).next((function(t){if(null!==t&&e.lc(t.leaseTimestampMs,5e3)&&!e.dc(t.ownerId)&&!e.cc(t)&&!(e.La||e.allowTabSynchronization&&t.allowTabSynchronization))throw new f(h.FAILED_PRECONDITION,uo)}))},t.prototype.ac=function(t){var e=new Fi(this.clientId,this.allowTabSynchronization,Date.now());return ho(t).put(Fi.key,e)},t.On=function(){return yr.On()},t.prototype.oc=function(t){var e=this,n=ho(t);return n.get(Fi.key).next((function(t){return e.cc(t)?(d(\"IndexedDbPersistence\",\"Releasing primary lease.\"),n.delete(Fi.key)):vr.resolve()}))},t.prototype.lc=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(v(\"Detected an update time that is in the future: \"+t+\" > \"+n),1))},t.prototype.Xa=function(){var t=this;null!==this.document&&\"function\"==typeof this.document.addEventListener&&(this.Qa=function(){t._n.ds((function(){return t.inForeground=\"visible\"===t.document.visibilityState,t.Ja()}))},this.document.addEventListener(\"visibilitychange\",this.Qa),this.inForeground=\"visible\"===this.document.visibilityState)},t.prototype.mc=function(){this.Qa&&(this.document.removeEventListener(\"visibilitychange\",this.Qa),this.Qa=null)},t.prototype.Za=function(){var t,e=this;\"function\"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Ua=function(){e.wc(),e._n.ds((function(){return e.Si()}))},this.window.addEventListener(\"unload\",this.Ua))},t.prototype.Tc=function(){this.Ua&&(this.window.removeEventListener(\"unload\",this.Ua),this.Ua=null)},t.prototype.dc=function(t){var e;try{var n=null!==(null===(e=this.Ya)||void 0===e?void 0:e.getItem(this.fc(t)));return d(\"IndexedDbPersistence\",\"Client '\"+t+\"' \"+(n?\"is\":\"is not\")+\" zombied in LocalStorage\"),n}catch(t){return v(\"IndexedDbPersistence\",\"Failed to get zombied client id.\",t),!1}},t.prototype.wc=function(){if(this.Ya)try{this.Ya.setItem(this.fc(this.clientId),String(Date.now()))}catch(r){v(\"Failed to set zombie client id.\",r)}},t.prototype.Ec=function(){if(this.Ya)try{this.Ya.removeItem(this.fc(this.clientId))}catch(r){}},t.prototype.fc=function(t){return\"firestore_zombie_\"+this.persistenceKey+\"_\"+t},t}();function ho(t){return co.Un(t,Fi.store)}function fo(t){return co.Un(t,Ji.store)}var lo=function(){function t(t,e){this.db=t,this.do=new ci(this,e)}return t.prototype.Ro=function(t){var e=this.yc(t);return this.db.Ac().Da(t).next((function(t){return e.next((function(e){return t+e}))}))},t.prototype.yc=function(t){var e=0;return this.yo(t,(function(t){e++})).next((function(){return e}))},t.prototype.De=function(t,e){return this.db.Ac().De(t,e)},t.prototype.yo=function(t,e){return this.Vc(t,(function(t,n){return e(n)}))},t.prototype.Fa=function(t,e,n){return po(t,n)},t.prototype.xa=function(t,e,n){return po(t,n)},t.prototype.Vo=function(t,e,n){return this.db.Ac().Vo(t,e,n)},t.prototype.Ko=function(t,e){return po(t,e)},t.prototype.bc=function(t,e){return function(t,e){var n=!1;return xi(t).rs((function(r){return Ai(t,r,e).next((function(t){return t&&(n=!0),vr.resolve(!t)}))})).next((function(){return n}))}(t,e)},t.prototype.po=function(t,e){var n=this,r=this.db.Rc().aa(),i=[],o=0;return this.Vc(t,(function(s,u){if(u<=e){var a=n.bc(t,s).next((function(e){if(!e)return o++,r.Ar(t,s).next((function(){return r.Ir(s),so(t).delete([0,hi(s.path)])}))}));i.push(a)}})).next((function(){return vr.$n(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},t.prototype.removeTarget=function(t,e){var n=e.nt(t.Ma);return this.db.Ac().ba(t,n)},t.prototype.vc=function(t,e){return po(t,e)},t.prototype.Vc=function(t,e){var n,r=so(t),i=qr.oi;return r.ss({index:Hi.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==qr.oi&&e(new S(pi(n)),i),i=u,n=s):i=qr.oi})).next((function(){i!==qr.oi&&e(new S(pi(n)),i)}))},t.prototype.vo=function(t){return this.db.Rc().ha(t)},t}();function po(t,e){return so(t).put(function(t,e){return new Hi(0,hi(t.path),e)}(e,t.Ma))}function vo(t,e){var n=t.projectId;return t.W||(n+=\".\"+t.database),\"firestore/\"+e+\"/\"+n+\"/\"}var yo=function(){function t(t,e,n){this.persistence=t,this.Sc=e,this.Dc=new Et($),this.Cc=new st((function(t){return dt(t)}),vt),this.Nc=at.min(),this.vr=t.Ic(n),this.Fc=t.Rc(),this.Ha=t.Ac(),this.$c=new ni(this.Fc,this.vr,this.persistence.Pc()),this.Sc.xc(this.$c)}return t.prototype.Eo=function(t){var e=this;return this.persistence.runTransaction(\"Collect garbage\",\"readwrite-primary\",(function(n){return t.bo(n,e.Dc)}))},t}();function go(t,e){var n=_(t);return n.persistence.runTransaction(\"Acknowledge batch\",\"readwrite-primary\",(function(t){var r=e.batch.keys(),i=n.Fc.aa({ua:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=vr.resolve();return o.forEach((function(t){s=s.next((function(){return r.Ar(e,t)})).next((function(e){var o=e,s=n._r.get(t);w(null!==s),(!o||o.version.L(s)<0)&&(o=i.ar(t,o,n))&&r.Tr(o,n.lr)}))})),s.next((function(){return t.vr.Qo(e,i)}))}(n,t,e,i).next((function(){return i.apply(t)})).next((function(){return n.vr.Go(t)})).next((function(){return n.$c.$r(t,r)}))}))}function mo(t){var e=_(t);return e.persistence.runTransaction(\"Get last remote snapshot version\",\"readonly\",(function(t){return e.Ha.Ra(t)}))}function wo(t,e){var n=_(t),r=e.et,i=n.Dc;return n.persistence.runTransaction(\"Apply remote event\",\"readwrite-primary\",(function(t){var o=n.Fc.aa({ua:!0});i=n.Dc;var s=[];e.Gt.forEach((function(e,o){var u=i.get(o);if(u){s.push(n.Ha.$a(t,e.ne,o).next((function(){return n.Ha.Na(t,e.te,o)})));var a=e.resumeToken;if(a.O()>0){var c=u.st(a,r).nt(t.Ma);i=i.rt(o,c),function(t,e,n){return w(e.resumeToken.O()>0),0===t.resumeToken.O()||e.et.J()-t.et.J()>=3e8||n.te.size+n.ee.size+n.ne.size>0}(u,c,e)&&s.push(n.Ha.ba(t,c))}}}));var u=xt(),a=Pt();if(e.Ht.forEach((function(t,e){a=a.add(t)})),s.push(o.getEntries(t,a).next((function(i){e.Ht.forEach((function(a,c){var h=i.get(a);c instanceof kn&&c.version.isEqual(at.min())?(o.Ir(a,r),u=u.rt(a,c)):null==h||c.version.L(h.version)>0||0===c.version.L(h.version)&&h.hasPendingWrites?(o.Tr(c,r),u=u.rt(a,c)):d(\"LocalStore\",\"Ignoring outdated watch update for \",a,\". Current version:\",h.version,\" Watch version:\",c.version),e.Yt.has(a)&&s.push(n.persistence.Co.vc(t,a))}))}))),!r.isEqual(at.min())){var c=n.Ha.Ra(t).next((function(e){return n.Ha.ga(t,t.Ma,r)}));s.push(c)}return vr.$n(s).next((function(){return o.apply(t)})).next((function(){return n.$c.kr(t,u)}))})).then((function(t){return n.Dc=i,t}))}function _o(t,e){var n=_(t);return n.persistence.runTransaction(\"Get next mutation batch\",\"readonly\",(function(t){return void 0===e&&(e=-1),n.vr.Lo(t,e)}))}function bo(t,e){var n=_(t);return n.persistence.runTransaction(\"Allocate target\",\"readwrite\",(function(t){var r;return n.Ha.Ca(t,e).next((function(i){return i?(r=i,vr.resolve(r)):n.Ha.Ea(t).next((function(i){return r=new wt(e,i,0,t.Ma),n.Ha.ya(t,r).next((function(){return r}))}))}))})).then((function(t){var r=n.Dc.get(t.targetId);return(null===r||t.et.L(r.et)>0)&&(n.Dc=n.Dc.rt(t.targetId,t),n.Cc.set(e,t.targetId)),t}))}function Io(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:i=_(t),o=i.Dc.get(e),s=n?\"readwrite\":\"readwrite-primary\",r.label=1;case 1:return r.trys.push([1,4,,5]),n?[3,3]:[4,i.persistence.runTransaction(\"Release target\",s,(function(t){return i.persistence.Co.removeTarget(t,o)}))];case 2:r.sent(),r.label=3;case 3:return[3,5];case 4:if(!wr(u=r.sent()))throw u;return d(\"LocalStore\",\"Failed to update sequence numbers for target \"+e+\": \"+u),[3,5];case 5:return i.Dc=i.Dc.remove(e),i.Cc.delete(o.target),[2]}}))}))}function Eo(t,e,n){var r=_(t),i=at.min(),o=Pt();return r.persistence.runTransaction(\"Execute query\",\"readonly\",(function(t){return function(t,e,n){var r=_(t),i=r.Cc.get(n);return void 0!==i?vr.resolve(r.Dc.get(i)):r.Ha.Ca(e,n)}(r,t,zn(e)).next((function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ha.ka(t,e.targetId).next((function(t){o=t}))})).next((function(){return r.Sc.Or(t,e,n?i:at.min(),n?o:Pt())})).next((function(t){return{documents:t,kc:o}}))}))}function To(t,e){var n=_(t),r=_(n.Ha),i=n.Dc.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction(\"Get target data\",\"readonly\",(function(t){return r.qe(t,e).next((function(t){return t?t.target:null}))}))}function Ao(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){if(t.code!==h.FAILED_PRECONDITION||t.message!==ti)throw t;return d(\"LocalStore\",\"Unexpectedly lost primary lease\"),[2]}))}))}var No=function(){function t(){this.Mc=new Nt(Do.Oc),this.Lc=new Nt(Do.Bc)}return t.prototype.m=function(){return this.Mc.m()},t.prototype.Fa=function(t,e){var n=new Do(t,e);this.Mc=this.Mc.add(n),this.Lc=this.Lc.add(n)},t.prototype.qc=function(t,e){var n=this;t.forEach((function(t){return n.Fa(t,e)}))},t.prototype.xa=function(t,e){this.Uc(new Do(t,e))},t.prototype.Qc=function(t,e){var n=this;t.forEach((function(t){return n.xa(t,e)}))},t.prototype.Wc=function(t){var e=this,n=new S(new A([])),r=new Do(n,t),i=new Do(n,t+1),o=[];return this.Lc.Nt([r,i],(function(t){e.Uc(t),o.push(t.key)})),o},t.prototype.jc=function(){var t=this;this.Mc.forEach((function(e){return t.Uc(e)}))},t.prototype.Uc=function(t){this.Mc=this.Mc.delete(t),this.Lc=this.Lc.delete(t)},t.prototype.Kc=function(t){var e=new S(new A([])),n=new Do(e,t),r=new Do(e,t+1),i=Pt();return this.Lc.Nt([n,r],(function(t){i=i.add(t.key)})),i},t.prototype.zo=function(t){var e=new Do(t,0),n=this.Mc.$t(e);return null!==n&&t.isEqual(n.key)},t}(),Do=function(){function t(t,e){this.key=t,this.Gc=e}return t.Oc=function(t,e){return S.i(t.key,e.key)||$(t.Gc,e.Gc)},t.Bc=function(t,e){return $(t.Gc,e.Gc)||S.i(t.key,e.key)},t}(),So=function(t,e){this.user=e,this.type=\"OAuth\",this.zc={},this.zc.Authorization=\"Bearer \"+t},xo=function(){function t(){this.Hc=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.Yc=function(){},t.prototype.Jc=function(t){this.Hc=t,t(Fr.UNAUTHENTICATED)},t.prototype.Xc=function(){this.Hc=null},t}(),ko=function(){function t(t){var e=this;this.Zc=null,this.currentUser=Fr.UNAUTHENTICATED,this.tu=!1,this.eu=0,this.Hc=null,this.forceRefresh=!1,this.Zc=function(){e.eu++,e.currentUser=e.nu(),e.tu=!0,e.Hc&&e.Hc(e.currentUser)},this.eu=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Zc):(this.Zc(null),t.get().then((function(t){e.auth=t,e.Zc&&e.auth.addAuthTokenListener(e.Zc)}),(function(){})))}return t.prototype.getToken=function(){var t=this,e=this.eu,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return t.eu!==e?(d(\"FirebaseCredentialsProvider\",\"getToken aborted due to token change.\"),t.getToken()):n?(w(\"string\"==typeof n.accessToken),new So(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},t.prototype.Yc=function(){this.forceRefresh=!0},t.prototype.Jc=function(t){this.Hc=t,this.tu&&t(this.currentUser)},t.prototype.Xc=function(){this.auth&&this.auth.removeAuthTokenListener(this.Zc),this.Zc=null,this.Hc=null},t.prototype.nu=function(){var t=this.auth&&this.auth.getUid();return w(null===t||\"string\"==typeof t),new Fr(t)},t}(),Lo=function(){function t(t,e){this.su=t,this.iu=e,this.type=\"FirstParty\",this.user=Fr.ei}return Object.defineProperty(t.prototype,\"zc\",{get:function(){var t={\"X-Goog-AuthUser\":this.iu},e=this.su.auth.ru([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),t}(),Ro=function(){function t(t,e){this.su=t,this.iu=e}return t.prototype.getToken=function(){return Promise.resolve(new Lo(this.su,this.iu))},t.prototype.Jc=function(t){t(Fr.ei)},t.prototype.Xc=function(){},t.prototype.Yc=function(){},t}(),Oo=function(){function t(t,e,n,r,i,o){this._n=t,this.ou=n,this.au=r,this.cu=i,this.listener=o,this.state=0,this.uu=0,this.hu=null,this.stream=null,this.gs=new dr(t,e)}return t.prototype.lu=function(){return 1===this.state||2===this.state||4===this.state},t.prototype._u=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.fu()},t.prototype.stop=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.lu()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.du=function(){this.state=0,this.gs.reset()},t.prototype.wu=function(){var t=this;this._u()&&null===this.hu&&(this.hu=this._n.gn(this.ou,6e4,(function(){return t.mu()})))},t.prototype.Tu=function(t){this.Eu(),this.stream.send(t)},t.prototype.mu=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){return this._u()?[2,this.close(0)]:[2]}))}))},t.prototype.Eu=function(){this.hu&&(this.hu.cancel(),this.hu=null)},t.prototype.close=function(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return this.Eu(),this.gs.cancel(),this.uu++,3!==t?this.gs.reset():e&&e.code===h.RESOURCE_EXHAUSTED?(v(e.toString()),v(\"Using maximum backoff delay to prevent overloading the backend.\"),this.gs.An()):e&&e.code===h.UNAUTHENTICATED&&this.cu.Yc(),null!==this.stream&&(this.Iu(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Au(e)];case 1:return n.sent(),[2]}}))}))},t.prototype.Iu=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.Ru(this.uu),n=this.uu;this.cu.getToken().then((function(e){t.uu===n&&t.Pu(e)}),(function(n){e((function(){var e=new f(h.UNKNOWN,\"Fetching auth token failed: \"+n.message);return t.gu(e)}))}))},t.prototype.Pu=function(t){var e=this,n=this.Ru(this.uu);this.stream=this.yu(t),this.stream.Vu((function(){n((function(){return e.state=2,e.listener.Vu()}))})),this.stream.Au((function(t){n((function(){return e.gu(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},t.prototype.fu=function(){var t=this;this.state=4,this.gs.Rn((function(){return r.__awaiter(t,void 0,void 0,(function(){return r.__generator(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},t.prototype.gu=function(t){return d(\"PersistentStream\",\"close with error: \"+t),this.stream=null,this.close(3,t)},t.prototype.Ru=function(t){var e=this;return function(n){e._n.ds((function(){return e.uu===t?n():(d(\"PersistentStream\",\"stream callback skipped by getCloseGuardedDispatcher.\"),Promise.resolve())}))}},t}(),Uo=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,\"listen_stream_connection_backoff\",\"listen_stream_idle\",n,r,o)||this).serializer=i,s}return r.__extends(e,t),e.prototype.yu=function(t){return this.au.pu(\"Listen\",t)},e.prototype.onMessage=function(t){this.gs.reset();var e=function(t,e){var n;if(\"targetChange\"in e){e.targetChange;var r=function(t){return\"NO_CHANGE\"===t?0:\"ADD\"===t?1:\"REMOVE\"===t?2:\"CURRENT\"===t?3:\"RESET\"===t?4:m()}(e.targetChange.targetChangeType||\"NO_CHANGE\"),i=e.targetChange.targetIds||[],o=function(t,e){return t.Ue?(w(void 0===e||\"string\"==typeof e),Z.fromBase64String(e||\"\")):(w(void 0===e||e instanceof Uint8Array),Z.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=e.targetChange.cause,u=s&&function(t){var e=void 0===t.code?h.UNKNOWN:It(t.code);return new f(e,t.message||\"\")}(s);n=new Qt(r,i,o,u||null)}else if(\"documentChange\"in e){e.documentChange;var a=e.documentChange;a.document,a.document.name,a.document.updateTime;var c=De(t,a.document.name),l=Ee(a.document.updateTime),p=new An({mapValue:{fields:a.document.fields}}),d=new xn(c,l,p,{}),v=a.targetIds||[],y=a.removedTargetIds||[];n=new Bt(v,y,d.key,d)}else if(\"documentDelete\"in e){e.documentDelete;var g=e.documentDelete;g.document;var _=De(t,g.document),b=g.readTime?Ee(g.readTime):at.min(),I=new kn(_,b),E=g.removedTargetIds||[];n=new Bt([],E,I.key,I)}else if(\"documentRemove\"in e){e.documentRemove;var T=e.documentRemove;T.document;var A=De(t,T.document),N=T.removedTargetIds||[];n=new Bt([],N,A,null)}else{if(!(\"filter\"in e))return m();e.filter;var D=e.filter;D.targetId;var S=D.count||0,x=new _t(S),k=D.targetId;n=new Gt(k,x)}return n}(this.serializer,t),n=function(t){if(!(\"targetChange\"in t))return at.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?at.min():e.readTime?Ee(e.readTime):at.min()}(t);return this.listener.bu(e,n)},e.prototype.vu=function(t){var e={};e.database=ke(this.serializer),e.addTarget=function(t,e){var n,r=e.target;return(n=yt(r)?{documents:Pe(t,r)}:{query:Ve(t,r)}).targetId=e.targetId,e.resumeToken.O()>0&&(n.resumeToken=be(t,e.resumeToken)),n}(this.serializer,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return\"existence-filter-mismatch\";case 2:return\"limbo-document\";default:return m()}}(0,e.tt);return null==n?null:{\"goog-listen-tags\":n}}(this.serializer,t);n&&(e.labels=n),this.Tu(e)},e.prototype.Su=function(t){var e={};e.database=ke(this.serializer),e.removeTarget=t,this.Tu(e)},e}(Oo),Po=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,\"write_stream_connection_backoff\",\"write_stream_idle\",n,r,o)||this).serializer=i,s.Du=!1,s}return r.__extends(e,t),Object.defineProperty(e.prototype,\"Cu\",{get:function(){return this.Du},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.Du=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.Iu=function(){this.Du&&this.Nu([])},e.prototype.yu=function(t){return this.au.pu(\"Write\",t)},e.prototype.onMessage=function(t){if(w(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Du){this.gs.reset();var e=function(t,e){return t&&t.length>0?(w(void 0!==e),t.map((function(t){return function(t,e){var n=t.updateTime?Ee(t.updateTime):Ee(e);n.isEqual(at.min())&&(n=Ee(e));var r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new an(n,r)}(t,e)}))):[]}(t.writeResults,t.commitTime),n=Ee(t.commitTime);return this.listener.Fu(n,e)}return w(!t.writeResults||0===t.writeResults.length),this.Du=!0,this.listener.$u()},e.prototype.xu=function(){var t={};t.database=ke(this.serializer),this.Tu(t)},e.prototype.Nu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map((function(t){return Oe(e.serializer,t)}))};this.Tu(n)},e}(Oo),Vo=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.au=n,i.serializer=r,i.ku=!1,i}return r.__extends(e,t),e.prototype.Mu=function(){if(this.ku)throw new f(h.FAILED_PRECONDITION,\"The client has already been terminated.\")},e.prototype.Ou=function(t,e,n){var r=this;return this.Mu(),this.credentials.getToken().then((function(i){return r.au.Ou(t,e,n,i)})).catch((function(t){throw t.code===h.UNAUTHENTICATED&&r.credentials.Yc(),t}))},e.prototype.Lu=function(t,e,n){var r=this;return this.Mu(),this.credentials.getToken().then((function(i){return r.au.Lu(t,e,n,i)})).catch((function(t){throw t.code===h.UNAUTHENTICATED&&r.credentials.Yc(),t}))},e.prototype.terminate=function(){this.ku=!1},e}((function(){})),Co=function(){function t(t,e){this.os=t,this.fi=e,this.state=\"Unknown\",this.Bu=0,this.qu=null,this.Uu=!0}return t.prototype.Qu=function(){var t=this;0===this.Bu&&(this.Wu(\"Unknown\"),this.qu=this.os.gn(\"online_state_timeout\",1e4,(function(){return t.qu=null,t.ju(\"Backend didn't respond within 10 seconds.\"),t.Wu(\"Offline\"),Promise.resolve()})))},t.prototype.Ku=function(t){\"Online\"===this.state?this.Wu(\"Unknown\"):(this.Bu++,this.Bu>=1&&(this.Gu(),this.ju(\"Connection failed 1 times. Most recent error: \"+t.toString()),this.Wu(\"Offline\")))},t.prototype.set=function(t){this.Gu(),this.Bu=0,\"Online\"===t&&(this.Uu=!1),this.Wu(t)},t.prototype.Wu=function(t){t!==this.state&&(this.state=t,this.fi(t))},t.prototype.ju=function(t){var e=\"Could not reach Cloud Firestore backend. \"+t+\"\\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.\";this.Uu?(v(e),this.Uu=!1):d(\"OnlineStateTracker\",e)},t.prototype.Gu=function(){null!==this.qu&&(this.qu.cancel(),this.qu=null)},t}(),Mo=function(){function t(t,e,n,i,o){var s=this;this.zu=t,this.Hu=e,this.os=n,this.Yu=[],this.Ju=new Map,this.Xu=null,this.Zu=new Set,this.th={},this.eh=o,this.eh.nh((function(t){n.ds((function(){return r.__awaiter(s,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return Yo(this)?(d(\"RemoteStore\",\"Restarting streams for network reachability change.\"),[4,function(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=_(t)).Zu.add(4),[4,jo(e)];case 1:return n.sent(),e.sh.du(),e.ih.du(),e.rh.set(\"Unknown\"),e.Zu.delete(4),[4,qo(e)];case 2:return n.sent(),[2]}}))}))}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.rh=new Co(n,i),this.ih=function(t,e,n){var r=_(t);return r.Mu(),new Uo(e,r.au,r.credentials,r.serializer,n)}(this.Hu,n,{Vu:Xo.bind(null,this),Au:Jo.bind(null,this),bu:Zo.bind(null,this)}),this.sh=function(t,e,n){var r=_(t);return r.Mu(),new Po(e,r.au,r.credentials,r.serializer,n)}(this.Hu,n,{Vu:os.bind(null,this),Au:as.bind(null,this),$u:ss.bind(null,this),Fu:us.bind(null,this)})}return t.prototype.start=function(){return Fo(this)},t}();function Fo(t){var e=_(t);return e.Zu.delete(0),qo(e)}function qo(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return Yo(t)?(Ho(t)?Ko(t):t.rh.set(\"Unknown\"),[4,ns(t)]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}function jo(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,t.sh.stop()];case 1:return e.sent(),[4,t.ih.stop()];case 2:return e.sent(),t.Yu.length>0&&(d(\"RemoteStore\",\"Stopping write stream with \"+t.Yu.length+\" pending writes\"),t.Yu=[]),$o(t),[2]}}))}))}function zo(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return e=_(t),d(\"RemoteStore\",\"RemoteStore shutting down.\"),e.Zu.add(5),[4,jo(e)];case 1:return n.sent(),e.eh.Si(),e.rh.set(\"Unknown\"),[2]}}))}))}function Bo(t,e){var n=_(t);n.Ju.has(e.targetId)||(n.Ju.set(e.targetId,e),Ho(n)?Ko(n):n.ih._u()&&Qo(n,e))}function Go(t,e){var n=_(t);n.Ju.delete(e),n.ih._u()&&Wo(n,e),0===n.Ju.size&&(n.ih._u()?n.ih.wu():Yo(n)&&n.rh.set(\"Unknown\"))}function Qo(t,e){t.Xu.Ee(e.targetId),t.ih.vu(e)}function Wo(t,e){t.Xu.Ee(e),t.ih.Su(e)}function Ko(t){t.Xu=new Kt({Be:function(e){return t.th.Be(e)},qe:function(e){return t.Ju.get(e)||null}}),t.ih.start(),t.rh.Qu()}function Ho(t){return Yo(t)&&!t.ih.lu()&&t.Ju.size>0}function Yo(t){return 0===_(t).Zu.size}function $o(t){t.Xu=null}function Xo(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return t.Ju.forEach((function(e,n){Qo(t,e)})),[2]}))}))}function Jo(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){return $o(t),Ho(t)?(t.rh.Ku(e),Ko(t)):t.rh.set(\"Unknown\"),[2]}))}))}function Zo(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s;return r.__generator(this,(function(u){switch(u.label){case 0:if(t.rh.set(\"Online\"),!(e instanceof Qt&&2===e.state&&e.cause))return[3,6];u.label=1;case 1:return u.trys.push([1,3,,5]),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:n=e.cause,i=0,o=e.targetIds,r.label=1;case 1:return i<o.length?(s=o[i],t.Ju.has(s)?[4,t.th.oh(s,n)]:[3,3]):[3,5];case 2:r.sent(),t.Ju.delete(s),t.Xu.removeTarget(s),r.label=3;case 3:r.label=4;case 4:return i++,[3,1];case 5:return[2]}}))}))}(t,e)];case 2:return u.sent(),[3,5];case 3:return i=u.sent(),d(\"RemoteStore\",\"Failed to remove targets %s: %s \",e.targetIds.join(\",\"),i),[4,ts(t,i)];case 4:return u.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Bt?t.Xu.pe(e):e instanceof Gt?t.Xu.$e(e):t.Xu.Se(e),n.isEqual(at.min()))return[3,13];u.label=7;case 7:return u.trys.push([7,11,,13]),[4,mo(t.zu)];case 8:return o=u.sent(),n.L(o)>=0?[4,function(t,e){var n=t.Xu.Me(e);return n.Gt.forEach((function(n,r){if(n.resumeToken.O()>0){var i=t.Ju.get(r);i&&t.Ju.set(r,i.st(n.resumeToken,e))}})),n.zt.forEach((function(e){var n=t.Ju.get(e);if(n){t.Ju.set(e,n.st(Z.B,n.et)),Wo(t,e);var r=new wt(n.target,e,1,n.sequenceNumber);Qo(t,r)}})),t.th.ah(n)}(t,n)]:[3,10];case 9:u.sent(),u.label=10;case 10:return[3,13];case 11:return d(\"RemoteStore\",\"Failed to raise snapshot:\",s=u.sent()),[4,ts(t,s)];case 12:return u.sent(),[3,13];case 13:return[2]}}))}))}function ts(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i=this;return r.__generator(this,(function(o){switch(o.label){case 0:if(!wr(e))throw e;return t.Zu.add(1),[4,jo(t)];case 1:return o.sent(),t.rh.set(\"Offline\"),n||(n=function(){return mo(t.zu)}),t.os.Ds((function(){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return d(\"RemoteStore\",\"Retrying IndexedDB access\"),[4,n()];case 1:return e.sent(),t.Zu.delete(1),[4,qo(t)];case 2:return e.sent(),[2]}}))}))})),[2]}}))}))}function es(t,e){return e().catch((function(n){return ts(t,n,e)}))}function ns(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:e=_(t),n=e.Yu.length>0?e.Yu[e.Yu.length-1].batchId:-1,r.label=1;case 1:if(!function(t){return Yo(t)&&t.Yu.length<10}(e))return[3,7];r.label=2;case 2:return r.trys.push([2,4,,6]),[4,_o(e.zu,n)];case 3:return null===(i=r.sent())?(0===e.Yu.length&&e.sh.wu(),[3,7]):(n=i.batchId,function(t,e){t.Yu.push(e),t.sh._u()&&t.sh.Cu&&t.sh.Nu(e.mutations)}(e,i),[3,6]);case 4:return o=r.sent(),[4,ts(e,o)];case 5:return r.sent(),[3,6];case 6:return[3,1];case 7:return rs(e)&&is(e),[2]}}))}))}function rs(t){return Yo(t)&&!t.sh.lu()&&t.Yu.length>0}function is(t){t.sh.start()}function os(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){return t.sh.xu(),[2]}))}))}function ss(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n,i;return r.__generator(this,(function(r){for(e=0,n=t.Yu;e<n.length;e++)i=n[e],t.sh.Nu(i.mutations);return[2]}))}))}function us(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return i=t.Yu.shift(),o=Jr.from(i,e,n),[4,es(t,(function(){return t.th.uh(o)}))];case 1:return r.sent(),[4,ns(t)];case 2:return r.sent(),[2]}}))}))}function as(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return e&&t.sh.Cu?[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return bt(i=e.code)&&i!==h.ABORTED?(n=t.Yu.shift(),t.sh.du(),[4,es(t,(function(){return t.th.hh(n.batchId,e)}))]):[3,3];case 1:return r.sent(),[4,ns(t)];case 2:r.sent(),r.label=3;case 3:return[2]}}))}))}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return rs(t)&&is(t),[2]}}))}))}function cs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n;return r.__generator(this,(function(r){switch(r.label){case 0:return n=_(t),e?(n.Zu.delete(2),[4,qo(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Zu.add(2),[4,jo(n)]);case 3:r.sent(),n.rh.set(\"Unknown\"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}var hs=function(t){this.key=t},fs=function(t){this.key=t},ls=function(){function t(t,e){this.query=t,this.lh=e,this._h=null,this.Zt=!1,this.fh=Pt(),this.Qt=Pt(),this.dh=$n(t),this.wh=new Mt(this.dh)}return Object.defineProperty(t.prototype,\"mh\",{get:function(){return this.lh},enumerable:!1,configurable:!0}),t.prototype.Th=function(t,e){var n=this,r=e?e.Eh:new Ft,i=e?e.wh:this.wh,o=e?e.Qt:this.Qt,s=i,u=!1,a=Vn(this.query)&&i.size===this.query.limit?i.last():null,c=Cn(this.query)&&i.size===this.query.limit?i.first():null;if(t.ut((function(t,e){var h=i.get(t),f=e instanceof xn?e:null;f&&(f=Yn(n.query,f)?f:null);var l=!!h&&n.Qt.has(h.key),p=!!f&&(f.Ye||n.Qt.has(f.key)&&f.hasCommittedMutations),d=!1;h&&f?h.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.Ih(h,f)||(r.track({type:2,doc:f}),d=!0,(a&&n.dh(f,a)>0||c&&n.dh(f,c)<0)&&(u=!0)):!h&&f?(r.track({type:0,doc:f}),d=!0):h&&!f&&(r.track({type:1,doc:h}),d=!0,(a||c)&&(u=!0)),d&&(f?(s=s.add(f),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))})),Vn(this.query)||Cn(this.query))for(;s.size>this.query.limit;){var h=Vn(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{wh:s,Eh:r,Ah:u,Qt:o}},t.prototype.Ih=function(t,e){return t.Ye&&e.hasCommittedMutations&&!e.Ye},t.prototype.gr=function(t,e,n){var r=this,i=this.wh;this.wh=t.wh,this.Qt=t.Qt;var o=t.Eh.qt();o.sort((function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return m()}};return n(t)-n(e)}(t.type,e.type)||r.dh(t.doc,e.doc)})),this.Rh(n);var s=e?this.Ph():[],u=0===this.fh.size&&this.Zt?1:0,a=u!==this._h;return this._h=u,0!==o.length||a?{snapshot:new qt(this.query,t.wh,i,o,t.Qt,0===u,a,!1),gh:s}:{gh:s}},t.prototype.Us=function(t){return this.Zt&&\"Offline\"===t?(this.Zt=!1,this.gr({wh:this.wh,Eh:new Ft,Qt:this.Qt,Ah:!1},!1)):{gh:[]}},t.prototype.yh=function(t){return!this.lh.has(t)&&!!this.wh.has(t)&&!this.wh.get(t).Ye},t.prototype.Rh=function(t){var e=this;t&&(t.te.forEach((function(t){return e.lh=e.lh.add(t)})),t.ee.forEach((function(t){})),t.ne.forEach((function(t){return e.lh=e.lh.delete(t)})),this.Zt=t.Zt)},t.prototype.Ph=function(){var t=this;if(!this.Zt)return[];var e=this.fh;this.fh=Pt(),this.wh.forEach((function(e){t.yh(e.key)&&(t.fh=t.fh.add(e.key))}));var n=[];return e.forEach((function(e){t.fh.has(e)||n.push(new fs(e))})),this.fh.forEach((function(t){e.has(t)||n.push(new hs(t))})),n},t.prototype.Vh=function(t){this.lh=t.kc,this.fh=Pt();var e=this.Th(t.documents);return this.gr(e,!0)},t.prototype.ph=function(){return qt.Kt(this.query,this.wh,this.Qt,0===this._h)},t}(),ps=function(t,e,n){this.query=t,this.targetId=e,this.view=n},ds=function(t){this.key=t,this.bh=!1},vs=function(){function t(t,e,n,r,i){this.zu=t,this.Sh=e,this.Dh=n,this.currentUser=r,this.Ch=i,this.Nh=null,this.Fh=new st((function(t){return Kn(t)}),Wn),this.$h=new Map,this.xh=[],this.kh=new Et(S.i),this.Mh=new Map,this.Oh=new No,this.Lh={},this.Bh=new Map,this.qh=no.Ta(),this.onlineState=\"Unknown\",this.Uh=void 0}return Object.defineProperty(t.prototype,\"Qh\",{get:function(){return!0===this.Uh},enumerable:!1,configurable:!0}),t.prototype.subscribe=function(t){this.Nh=t},t.prototype.Wh=function(t){},t}();function ys(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=zs(t)).Wh(\"listen()\"),(s=n.Fh.get(e))?(i=s.targetId,n.Dh.Mi(i),o=s.view.ph(),[3,4]):[3,1];case 1:return[4,bo(n.zu,zn(e))];case 2:return u=r.sent(),a=n.Dh.Mi(u.targetId),i=u.targetId,[4,gs(n,e,i,\"current\"===a)];case 3:o=r.sent(),n.Qh&&Bo(n.Sh,u),r.label=4;case 4:return[2,o]}}))}))}function gs(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u,a,c,h;return r.__generator(this,(function(f){switch(f.label){case 0:return t.jh=function(e,n,i){return function(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=e.view.Th(n)).Ah?[4,Eo(t.zu,e.query,!1).then((function(t){var n=t.documents;return e.view.Th(n,o)}))]:[3,2];case 1:o=r.sent(),r.label=2;case 2:return s=i&&i.Gt.get(e.targetId),u=e.view.gr(o,t.Qh,s),[2,(Ss(t,e.targetId,u.gh),u.snapshot)]}}))}))}(t,e,n,i)},[4,Eo(t.zu,e,!0)];case 1:return o=f.sent(),s=new ls(e,o.kc),u=s.Th(o.documents),a=zt.Xt(n,i&&\"Offline\"!==t.onlineState),c=s.gr(u,t.Qh,a),Ss(t,n,c.gh),h=new ps(e,n,s),[2,(t.Fh.set(e,h),t.$h.has(n)?t.$h.get(n).push(e):t.$h.set(n,[e]),c.snapshot)]}}))}))}function ms(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=_(t)).Wh(\"unlisten()\"),i=n.Fh.get(e),(o=n.$h.get(i.targetId)).length>1?[2,(n.$h.set(i.targetId,o.filter((function(t){return!Wn(t,e)}))),void n.Fh.delete(e))]:n.Qh?(n.Dh.Li(i.targetId),n.Dh.Ni(i.targetId)?[3,2]:[4,Io(n.zu,i.targetId,!1).then((function(){n.Dh.qi(i.targetId),Go(n.Sh,i.targetId),Ns(n,i.targetId)})).catch(Ao)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return Ns(n,i.targetId),[4,Io(n.zu,i.targetId,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}}))}))}function ws(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:(n=_(t)).Wh(\"applyRemoteEvent()\"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,wo(n.zu,e)];case 2:return i=r.sent(),e.Gt.forEach((function(t,e){var r=n.Mh.get(e);r&&(w(t.te.size+t.ee.size+t.ne.size<=1),t.te.size>0?r.bh=!0:t.ee.size>0?w(r.bh):t.ne.size>0&&(w(r.bh),r.bh=!1))})),[4,Ls(n,i,e)];case 3:return r.sent(),[3,6];case 4:return[4,Ao(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function _s(t,e,n){var r=_(t);if(r.Qh&&0===n||!r.Qh&&1===n){r.Wh(\"applyOnlineStateChange()\");var i=[];r.Fh.forEach((function(t,n){var r=n.view.Us(e);r.snapshot&&i.push(r.snapshot)})),r.Nh.Kh(e),r.Nh.bu(i),r.onlineState=e,r.Qh&&r.Dh.ji(e)}}function bs(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u,a,c;return r.__generator(this,(function(r){switch(r.label){case 0:return(i=_(t)).Wh(\"rejectListens()\"),i.Dh.Ui(e,\"rejected\",n),o=i.Mh.get(e),(s=o&&o.key)?(u=(u=new Et(S.i)).rt(s,new kn(s,at.min())),a=Pt().add(s),c=new jt(at.min(),new Map,new Nt($),u,a),[4,ws(i,c)]):[3,2];case 1:return r.sent(),i.kh=i.kh.remove(s),i.Mh.delete(e),ks(i),[3,4];case 2:return[4,Io(i.zu,e,!1).then((function(){return Ns(i,e,n)})).catch(Ao)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}function Is(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:(n=_(t)).Wh(\"applySuccessfulWrite()\"),i=e.batch.batchId,r.label=1;case 1:return r.trys.push([1,4,,6]),[4,go(n.zu,e)];case 2:return o=r.sent(),As(n,i,null),Ts(n,i),n.Dh.xi(i,\"acknowledged\"),[4,Ls(n,o)];case 3:return r.sent(),[3,6];case 4:return[4,Ao(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Es(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o;return r.__generator(this,(function(r){switch(r.label){case 0:(i=_(t)).Wh(\"rejectFailedWrite()\"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,function(t,e){var n=_(t);return n.persistence.runTransaction(\"Reject batch\",\"readwrite-primary\",(function(t){var r;return n.vr.Mo(t,e).next((function(e){return w(null!==e),r=e.keys(),n.vr.Qo(t,e)})).next((function(){return n.vr.Go(t)})).next((function(){return n.$c.$r(t,r)}))}))}(i.zu,e)];case 2:return o=r.sent(),As(i,e,n),Ts(i,e),i.Dh.xi(e,\"rejected\",n),[4,Ls(i,o)];case 3:return r.sent(),[3,6];case 4:return[4,Ao(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))}function Ts(t,e){(t.Bh.get(e)||[]).forEach((function(t){t.resolve()})),t.Bh.delete(e)}function As(t,e,n){var r=_(t),i=r.Lh[r.currentUser.Zs()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.Lh[r.currentUser.Zs()]=i}}function Ns(t,e,n){void 0===n&&(n=null),t.Dh.Li(e);for(var r=0,i=t.$h.get(e);r<i.length;r++){var o=i[r];t.Fh.delete(o),n&&t.Nh.Gh(o,n)}t.$h.delete(e),t.Qh&&t.Oh.Wc(e).forEach((function(e){t.Oh.zo(e)||Ds(t,e)}))}function Ds(t,e){var n=t.kh.get(e);null!==n&&(Go(t.Sh,n),t.kh=t.kh.remove(e),t.Mh.delete(n),ks(t))}function Ss(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof hs?(t.Oh.Fa(o.key,e),xs(t,o)):o instanceof fs?(d(\"SyncEngine\",\"Document no longer in limbo: \"+o.key),t.Oh.xa(o.key,e),t.Oh.zo(o.key)||Ds(t,o.key)):m()}}function xs(t,e){var n=e.key;t.kh.get(n)||(d(\"SyncEngine\",\"New document in limbo: \"+n),t.xh.push(n),ks(t))}function ks(t){for(;t.xh.length>0&&t.kh.size<t.Ch;){var e=t.xh.shift(),n=t.qh.next();t.Mh.set(n,new ds(e)),t.kh=t.kh.rt(e,n),Bo(t.Sh,new wt(zn(Pn(e.path)),n,2,qr.oi))}}function Ls(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u;return r.__generator(this,(function(a){switch(a.label){case 0:return i=_(t),o=[],s=[],u=[],i.Fh.forEach((function(t,r){u.push(i.jh(r,e,n).then((function(t){if(t){i.Qh&&i.Dh.Ui(r.targetId,t.fromCache?\"not-current\":\"current\"),o.push(t);var e=ri.Gr(r.targetId,t);s.push(e)}})))})),[4,Promise.all(u)];case 1:return a.sent(),i.Nh.bu(o),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c,h,f;return r.__generator(this,(function(r){switch(r.label){case 0:n=_(t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.persistence.runTransaction(\"notifyLocalViewChanges\",\"readwrite\",(function(t){return vr.forEach(e,(function(e){return vr.forEach(e.jr,(function(r){return n.persistence.Co.Fa(t,e.targetId,r)})).next((function(){return vr.forEach(e.Kr,(function(r){return n.persistence.Co.xa(t,e.targetId,r)}))}))}))}))];case 2:return r.sent(),[3,4];case 3:if(!wr(i=r.sent()))throw i;return d(\"LocalStore\",\"Failed to update sequence numbers: \"+i),[3,4];case 4:for(o=0,s=e;o<s.length;o++)u=s[o],a=u.targetId,u.fromCache||(c=n.Dc.get(a),h=c.et,f=c.it(h),n.Dc=n.Dc.rt(a,f));return[2]}}))}))}(i.zu,s)];case 2:return a.sent(),[2]}}))}))}function Rs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(o){switch(o.label){case 0:return(n=_(t)).currentUser.isEqual(e)?[3,3]:(d(\"SyncEngine\",\"User change. New user:\",e.Zs()),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return n=_(t),i=n.vr,o=n.$c,[4,n.persistence.runTransaction(\"Handle user change\",\"readonly\",(function(t){var r;return n.vr.qo(t).next((function(s){return r=s,i=n.persistence.Ic(e),o=new ni(n.Fc,i,n.persistence.Pc()),i.qo(t)})).next((function(e){for(var n=[],i=[],s=Pt(),u=0,a=r;u<a.length;u++){var c=a[u];n.push(c.batchId);for(var h=0,f=c.mutations;h<f.length;h++){var l=f[h];s=s.add(l.key)}}for(var p=0,d=e;p<d.length;p++){var v=d[p];i.push(v.batchId);for(var y=0,g=v.mutations;y<g.length;y++){var m=g[y];s=s.add(m.key)}}return o.$r(t,s).next((function(t){return{zh:t,Hh:n,Yh:i}}))}))}))];case 1:return s=r.sent(),[2,(n.vr=i,n.$c=o,n.Sc.xc(n.$c),s)]}}))}))}(n.zu,e)]);case 1:return i=o.sent(),n.currentUser=e,function(t,e){t.Bh.forEach((function(t){t.forEach((function(t){t.reject(new f(h.CANCELLED,\"'waitForPendingWrites' promise is rejected due to a user change.\"))}))})),t.Bh.clear()}(n),n.Dh.Wi(e,i.Hh,i.Yh),[4,Ls(n,i.zh)];case 2:o.sent(),o.label=3;case 3:return[2]}}))}))}function Os(t,e){var n=_(t),r=n.Mh.get(e);if(r&&r.bh)return Pt().add(r.key);var i=Pt(),o=n.$h.get(e);if(!o)return i;for(var s=0,u=o;s<u.length;s++){var a=u[s],c=n.Fh.get(a);i=i.xt(c.view.mh)}return i}function Us(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return[4,Eo((n=_(t)).zu,e.query,!0)];case 1:return i=r.sent(),o=e.view.Vh(i),[2,(n.Qh&&Ss(n,e.targetId,o.gh),o)]}}))}))}function Ps(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=_(t)).Wh(\"applyBatchState()\"),[4,function(t,e){var n=_(t),r=_(n.vr);return n.persistence.runTransaction(\"Lookup mutation documents\",\"readonly\",(function(t){return r.Oo(t,e).next((function(e){return e?n.$c.$r(t,e):vr.resolve(null)}))}))}(o.zu,e)];case 1:return null===(s=r.sent())?[3,6]:\"pending\"!==n?[3,3]:[4,ns(o.Sh)];case 2:return r.sent(),[3,4];case 3:\"acknowledged\"===n||\"rejected\"===n?(As(o,e,i||null),function(t,e){_(_(t).vr).jo(e)}(o.zu,e)):m(),r.label=4;case 4:return[4,Ls(o,s)];case 5:return r.sent(),[3,7];case 6:d(\"SyncEngine\",\"Cannot apply mutation batch with id: \"+e),r.label=7;case 7:return[2]}}))}))}function Vs(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c,h;return r.__generator(this,(function(r){switch(r.label){case 0:return zs(n=_(t)),Bs(n),!0!==e||!0===n.Uh?[3,3]:(i=n.Dh.Di(),[4,Cs(n,i.A())]);case 1:return o=r.sent(),n.Uh=!0,[4,cs(n.Sh,!0)];case 2:for(r.sent(),s=0,u=o;s<u.length;s++)a=u[s],Bo(n.Sh,a);return[3,7];case 3:return!1!==e||!1===n.Uh?[3,7]:(c=[],h=Promise.resolve(),n.$h.forEach((function(t,e){n.Dh.Bi(e)?c.push(e):h=h.then((function(){return Ns(n,e),Io(n.zu,e,!0)})),Go(n.Sh,e)})),[4,h]);case 4:return r.sent(),[4,Cs(n,c)];case 5:return r.sent(),function(t){var e=_(t);e.Mh.forEach((function(t,n){Go(e.Sh,n)})),e.Oh.jc(),e.Mh=new Map,e.kh=new Et(S.i)}(n),n.Uh=!1,[4,cs(n.Sh,!1)];case 6:r.sent(),r.label=7;case 7:return[2]}}))}))}function Cs(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a,c,h,f,l,p,d,v,y;return r.__generator(this,(function(r){switch(r.label){case 0:n=_(t),i=[],o=[],s=0,u=e,r.label=1;case 1:return s<u.length?(a=u[s],c=void 0,(h=n.$h.get(a))&&0!==h.length?[4,bo(n.zu,zn(h[0]))]:[3,7]):[3,13];case 2:c=r.sent(),f=0,l=h,r.label=3;case 3:return f<l.length?(p=l[f],d=n.Fh.get(p),[4,Us(n,d)]):[3,6];case 4:(v=r.sent()).snapshot&&o.push(v.snapshot),r.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,To(n.zu,a)];case 8:return y=r.sent(),[4,bo(n.zu,y)];case 9:return c=r.sent(),[4,gs(n,Ms(y),a,!1)];case 10:r.sent(),r.label=11;case 11:i.push(c),r.label=12;case 12:return s++,[3,1];case 13:return[2,(n.Nh.bu(o),i)]}}))}))}function Ms(t){return Un(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,\"F\",t.startAt,t.endAt)}function Fs(t){var e=_(t);return _(_(e.zu).persistence).Vi()}function qs(t,e,n,i){return r.__awaiter(this,void 0,void 0,(function(){var o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:return(o=_(t)).Uh?(d(\"SyncEngine\",\"Ignoring unexpected query state notification.\"),[3,8]):[3,1];case 1:if(!o.$h.has(e))return[3,8];switch(n){case\"current\":case\"not-current\":return[3,2];case\"rejected\":return[3,5]}return[3,7];case 2:return[4,function(t){var e=_(t),n=_(e.Fc);return e.persistence.runTransaction(\"Get new document changes\",\"readonly\",(function(t){return n.ia(t,e.Nc)})).then((function(t){var n=t.ra,r=t.readTime;return e.Nc=r,n}))}(o.zu)];case 3:return s=r.sent(),u=jt.Jt(e,\"current\"===n),[4,Ls(o,s,u)];case 4:return r.sent(),[3,8];case 5:return[4,Io(o.zu,e,!0)];case 6:return r.sent(),Ns(o,e,i),[3,8];case 7:m(),r.label=8;case 8:return[2]}}))}))}function js(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u,a,c,h,f,l,p;return r.__generator(this,(function(v){switch(v.label){case 0:if(!(i=zs(t)).Uh)return[3,10];o=0,s=e,v.label=1;case 1:return o<s.length?(u=s[o],i.$h.has(u)?(d(\"SyncEngine\",\"Adding an already active target \"+u),[3,5]):[4,To(i.zu,u)]):[3,6];case 2:return a=v.sent(),[4,bo(i.zu,a)];case 3:return c=v.sent(),[4,gs(i,Ms(a),c.targetId,!1)];case 4:v.sent(),Bo(i.Sh,c),v.label=5;case 5:return o++,[3,1];case 6:h=function(t){return r.__generator(this,(function(e){switch(e.label){case 0:return i.$h.has(t)?[4,Io(i.zu,t,!1).then((function(){Go(i.Sh,t),Ns(i,t)})).catch(Ao)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},f=0,l=n,v.label=7;case 7:return f<l.length?(p=l[f],[5,h(p)]):[3,10];case 8:v.sent(),v.label=9;case 9:return f++,[3,7];case 10:return[2]}}))}))}function zs(t){var e=_(t);return e.Sh.th.ah=ws.bind(null,e),e.Sh.th.Be=Os.bind(null,e),e.Sh.th.oh=bs.bind(null,e),e}function Bs(t){var e=_(t);return e.Sh.th.uh=Is.bind(null,e),e.Sh.th.hh=Es.bind(null,e),e}var Gs=function(){function t(){}return t.prototype.xc=function(t){this.Jh=t},t.prototype.Or=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.rn.length||1===t.rn.length&&t.rn[0].field.p())}(e)||n.isEqual(at.min())?this.Xh(t,e):this.Jh.$r(t,r).next((function(s){var u=i.Zh(e,s);return(Vn(e)||Cn(e))&&i.Ah(e.on,u,r,n)?i.Xh(t,e):(p()<=o.LogLevel.DEBUG&&d(\"IndexFreeQueryEngine\",\"Re-using previous result from %s to execute query: %s\",n.toString(),Hn(e)),i.Jh.Or(t,e,n).next((function(t){return u.forEach((function(e){t=t.rt(e.key,e)})),t})))}))},t.prototype.Zh=function(t,e){var n=new Nt($n(t));return e.forEach((function(e,r){r instanceof xn&&Yn(t,r)&&(n=n.add(r))})),n},t.prototype.Ah=function(t,e,n,r){if(n.size!==e.size)return!0;var i=\"F\"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.L(r)>0)},t.prototype.Xh=function(t,e){return p()<=o.LogLevel.DEBUG&&d(\"IndexFreeQueryEngine\",\"Using full collection scan to execute query:\",Hn(e)),this.Jh.Or(t,e,at.min())},t}(),Qs=function(){function t(t,e){this.Sr=t,this.Co=e,this.vr=[],this.tl=1,this.el=new Nt(Do.Oc)}return t.prototype.$o=function(t){return vr.resolve(0===this.vr.length)},t.prototype.xo=function(t,e,n,r){var i=this.tl;this.tl++,this.vr.length>0&&this.vr[this.vr.length-1];var o=new Xr(i,e,n,r);this.vr.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.el=this.el.add(new Do(a.key,i)),this.Sr.ko(t,a.key.path.h())}return vr.resolve(o)},t.prototype.Mo=function(t,e){return vr.resolve(this.nl(e))},t.prototype.Lo=function(t,e){var n=e+1,r=this.sl(n),i=r<0?0:r;return vr.resolve(this.vr.length>i?this.vr[i]:null)},t.prototype.Bo=function(){return vr.resolve(0===this.vr.length?-1:this.tl-1)},t.prototype.qo=function(t){return vr.resolve(this.vr.slice())},t.prototype.Cr=function(t,e){var n=this,r=new Do(e,0),i=new Do(e,Number.POSITIVE_INFINITY),o=[];return this.el.Nt([r,i],(function(t){var e=n.nl(t.Gc);o.push(e)})),vr.resolve(o)},t.prototype.Mr=function(t,e){var n=this,r=new Nt($);return e.forEach((function(t){var e=new Do(t,0),i=new Do(t,Number.POSITIVE_INFINITY);n.el.Nt([e,i],(function(t){r=r.add(t.Gc)}))})),vr.resolve(this.il(r))},t.prototype.Qr=function(t,e){var n=e.path,r=n.length+1,i=n;S.F(i)||(i=i.child(\"\"));var o=new Do(new S(i),0),s=new Nt($);return this.el.Ft((function(t){var e=t.key.path;return!!n.T(e)&&(e.length===r&&(s=s.add(t.Gc)),!0)}),o),vr.resolve(this.il(s))},t.prototype.il=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.nl(t);null!==r&&n.push(r)})),n},t.prototype.Qo=function(t,e){var n=this;w(0===this.rl(e.batchId,\"removed\")),this.vr.shift();var r=this.el;return vr.forEach(e.mutations,(function(i){var o=new Do(i.key,e.batchId);return r=r.delete(o),n.Co.Ko(t,i.key)})).next((function(){n.el=r}))},t.prototype.jo=function(t){},t.prototype.zo=function(t,e){var n=new Do(e,0),r=this.el.$t(n);return vr.resolve(e.isEqual(r&&r.key))},t.prototype.Go=function(t){return this.vr.length,vr.resolve()},t.prototype.rl=function(t,e){return this.sl(t)},t.prototype.sl=function(t){return 0===this.vr.length?0:t-this.vr[0].batchId},t.prototype.nl=function(t){var e=this.sl(t);return e<0||e>=this.vr.length?null:this.vr[e]},t}(),Ws=function(){function t(t,e){this.Sr=t,this.ol=e,this.docs=new Et(S.i),this.size=0}return t.prototype.Tr=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ol(e);return this.docs=this.docs.rt(r,{Zo:e,size:s,readTime:n}),this.size+=s-o,this.Sr.ko(t,r.path.h())},t.prototype.Ir=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.Ar=function(t,e){var n=this.docs.get(e);return vr.resolve(n?n.Zo:null)},t.prototype.getEntries=function(t,e){var n=this,r=kt();return e.forEach((function(t){var e=n.docs.get(t);r=r.rt(t,e?e.Zo:null)})),vr.resolve(r)},t.prototype.Or=function(t,e,n){for(var r=Rt(),i=new S(e.path.child(\"\")),o=this.docs._t(i);o.It();){var s=o.Et(),u=s.key,a=s.value,c=a.Zo,h=a.readTime;if(!e.path.T(u.path))break;h.L(n)<=0||c instanceof xn&&Yn(e,c)&&(r=r.rt(c.key,c))}return vr.resolve(r)},t.prototype.al=function(t,e){return vr.forEach(this.docs,(function(t){return e(t)}))},t.prototype.aa=function(e){return new t.ca(this)},t.prototype.ha=function(t){return vr.resolve(this.size)},t}();Ws.ca=function(t){function e(e){var n=this;return(n=t.call(this)||this).la=e,n}return r.__extends(e,t),e.prototype.gr=function(t){var e=this,n=[];return this.dr.forEach((function(r,i){i?n.push(e.la.Tr(t,i,e.readTime)):e.la.Ir(r)})),vr.$n(n)},e.prototype.Rr=function(t,e){return this.la.Ar(t,e)},e.prototype.Pr=function(t,e){return this.la.getEntries(t,e)},e}(Zr);var Ks=function(){function t(t){this.persistence=t,this.cl=new st((function(t){return dt(t)}),vt),this.lastRemoteSnapshotVersion=at.min(),this.highestTargetId=0,this.ul=0,this.hl=new No,this.targetCount=0,this.ll=no.ma()}return t.prototype.De=function(t,e){return this.cl.forEach((function(t,n){return e(n)})),vr.resolve()},t.prototype.Ra=function(t){return vr.resolve(this.lastRemoteSnapshotVersion)},t.prototype.Pa=function(t){return vr.resolve(this.ul)},t.prototype.Ea=function(t){return this.highestTargetId=this.ll.next(),vr.resolve(this.highestTargetId)},t.prototype.ga=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ul&&(this.ul=e),vr.resolve()},t.prototype.Va=function(t){this.cl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ll=new no(e),this.highestTargetId=e),t.sequenceNumber>this.ul&&(this.ul=t.sequenceNumber)},t.prototype.ya=function(t,e){return this.Va(e),this.targetCount+=1,vr.resolve()},t.prototype.ba=function(t,e){return this.Va(e),vr.resolve()},t.prototype.va=function(t,e){return this.cl.delete(e.target),this.hl.Wc(e.targetId),this.targetCount-=1,vr.resolve()},t.prototype.Vo=function(t,e,n){var r=this,i=0,o=[];return this.cl.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.cl.delete(s),o.push(r.Sa(t,u.targetId)),i++)})),vr.$n(o).next((function(){return i}))},t.prototype.Da=function(t){return vr.resolve(this.targetCount)},t.prototype.Ca=function(t,e){var n=this.cl.get(e)||null;return vr.resolve(n)},t.prototype.Na=function(t,e,n){return this.hl.qc(e,n),vr.resolve()},t.prototype.$a=function(t,e,n){this.hl.Qc(e,n);var r=this.persistence.Co,i=[];return r&&e.forEach((function(e){i.push(r.Ko(t,e))})),vr.$n(i)},t.prototype.Sa=function(t,e){return this.hl.Wc(e),vr.resolve()},t.prototype.ka=function(t,e){var n=this.hl.Kc(e);return vr.resolve(n)},t.prototype.zo=function(t,e){return vr.resolve(this.hl.zo(e))},t}(),Hs=function(){function t(t){var e=this;this._l={},this.Ba=new qr(0),this.qa=!1,this.qa=!0,this.Co=t(this),this.Ha=new Ks(this),this.Sr=new Pi,this.br=new Ws(this.Sr,(function(t){return e.Co.fl(t)}))}return t.prototype.start=function(){return Promise.resolve()},t.prototype.Si=function(){return this.qa=!1,Promise.resolve()},Object.defineProperty(t.prototype,\"Ti\",{get:function(){return this.qa},enumerable:!1,configurable:!0}),t.prototype.nc=function(){},t.prototype.sc=function(){},t.prototype.Pc=function(){return this.Sr},t.prototype.Ic=function(t){var e=this._l[t.Zs()];return e||(e=new Qs(this.Sr,this.Co),this._l[t.Zs()]=e),e},t.prototype.Ac=function(){return this.Ha},t.prototype.Rc=function(){return this.br},t.prototype.runTransaction=function(t,e,n){var r=this;d(\"MemoryPersistence\",\"Starting transaction:\",t);var i=new Ys(this.Ba.next());return this.Co.dl(),n(i).next((function(t){return r.Co.wl(i).next((function(){return t}))})).Nn().then((function(t){return i.pr(),t}))},t.prototype.ml=function(t,e){return vr.xn(Object.values(this._l).map((function(n){return function(){return n.zo(t,e)}})))},t}(),Ys=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ma=e,n}return r.__extends(e,t),e}(ei),$s=function(){function t(t){this.persistence=t,this.Tl=new No,this.El=null}return t.Il=function(e){return new t(e)},Object.defineProperty(t.prototype,\"Al\",{get:function(){if(this.El)return this.El;throw m()},enumerable:!1,configurable:!0}),t.prototype.Fa=function(t,e,n){return this.Tl.Fa(n,e),this.Al.delete(n.toString()),vr.resolve()},t.prototype.xa=function(t,e,n){return this.Tl.xa(n,e),this.Al.add(n.toString()),vr.resolve()},t.prototype.Ko=function(t,e){return this.Al.add(e.toString()),vr.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.Tl.Wc(e.targetId).forEach((function(t){return n.Al.add(t.toString())}));var r=this.persistence.Ac();return r.ka(t,e.targetId).next((function(t){t.forEach((function(t){return n.Al.add(t.toString())}))})).next((function(){return r.va(t,e)}))},t.prototype.dl=function(){this.El=new Set},t.prototype.wl=function(t){var e=this,n=this.persistence.Rc().aa();return vr.forEach(this.Al,(function(r){var i=S.D(r);return e.Rl(t,i).next((function(t){t||n.Ir(i)}))})).next((function(){return e.El=null,n.apply(t)}))},t.prototype.vc=function(t,e){var n=this;return this.Rl(t,e).next((function(t){t?n.Al.delete(e.toString()):n.Al.add(e.toString())}))},t.prototype.fl=function(t){return 0},t.prototype.Rl=function(t,e){var n=this;return vr.xn([function(){return vr.resolve(n.Tl.zo(e))},function(){return n.persistence.Ac().zo(t,e)},function(){return n.persistence.ml(t,e)}])},t}(),Xs=function(){function t(t){this.Pl=t.Pl,this.gl=t.gl}return t.prototype.Vu=function(t){this.yl=t},t.prototype.Au=function(t){this.Vl=t},t.prototype.onMessage=function(t){this.pl=t},t.prototype.close=function(){this.gl()},t.prototype.send=function(t){this.Pl(t)},t.prototype.bl=function(){this.yl()},t.prototype.vl=function(t){this.Vl(t)},t.prototype.Sl=function(t){this.pl(t)},t}(),Js={BatchGetDocuments:\"batchGet\",Commit:\"commit\",RunQuery:\"runQuery\"},Zs=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n}return r.__extends(e,t),e.prototype.xl=function(t,e,n,r){return new Promise((function(i,o){var s=new u.XhrIo;s.listenOnce(u.EventType.COMPLETE,(function(){try{switch(s.getLastErrorCode()){case u.ErrorCode.NO_ERROR:var e=s.getResponseJson();d(\"Connection\",\"XHR received:\",JSON.stringify(e)),i(e);break;case u.ErrorCode.TIMEOUT:d(\"Connection\",'RPC \"'+t+'\" timed out'),o(new f(h.DEADLINE_EXCEEDED,\"Request time out\"));break;case u.ErrorCode.HTTP_ERROR:var n=s.getStatus();if(d(\"Connection\",'RPC \"'+t+'\" failed with status:',n,\"response text:\",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(\"_\",\"-\");return Object.values(h).indexOf(e)>=0?e:h.UNKNOWN}(r.status);o(new f(a,r.message))}else o(new f(h.UNKNOWN,\"Server responded with status \"+s.getStatus()))}else o(new f(h.UNAVAILABLE,\"Connection failed.\"));break;default:m()}}finally{d(\"Connection\",'RPC \"'+t+'\" completed.')}}));var a=JSON.stringify(r);s.send(e,\"POST\",a,n,15)}))},e.prototype.pu=function(t,e){var n=[this.Cl,\"/\",\"google.firestore.v1.Firestore\",\"/\",t,\"/channel\"],r=u.createWebChannelTransport(),i={httpSessionIdParam:\"gsessionid\",initMessageHeaders:{},messageUrlParams:{database:\"projects/\"+this.U.projectId+\"/databases/\"+this.U.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.$l(i.initMessageHeaders,e),s.isMobileCordova()||s.isReactNative()||s.isElectron()||s.isIE()||s.isUWP()||s.isBrowserExtension()||(i.httpHeadersOverwriteParam=\"$httpHeaders\");var o=n.join(\"\");d(\"Connection\",\"Creating WebChannel: \"+o,i);var a=r.createWebChannel(o,i),c=!1,l=!1,p=new Xs({Pl:function(t){l?d(\"Connection\",\"Not sending because WebChannel is closed:\",t):(c||(d(\"Connection\",\"Opening WebChannel transport.\"),a.open(),c=!0),d(\"Connection\",\"WebChannel sending:\",t),a.send(t))},gl:function(){return a.close()}}),v=function(t,e){a.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))};return v(u.WebChannel.EventType.OPEN,(function(){l||d(\"Connection\",\"WebChannel transport opened.\")})),v(u.WebChannel.EventType.CLOSE,(function(){l||(l=!0,d(\"Connection\",\"WebChannel transport closed\"),p.vl())})),v(u.WebChannel.EventType.ERROR,(function(t){l||(l=!0,y(\"Connection\",\"WebChannel transport errored:\",t),p.vl(new f(h.UNAVAILABLE,\"The operation could not be completed\")))})),v(u.WebChannel.EventType.MESSAGE,(function(t){var e;if(!l){var n=t.data[0];w(!!n);var r=n,i=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(i){d(\"Connection\",\"WebChannel received error:\",i);var o=i.status,s=function(t){var e=gt[t];if(void 0!==e)return It(e)}(o),u=i.message;void 0===s&&(s=h.INTERNAL,u=\"Unknown error status: \"+o+\" with message \"+i.message),l=!0,p.vl(new f(s,u)),a.close()}else d(\"Connection\",\"WebChannel received:\",n),p.Sl(n)}})),setTimeout((function(){p.bl()}),0),p},e}(function(){function t(t){this.Dl=t,this.U=t.U;var e=t.ssl?\"https\":\"http\";this.Cl=e+\"://\"+t.host,this.Nl=\"projects/\"+this.U.projectId+\"/databases/\"+this.U.database+\"/documents\"}return t.prototype.Ou=function(t,e,n,r){var i=this.Fl(t,e);d(\"RestConnection\",\"Sending: \",i,n);var o={};return this.$l(o,r),this.xl(t,i,o,n).then((function(t){return d(\"RestConnection\",\"Received: \",t),t}),(function(e){throw y(\"RestConnection\",t+\" failed with error: \",e,\"url: \",i,\"request:\",n),e}))},t.prototype.Lu=function(t,e,n,r){return this.Ou(t,e,n,r)},t.prototype.$l=function(t,e){if(t[\"X-Goog-Api-Client\"]=\"gl-js/ fire/7.20.0\",t[\"Content-Type\"]=\"text/plain\",e)for(var n in e.zc)e.zc.hasOwnProperty(n)&&(t[n]=e.zc[n])},t.prototype.Fl=function(t,e){var n=Js[t];return this.Cl+\"/v1/\"+e+\":\"+n},t}()),tu=function(){function t(){var t=this;this.kl=function(){return t.Ml()},this.Ol=function(){return t.Ll()},this.Bl=[],this.ql()}return t.prototype.nh=function(t){this.Bl.push(t)},t.prototype.Si=function(){window.removeEventListener(\"online\",this.kl),window.removeEventListener(\"offline\",this.Ol)},t.prototype.ql=function(){window.addEventListener(\"online\",this.kl),window.addEventListener(\"offline\",this.Ol)},t.prototype.Ml=function(){d(\"ConnectivityMonitor\",\"Network connectivity changed: AVAILABLE\");for(var t=0,e=this.Bl;t<e.length;t++)(0,e[t])(0)},t.prototype.Ll=function(){d(\"ConnectivityMonitor\",\"Network connectivity changed: UNAVAILABLE\");for(var t=0,e=this.Bl;t<e.length;t++)(0,e[t])(1)},t.On=function(){return\"undefined\"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),eu=function(){function t(){}return t.prototype.nh=function(t){},t.prototype.Si=function(){},t}();function nu(t){return new ye(t,!0)}var ru=\"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.\",iu=function(){function t(){}return t.prototype.initialize=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.Dh=this.Ul(t),this.persistence=this.Ql(t),[4,this.persistence.start()];case 1:return e.sent(),this.Wl=this.jl(t),this.zu=this.Kl(t),[2]}}))}))},t.prototype.jl=function(t){return null},t.prototype.Kl=function(t){return e=this.persistence,n=new Gs,r=t.Gl,new yo(e,n,r);var e,n,r},t.prototype.Ql=function(t){if(t.Hl.zl)throw new f(h.FAILED_PRECONDITION,ru);return new Hs($s.Il)},t.prototype.Ul=function(t){return new $r},t.prototype.terminate=function(){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.Wl&&this.Wl.stop(),[4,this.Dh.Si()];case 1:return t.sent(),[4,this.persistence.Si()];case 2:return t.sent(),[2]}}))}))},t.prototype.clearPersistence=function(t,e){throw new f(h.FAILED_PRECONDITION,ru)},t}(),ou=function(t){function e(e){var n=this;return(n=t.call(this)||this).Yl=e,n}return r.__extends(e,t),e.prototype.initialize=function(e){return r.__awaiter(this,void 0,void 0,(function(){var n,i=this;return r.__generator(this,(function(o){switch(o.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return o.sent(),[4,this.Yl.initialize(this,e)];case 2:return o.sent(),n=this.Yl._i,this.Dh instanceof Yr?(this.Dh._i={tr:Ps.bind(null,n),er:qs.bind(null,n),nr:js.bind(null,n),Vi:Fs.bind(null,n)},[4,this.Dh.start()]):[3,4];case 3:o.sent(),o.label=4;case 4:return[4,this.persistence.ec((function(t){return r.__awaiter(i,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return[4,Vs(this.Yl._i,t)];case 1:return e.sent(),this.Wl&&(t&&!this.Wl.Ti?this.Wl.start(this.zu):t||this.Wl.stop()),[2]}}))}))}))];case 5:return o.sent(),[2]}}))}))},e.prototype.Ul=function(t){if(t.Hl.zl&&t.Hl.synchronizeTabs){var e=Ar();if(!Yr.On(e))throw new f(h.UNIMPLEMENTED,\"IndexedDB persistence is only available on platforms that support LocalStorage.\");var n=vo(t.Dl.U,t.Dl.persistenceKey);return new Yr(e,t.os,n,t.clientId,t.Gl)}return new $r},e}(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.initialize=function(e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,function(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n;return r.__generator(this,(function(r){return e=_(t),n=_(e.Fc),[2,e.persistence.runTransaction(\"Synchronize last document change read time\",\"readonly\",(function(t){return n.oa(t)})).then((function(t){e.Nc=t}))]}))}))}(this.zu)];case 2:return n.sent(),[2]}}))}))},e.prototype.jl=function(t){var e=this.persistence.Co.do;return new ai(e,t.os)},e.prototype.Ql=function(t){var e=vo(t.Dl.U,t.Dl.persistenceKey),n=nu(t.Dl.U);return new co(t.Hl.synchronizeTabs,e,t.clientId,ui.oo(t.Hl.cacheSizeBytes),t.os,Ar(),Nr(),n,this.Dh,t.Hl.La)},e.prototype.Ul=function(t){return new $r},e.prototype.clearPersistence=function(t,e){return function(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return yr.On()?(e=t+\"main\",[4,yr.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))}(vo(t,e))},e}(iu)),su=function(){function t(){}return t.prototype.initialize=function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n=this;return r.__generator(this,(function(r){switch(r.label){case 0:return this.zu?[3,2]:(this.zu=t.zu,this.Dh=t.Dh,this.Hu=this.Jl(e),this.Sh=this.Xl(e),this._i=this.Zl(e),this.t_=this.e_(e),this._i.subscribe({bu:Ur.bind(null,this.t_),Gh:Pr.bind(null,this.t_),Kh:Vr.bind(null,this.t_)}),this.Dh.fi=function(t){return _s(n._i,t,1)},this.Sh.th.n_=Rs.bind(null,this._i),[4,cs(this.Sh,this._i.Qh)]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype.e_=function(t){return new Lr},t.prototype.Jl=function(t){var e,n=nu(t.Dl.U),r=(e=t.Dl,new Zs(e));return function(t,e,n){return new Vo(t,e,n)}(t.credentials,r,n)},t.prototype.Xl=function(t){var e,n,r,i,o,s=this;return e=this.zu,n=this.Hu,r=t.os,i=function(t){return _s(s._i,t,0)},o=tu.On()?new tu:new eu,new Mo(e,n,r,i,o)},t.prototype.Zl=function(t){return function(t,e,n,r,i,o){var s=new vs(t,e,n,r,i);return o&&(s.Uh=!0),s}(this.zu,this.Sh,this.Dh,t.Gl,t.Ch,!t.Hl.zl||!t.Hl.synchronizeTabs)},t.prototype.terminate=function(){return zo(this.Sh)},t}();function uu(t){return function(t,e){if(\"object\"!=typeof t||null===t)return!1;for(var n=t,r=0,i=[\"next\",\"error\",\"complete\"];r<i.length;r++){var o=i[r];if(o in n&&\"function\"==typeof n[o])return!0}return!1}(t)}var au=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.s_(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.s_(this.observer.error,t):console.error(\"Uncaught Error in snapshot listener:\",t)},t.prototype.i_=function(){this.muted=!0},t.prototype.s_=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},t}(),cu=function(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new f(h.INVALID_ARGUMENT,\"Function FieldPath() requires its fieldNames argument to be an array with at least \"+K(1,\"element\")+\".\")}(0,t);for(var e=0;e<t.length;++e)if(O(\"FieldPath\",\"string\",e,t[e]),0===t[e].length)throw new f(h.INVALID_ARGUMENT,\"Invalid field name at argument $(i + 1). Field names must not be empty.\");this.r_=new D(t)},hu=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.call(this,e)||this}return r.__extends(e,t),e.documentId=function(){return new e(D.v().R())},e.prototype.isEqual=function(t){if(!(t instanceof e))throw G(\"isEqual\",\"FieldPath\",1,t);return this.r_.isEqual(t.r_)},e}(cu),fu=new RegExp(\"[~\\\\*/\\\\[\\\\]]\"),lu=function(){this.o_=this},pu=function(t){function e(e){var n=this;return(n=t.call(this)||this).a_=e,n}return r.__extends(e,t),e.prototype.c_=function(t){if(2!==t.u_)throw 1===t.u_?t.h_(this.a_+\"() can only appear at the top level of your update data\"):t.h_(this.a_+\"() cannot be used with set() unless you pass {merge:true}\");return t.Qe.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(lu);function du(t,e,n){return new Du({u_:3,l_:e.settings.l_,methodName:t.a_,__:n},e.U,e.serializer,e.ignoreUndefinedProperties)}var vu=function(t){function e(e){var n=this;return(n=t.call(this)||this).a_=e,n}return r.__extends(e,t),e.prototype.c_=function(t){return new un(t.path,new Xe)},e.prototype.isEqual=function(t){return t instanceof e},e}(lu),yu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).a_=e,r.f_=n,r}return r.__extends(e,t),e.prototype.c_=function(t){var e=du(this,t,!0),n=this.f_.map((function(t){return Ou(t,e)})),r=new Je(n);return new un(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(lu),gu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).a_=e,r.f_=n,r}return r.__extends(e,t),e.prototype.c_=function(t){var e=du(this,t,!0),n=this.f_.map((function(t){return Ou(t,e)})),r=new tn(n);return new un(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(lu),mu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).a_=e,r.d_=n,r}return r.__extends(e,t),e.prototype.c_=function(t){var e=new nn(t.serializer,we(t.serializer,this.d_));return new un(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(lu),wu=function(t){function e(){return t.call(this)||this}return r.__extends(e,t),e.delete=function(){return x(\"FieldValue.delete\",arguments),new _u(new pu(\"FieldValue.delete\"))},e.serverTimestamp=function(){return x(\"FieldValue.serverTimestamp\",arguments),new _u(new vu(\"FieldValue.serverTimestamp\"))},e.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return L(\"FieldValue.arrayUnion\",arguments,1),new _u(new yu(\"FieldValue.arrayUnion\",t))},e.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return L(\"FieldValue.arrayRemove\",arguments,1),new _u(new gu(\"FieldValue.arrayRemove\",t))},e.increment=function(t){return O(\"FieldValue.increment\",\"number\",1,t),k(\"FieldValue.increment\",arguments,1),new _u(new mu(\"FieldValue.increment\",t))},e}(lu),_u=function(t){function e(e){var n=this;return(n=t.call(this)||this).o_=e,n.a_=e.a_,n}return r.__extends(e,t),e.prototype.c_=function(t){return this.o_.c_(t)},e.prototype.isEqual=function(t){return t instanceof e&&this.o_.isEqual(t.o_)},e}(wu),bu=function(){function t(t,e){if(k(\"GeoPoint\",arguments,2),O(\"GeoPoint\",\"number\",1,t),O(\"GeoPoint\",\"number\",2,e),!isFinite(t)||t<-90||t>90)throw new f(h.INVALID_ARGUMENT,\"Latitude must be a number between -90 and 90, but was: \"+t);if(!isFinite(e)||e<-180||e>180)throw new f(h.INVALID_ARGUMENT,\"Longitude must be a number between -180 and 180, but was: \"+e);this.w_=t,this.m_=e}return Object.defineProperty(t.prototype,\"latitude\",{get:function(){return this.w_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"longitude\",{get:function(){return this.m_},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.w_===t.w_&&this.m_===t.m_},t.prototype.toJSON=function(){return{latitude:this.w_,longitude:this.m_}},t.prototype.H=function(t){return $(this.w_,t.w_)||$(this.m_,t.m_)},t}(),Iu=/^__.*__$/,Eu=function(t,e,n){this.T_=t,this.E_=e,this.I_=n},Tu=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.A_=function(t,e){var n=[];return null!==this.Qe?n.push(new mn(t,this.data,this.Qe,e)):n.push(new gn(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new _n(t,this.fieldTransforms)),n},t}(),Au=function(){function t(t,e,n){this.data=t,this.Qe=e,this.fieldTransforms=n}return t.prototype.A_=function(t,e){var n=[new mn(t,this.data,this.Qe,e)];return this.fieldTransforms.length>0&&n.push(new _n(t,this.fieldTransforms)),n},t}();function Nu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw m()}}var Du=function(){function t(t,e,n,r,i,o){this.settings=t,this.U=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.R_(),this.fieldTransforms=i||[],this.Qe=o||[]}return Object.defineProperty(t.prototype,\"path\",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"u_\",{get:function(){return this.settings.u_},enumerable:!1,configurable:!0}),t.prototype.P_=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.U,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Qe)},t.prototype.g_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.P_({path:n,__:!1});return r.y_(t),r},t.prototype.V_=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.P_({path:n,__:!1});return r.R_(),r},t.prototype.p_=function(t){return this.P_({path:void 0,__:!0})},t.prototype.h_=function(t){return Fu(t,this.settings.methodName,this.settings.b_||!1,this.path,this.settings.l_)},t.prototype.contains=function(t){return void 0!==this.Qe.find((function(e){return t.T(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.T(e.field)}))},t.prototype.R_=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.y_(this.path.get(t))},t.prototype.y_=function(t){if(0===t.length)throw this.h_(\"Document fields must not be empty\");if(Nu(this.u_)&&Iu.test(t))throw this.h_('Document fields cannot begin and end with \"__\"')},t}(),Su=function(){function t(t,e,n){this.U=t,this.ignoreUndefinedProperties=e,this.serializer=n||nu(t)}return t.prototype.v_=function(t,e,n,r){return void 0===r&&(r=!1),new Du({u_:t,methodName:e,l_:n,path:D.g(),__:!1,b_:r},this.U,this.serializer,this.ignoreUndefinedProperties)},t}();function xu(t,e,n,r,i,o){void 0===o&&(o={});var s=t.v_(o.merge||o.mergeFields?2:0,e,n,i);Vu(\"Data must be an object, but it was:\",s,r);var u,a,c=Uu(r,s);if(o.merge)u=new sn(s.Qe),a=s.fieldTransforms;else if(o.mergeFields){for(var l=[],p=0,d=o.mergeFields;p<d.length;p++){var v=d[p],y=void 0;if(v instanceof cu)y=v.r_;else{if(\"string\"!=typeof v)throw m();y=Mu(e,v,n)}if(!s.contains(y))throw new f(h.INVALID_ARGUMENT,\"Field '\"+y+\"' is specified in your field mask but missing from your input data.\");qu(l,y)||l.push(y)}u=new sn(l),a=s.fieldTransforms.filter((function(t){return u.He(t.field)}))}else u=null,a=s.fieldTransforms;return new Tu(new An(c),u,a)}function ku(t,e,n,r){var i=t.v_(1,e,n);Vu(\"Data must be an object, but it was:\",i,r);var o=[],s=new Nn;I(r,(function(t,r){var u=Mu(e,t,n),a=i.V_(u);if(r instanceof lu&&r.o_ instanceof pu)o.push(u);else{var c=Ou(r,a);null!=c&&(o.push(u),s.set(u,c))}}));var u=new sn(o);return new Au(s.Je(),u,i.fieldTransforms)}function Lu(t,e,n,r,i,o){var s=t.v_(1,e,n),u=[Cu(e,r,n)],a=[i];if(o.length%2!=0)throw new f(h.INVALID_ARGUMENT,\"Function \"+e+\"() needs to be called with an even number of arguments that alternate between field names and values.\");for(var c=0;c<o.length;c+=2)u.push(Cu(e,o[c])),a.push(o[c+1]);for(var l=[],p=new Nn,d=u.length-1;d>=0;--d)if(!qu(l,u[d])){var v=u[d],y=a[d],g=s.V_(v);if(y instanceof lu&&y.o_ instanceof pu)l.push(v);else{var m=Ou(y,g);null!=m&&(l.push(v),p.set(v,m))}}var w=new sn(l);return new Au(p.Je(),w,s.fieldTransforms)}function Ru(t,e,n,r){return void 0===r&&(r=!1),Ou(n,t.v_(r?4:3,e))}function Ou(t,e){if(Pu(t))return Vu(\"Unsupported field value:\",e,t),Uu(t,e);if(t instanceof lu)return function(t,e){if(!Nu(e.u_))throw e.h_(t.a_+\"() can only be used with update() and set()\");if(!e.path)throw e.h_(t.a_+\"() is not currently supported inside arrays\");var n=t.c_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Qe.push(e.path),t instanceof Array){if(e.settings.__&&4!==e.u_)throw e.h_(\"Nested arrays are not supported\");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Ou(o[i],e.p_(r));null==s&&(s={nullValue:\"NULL_VALUE\"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:\"NULL_VALUE\"};if(\"number\"==typeof t)return we(e.serializer,t);if(\"boolean\"==typeof t)return{booleanValue:t};if(\"string\"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ut.fromDate(t);return{timestampValue:_e(e.serializer,n)}}if(t instanceof ut){var r=new ut(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:_e(e.serializer,r)}}if(t instanceof bu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof tt)return{bytesValue:be(e.serializer,t.q)};if(t instanceof Eu){var i=e.U,o=t.T_;if(!o.isEqual(i))throw e.h_(\"Document reference is for database \"+o.projectId+\"/\"+o.database+\" but should be for database \"+i.projectId+\"/\"+i.database);return{referenceValue:Te(t.T_||e.U,t.E_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.h_(\"Unsupported field value: \"+j(t))}(t,e)}function Uu(t,e){var n={};return E(t)?e.path&&e.path.length>0&&e.Qe.push(e.path):I(t,(function(t,r){var i=Ou(r,e.g_(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function Pu(t){return!(\"object\"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ut||t instanceof bu||t instanceof tt||t instanceof Eu||t instanceof lu)}function Vu(t,e,n){if(!Pu(n)||!q(n)){var r=j(n);throw\"an object\"===r?e.h_(t+\" a custom object\"):e.h_(t+\" \"+r)}}function Cu(t,e,n){if(e instanceof cu)return e.r_;if(\"string\"==typeof e)return Mu(t,e);throw Fu(\"Field path arguments must be of type string or FieldPath.\",t,!1,void 0,n)}function Mu(t,e,n){try{return function(t){if(t.search(fu)>=0)throw new f(h.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not contain '~', '*', '/', '[', or ']'\");try{return new(hu.bind.apply(hu,r.__spreadArrays([void 0],t.split(\".\"))))}catch(r){throw new f(h.INVALID_ARGUMENT,\"Invalid field path (\"+t+\"). Paths must not be empty, begin with '.', end with '.', or contain '..'\")}}(e).r_}catch(e){throw Fu((i=e)instanceof Error?i.message:i.toString(),t,!1,void 0,n)}var i}function Fu(t,e,n,r,i){var o=r&&!r.m(),s=void 0!==i,u=\"Function \"+e+\"() called with invalid data\";n&&(u+=\" (via `toFirestore()`)\");var a=\"\";return(o||s)&&(a+=\" (found\",o&&(a+=\" in field \"+r),s&&(a+=\" in document \"+i),a+=\")\"),new f(h.INVALID_ARGUMENT,(u+=\". \")+t+a)}function qu(t,e){return t.some((function(t){return t.isEqual(e)}))}var ju=function(){function t(t){this.Hu=t,this.S_=new Map,this.mutations=[],this.D_=!1,this.C_=null,this.N_=new Set}return t.prototype.F_=function(t){return r.__awaiter(this,void 0,void 0,(function(){var e,n=this;return r.__generator(this,(function(i){switch(i.label){case 0:if(this.x_(),this.mutations.length>0)throw new f(h.INVALID_ARGUMENT,\"Firestore transactions require all reads to be executed before all writes.\");return[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u,a;return r.__generator(this,(function(r){switch(r.label){case 0:return n=_(t),i=ke(n.serializer)+\"/documents\",o={documents:e.map((function(t){return Ne(n.serializer,t)}))},[4,n.Lu(\"BatchGetDocuments\",i,o)];case 1:return s=r.sent(),u=new Map,s.forEach((function(t){var e=function(t,e){return\"found\"in e?function(t,e){w(!!e.found),e.found.name,e.found.updateTime;var n=De(t,e.found.name),r=Ee(e.found.updateTime),i=new An({mapValue:{fields:e.found.fields}});return new xn(n,r,i,{})}(t,e):\"missing\"in e?function(t,e){w(!!e.missing),w(!!e.readTime);var n=De(t,e.missing),r=Ee(e.readTime);return new kn(n,r)}(t,e):m()}(n.serializer,t);u.set(e.key.toString(),e)})),a=[],[2,(e.forEach((function(t){var e=u.get(t.toString());w(!!e),a.push(e)})),a)]}}))}))}(this.Hu,t)];case 1:return[2,((e=i.sent()).forEach((function(t){t instanceof kn||t instanceof xn?n.k_(t):m()})),e)]}}))}))},t.prototype.set=function(t,e){this.write(e.A_(t,this.Ke(t))),this.N_.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.A_(t,this.M_(t)))}catch(t){this.C_=t}this.N_.add(t.toString())},t.prototype.delete=function(t){this.write([new En(t,this.Ke(t))]),this.N_.add(t.toString())},t.prototype.commit=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){switch(n.label){case 0:if(this.x_(),this.C_)throw this.C_;return t=this.S_,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(t,n){var r=S.D(n);e.mutations.push(new Tn(r,e.Ke(r)))})),[4,function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o;return r.__generator(this,(function(r){switch(r.label){case 0:return n=_(t),i=ke(n.serializer)+\"/documents\",o={writes:e.map((function(t){return Oe(n.serializer,t)}))},[4,n.Ou(\"Commit\",i,o)];case 1:return r.sent(),[2]}}))}))}(this.Hu,this.mutations)];case 1:return n.sent(),this.D_=!0,[2]}}))}))},t.prototype.k_=function(t){var e;if(t instanceof xn)e=t.version;else{if(!(t instanceof kn))throw m();e=at.min()}var n=this.S_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new f(h.ABORTED,\"Document version changed between two reads.\")}else this.S_.set(t.key.toString(),e)},t.prototype.Ke=function(t){var e=this.S_.get(t.toString());return!this.N_.has(t.toString())&&e?cn.updateTime(e):cn.Ge()},t.prototype.M_=function(t){var e=this.S_.get(t.toString());if(!this.N_.has(t.toString())&&e){if(e.isEqual(at.min()))throw new f(h.INVALID_ARGUMENT,\"Can't update a document that doesn't exist.\");return cn.updateTime(e)}return cn.exists(!0)},t.prototype.write=function(t){this.x_(),this.mutations=this.mutations.concat(t)},t.prototype.x_=function(){},t}(),zu=function(){function t(t,e,n,r){this.os=t,this.Hu=e,this.updateFunction=n,this.hs=r,this.O_=5,this.gs=new dr(this.os,\"transaction_retry\")}return t.prototype.run=function(){this.L_()},t.prototype.L_=function(){var t=this;this.gs.Rn((function(){return r.__awaiter(t,void 0,void 0,(function(){var t,e,n=this;return r.__generator(this,(function(r){return t=new ju(this.Hu),(e=this.B_(t))&&e.then((function(e){n.os.ds((function(){return t.commit().then((function(){n.hs.resolve(e)})).catch((function(t){n.q_(t)}))}))})).catch((function(t){n.q_(t)})),[2]}))}))}))},t.prototype.B_=function(t){try{var e=this.updateFunction(t);return!ct(e)&&e.catch&&e.then?e:(this.hs.reject(Error(\"Transaction callback must return a Promise\")),null)}catch(t){return this.hs.reject(t),null}},t.prototype.q_=function(t){var e=this;this.O_>0&&this.U_(t)?(this.O_-=1,this.os.ds((function(){return e.L_(),Promise.resolve()}))):this.hs.reject(t)},t.prototype.U_=function(t){if(\"FirebaseError\"===t.name){var e=t.code;return\"aborted\"===e||\"failed-precondition\"===e||!bt(e)}return!1},t}(),Bu=function(){function t(t,e){this.credentials=t,this.os=e,this.clientId=Y.k(),this.Q_=new pr}return t.prototype.start=function(t,e,n,i){var o=this;this.W_(),this.Dl=t;var s=new pr,u=!1;return this.credentials.Jc((function(t){if(!u)return u=!0,d(\"FirestoreClient\",\"Initializing. user=\",t.uid),o.j_(e,n,i,t,s).then(o.Q_.resolve,o.Q_.reject);o.os.Ds((function(){return function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i;return r.__generator(this,(function(r){switch(r.label){case 0:return(n=_(t)).os.Fs(),d(\"RemoteStore\",\"RemoteStore received new credentials\"),i=Yo(n),n.Zu.add(3),[4,jo(n)];case 1:return r.sent(),i&&n.rh.set(\"Unknown\"),[4,n.th.n_(e)];case 2:return r.sent(),n.Zu.delete(3),[4,qo(n)];case 3:return r.sent(),[2]}}))}))}(o.Sh,t)}))})),this.os.ds((function(){return o.Q_.promise})),s.promise},t.prototype.enableNetwork=function(){var t=this;return this.W_(),this.os.enqueue((function(){return t.persistence.sc(!0),Fo(t.Sh)}))},t.prototype.j_=function(t,e,n,i,o){return r.__awaiter(this,void 0,void 0,(function(){var s,u,a=this;return r.__generator(this,(function(c){switch(c.label){case 0:return c.trys.push([0,3,,4]),s={os:this.os,Dl:this.Dl,clientId:this.clientId,credentials:this.credentials,Gl:i,Ch:100,Hl:n},[4,t.initialize(s)];case 1:return c.sent(),[4,e.initialize(t,s)];case 2:return c.sent(),this.persistence=t.persistence,this.Dh=t.Dh,this.zu=t.zu,this.Wl=t.Wl,this.Hu=e.Hu,this.Sh=e.Sh,this._i=e._i,this.K_=e.t_,this.K_.qs=ys.bind(null,this._i),this.K_.Ws=ms.bind(null,this._i),this.persistence.nc((function(){return r.__awaiter(a,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),o.resolve(),[3,4];case 3:if(u=c.sent(),o.reject(u),!this.G_(u))throw u;return[2,(console.warn(\"Error enabling offline persistence. Falling back to persistence disabled: \"+u),this.j_(new iu,new su,{zl:!1},i,o))];case 4:return[2]}}))}))},t.prototype.G_=function(t){return\"FirebaseError\"===t.name?t.code===h.FAILED_PRECONDITION||t.code===h.UNIMPLEMENTED:!(\"undefined\"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},t.prototype.W_=function(){if(this.os.Vs)throw new f(h.FAILED_PRECONDITION,\"The client has already been terminated.\")},t.prototype.disableNetwork=function(){var t=this;return this.W_(),this.os.enqueue((function(){return t.persistence.sc(!1),function(t){return r.__awaiter(this,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return(e=_(t)).Zu.add(0),[4,jo(e)];case 1:return n.sent(),e.rh.set(\"Offline\"),[2]}}))}))}(t.Sh)}))},t.prototype.terminate=function(){var t=this;this.os.Ss();var e=new pr;return this.os.ps((function(){return r.__awaiter(t,void 0,void 0,(function(){var t,n;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),this.Wl&&this.Wl.stop(),[4,zo(this.Sh)];case 1:return r.sent(),[4,this.Dh.Si()];case 2:return r.sent(),[4,this.persistence.Si()];case 3:return r.sent(),this.credentials.Xc(),e.resolve(),[3,5];case 4:return t=r.sent(),n=xr(t,\"Failed to shutdown persistence\"),e.reject(n),[3,5];case 5:return[2]}}))}))})),e.promise},t.prototype.waitForPendingWrites=function(){var t=this;this.W_();var e=new pr;return this.os.ds((function(){return function(t,e){return r.__awaiter(this,void 0,void 0,(function(){var n,i,o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:Yo((n=_(t)).Sh)||d(\"SyncEngine\",\"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.\"),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,function(t){var e=_(t);return e.persistence.runTransaction(\"Get highest unacknowledged batch id\",\"readonly\",(function(t){return e.vr.Bo(t)}))}(n.zu)];case 2:return-1===(i=r.sent())?[2,void e.resolve()]:((o=n.Bh.get(i)||[]).push(e),n.Bh.set(i,o),[3,4]);case 3:return s=r.sent(),u=xr(s,\"Initialization of waitForPendingWrites() operation failed\"),e.reject(u),[3,4];case 4:return[2]}}))}))}(t._i,e)})),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.W_();var i=new au(n),o=new Mr(t,i,e);return this.os.ds((function(){return Rr(r.K_,o)})),function(){i.i_(),r.os.ds((function(){return Or(r.K_,o)}))}},t.prototype.z_=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.W_(),[4,this.Q_.promise];case 1:return[2,(e.sent(),function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o=this;return r.__generator(this,(function(s){switch(s.label){case 0:return i=new pr,[4,t.enqueue((function(){return r.__awaiter(o,void 0,void 0,(function(){var t,o,s;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t,e){var n=_(t);return n.persistence.runTransaction(\"read document\",\"readonly\",(function(t){return n.$c.Dr(t,e)}))}(e,n)];case 1:return(t=r.sent())instanceof xn?i.resolve(t):t instanceof kn?i.resolve(null):i.reject(new f(h.UNAVAILABLE,\"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)\")),[3,3];case 2:return o=r.sent(),s=xr(o,\"Failed to get document '\"+n+\" from cache\"),i.reject(s),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(s.sent(),i.promise)]}}))}))}(this.os,this.zu,t))]}}))}))},t.prototype.H_=function(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return this.W_(),[4,this.Q_.promise];case 1:return[2,(n.sent(),function(t,e,n,r){var i=new pr,o=Gu(t,e,Pn(n.path),{includeMetadataChanges:!0,Js:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new f(h.UNAVAILABLE,\"Failed to get document because the client is offline.\")):e&&t.fromCache&&r&&\"server\"===r.source?i.reject(new f(h.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to \"server\" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.os,this.K_,t,e))]}}))}))},t.prototype.Y_=function(t){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(e){switch(e.label){case 0:return this.W_(),[4,this.Q_.promise];case 1:return[2,(e.sent(),function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o=this;return r.__generator(this,(function(s){switch(s.label){case 0:return i=new pr,[4,t.enqueue((function(){return r.__awaiter(o,void 0,void 0,(function(){var t,o,s,u,a,c;return r.__generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,Eo(e,n,!0)];case 1:return t=r.sent(),o=new ls(n,t.kc),s=o.Th(t.documents),u=o.gr(s,!1),i.resolve(u.snapshot),[3,3];case 2:return a=r.sent(),c=xr(a,\"Failed to execute query '\"+n+\" against cache\"),i.reject(c),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(s.sent(),i.promise)]}}))}))}(this.os,this.zu,t))]}}))}))},t.prototype.J_=function(t,e){return r.__awaiter(this,void 0,void 0,(function(){return r.__generator(this,(function(n){switch(n.label){case 0:return this.W_(),[4,this.Q_.promise];case 1:return[2,(n.sent(),function(t,e,n,r){var i=new pr,o=Gu(t,e,n,{includeMetadataChanges:!0,Js:!0},{next:function(t){o(),t.fromCache&&r&&\"server\"===r.source?i.reject(new f(h.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to \"server\" to retrieve the cached documents.)')):i.resolve(t)},error:function(t){return i.reject(t)}});return i.promise}(this.os,this.K_,t,e))]}}))}))},t.prototype.write=function(t){var e=this;this.W_();var n=new pr;return this.os.ds((function(){return function(t,e,n){return r.__awaiter(this,void 0,void 0,(function(){var i,o,s,u;return r.__generator(this,(function(r){switch(r.label){case 0:(i=Bs(t)).Wh(\"write()\"),r.label=1;case 1:return r.trys.push([1,5,,6]),[4,function(t,e){var n,r=_(t),i=ut.now(),o=e.reduce((function(t,e){return t.add(e.key)}),Pt());return r.persistence.runTransaction(\"Locally write mutations\",\"readwrite\",(function(t){return r.$c.$r(t,o).next((function(o){n=o;for(var s=[],u=0,a=e;u<a.length;u++){var c=a[u],h=dn(c,n.get(c.key));null!=h&&s.push(new mn(c.key,h,Dn(h.proto.mapValue),cn.exists(!0)))}return r.vr.xo(t,i,s,e)}))})).then((function(t){var e=t.hr(n);return{batchId:t.batchId,dr:e}}))}(i.zu,e)];case 2:return o=r.sent(),i.Dh.Fi(o.batchId),function(t,e,n){var r=t.Lh[t.currentUser.Zs()];r||(r=new Et($)),r=r.rt(e,n),t.Lh[t.currentUser.Zs()]=r}(i,o.batchId,n),[4,Ls(i,o.dr)];case 3:return r.sent(),[4,ns(i.Sh)];case 4:return r.sent(),[3,6];case 5:return s=r.sent(),u=xr(s,\"Failed to persist write\"),n.reject(u),[3,6];case 6:return[2]}}))}))}(e._i,t,n)})),n.promise},t.prototype.U=function(){return this.Dl.U},t.prototype.X_=function(t){var e=this;this.W_();var n=new au(t);return this.os.ds((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,function(t,e){_(t).Bs.add(e),e.next()}(this.K_,n)]}))}))})),function(){n.i_(),e.os.ds((function(){return r.__awaiter(e,void 0,void 0,(function(){return r.__generator(this,(function(t){return[2,function(t,e){_(t).Bs.delete(e)}(this.K_,n)]}))}))}))}},Object.defineProperty(t.prototype,\"Z_\",{get:function(){return this.os.Vs},enumerable:!1,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.W_();var n=new pr;return this.os.ds((function(){return new zu(e.os,e.Hu,t,n).run(),Promise.resolve()})),n.promise},t}();function Gu(t,e,n,r,i){var o=new au(i),s=new Mr(n,o,r);return t.ds((function(){return Rr(e,s)})),function(){o.i_(),t.ds((function(){return Or(e,s)}))}}var Qu=function(){function t(t,e,n,r,i){this.U=t,this.timestampsInSnapshots=e,this.tf=n,this.ef=r,this.nf=i}return t.prototype.sf=function(t){switch(Zt(t)){case 0:return null;case 1:return t.booleanValue;case 2:return se(t.integerValue||t.doubleValue);case 3:return this.if(t.timestampValue);case 4:return this.rf(t);case 5:return t.stringValue;case 6:return this.nf(ue(t.bytesValue));case 7:return this.af(t.referenceValue);case 8:return this.cf(t.geoPointValue);case 9:return this.uf(t.arrayValue);case 10:return this.hf(t.mapValue);default:throw m()}},t.prototype.hf=function(t){var e=this,n={};return I(t.fields||{},(function(t,r){n[t]=e.sf(r)})),n},t.prototype.cf=function(t){return new bu(se(t.latitude),se(t.longitude))},t.prototype.uf=function(t){var e=this;return(t.values||[]).map((function(t){return e.sf(t)}))},t.prototype.rf=function(t){switch(this.tf){case\"previous\":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return $t(n)?t(n):n}(t);return null==e?null:this.sf(e);case\"estimate\":return this.if(Xt(t));default:return null}},t.prototype.if=function(t){var e=oe(t),n=new ut(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},t.prototype.af=function(t){var e=A.P(t);w(We(e));var n=new ot(e.get(1),e.get(3)),r=new S(e.u(5));return n.isEqual(this.U)||v(\"Document \"+r+\" contains a document reference within a different database (\"+n.projectId+\"/\"+n.database+\") which is not supported. It will be treated as a reference in the current database (\"+this.U.projectId+\"/\"+this.U.database+\") instead.\"),this.ef(r)},t}(),Wu=ui.uo,Ku=function(){function t(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new f(h.INVALID_ARGUMENT,\"Can't provide ssl option if host option is not set\");this.host=\"firestore.googleapis.com\",this.ssl=!0}else P(\"settings\",\"non-empty string\",\"host\",t.host),this.host=t.host,V(\"settings\",\"boolean\",\"ssl\",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(B(\"settings\",t,[\"host\",\"ssl\",\"credentials\",\"timestampsInSnapshots\",\"cacheSizeBytes\",\"experimentalForceLongPolling\",\"ignoreUndefinedProperties\"]),V(\"settings\",\"object\",\"credentials\",t.credentials),this.credentials=t.credentials,V(\"settings\",\"boolean\",\"timestampsInSnapshots\",t.timestampsInSnapshots),V(\"settings\",\"boolean\",\"ignoreUndefinedProperties\",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?v(\"The setting 'timestampsInSnapshots: true' is no longer required and should be removed.\"):!1===t.timestampsInSnapshots&&v(\"Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects.\"),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,V(\"settings\",\"number\",\"cacheSizeBytes\",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ui.lo;else{if(t.cacheSizeBytes!==Wu&&t.cacheSizeBytes<ui.ho)throw new f(h.INVALID_ARGUMENT,\"cacheSizeBytes must be at least \"+ui.ho);this.cacheSizeBytes=t.cacheSizeBytes}V(\"settings\",\"boolean\",\"experimentalForceLongPolling\",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},t}(),Hu=function(){function t(e,n,i,o){var s=this;if(void 0===i&&(i=new iu),void 0===o&&(o=new su),this.lf=i,this._f=o,this.ff=null,this.df=new Sr,this.INTERNAL={delete:function(){return r.__awaiter(s,void 0,void 0,(function(){return r.__generator(this,(function(t){switch(t.label){case 0:return this.wf(),[4,this.mf.terminate()];case 1:return t.sent(),[2]}}))}))}},\"object\"==typeof e.options){var u=e;this.ff=u,this.T_=t.Tf(u),this.Ef=u.name,this.If=new ko(n)}else{var a=e;if(!a.projectId)throw new f(h.INVALID_ARGUMENT,\"Must provide projectId\");this.T_=new ot(a.projectId,a.database),this.Ef=\"[DEFAULT]\",this.If=new xo}this.Af=new Ku({})}return Object.defineProperty(t.prototype,\"Rf\",{get:function(){return this.Pf||(this.Pf=new Su(this.T_,this.Af.ignoreUndefinedProperties)),this.Pf},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){k(\"Firestore.settings\",arguments,1),O(\"Firestore.settings\",\"object\",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.Af),t)).merge;var e=new Ku(t);if(this.mf&&!this.Af.isEqual(e))throw new f(h.FAILED_PRECONDITION,\"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.\");this.Af=e,void 0!==e.credentials&&(this.If=function(t){if(!t)return new xo;switch(t.type){case\"gapi\":var e=t.gf;return w(!(\"object\"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Ro(e,t.iu||\"0\");case\"provider\":return t.gf;default:throw new f(h.INVALID_ARGUMENT,\"makeCredentialsProvider failed due to invalid credential type\")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.wf(),this.mf.enableNetwork()},t.prototype.disableNetwork=function(){return this.wf(),this.mf.disableNetwork()},t.prototype.enablePersistence=function(t){var e,n;if(this.mf)throw new f(h.FAILED_PRECONDITION,\"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.\");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&v(\"The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead.\"),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new f(h.INVALID_ARGUMENT,\"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.\");return this.yf(this.lf,this._f,{zl:!0,cacheSizeBytes:this.Af.cacheSizeBytes,synchronizeTabs:r,La:i})},t.prototype.clearPersistence=function(){return r.__awaiter(this,void 0,void 0,(function(){var t,e=this;return r.__generator(this,(function(n){if(void 0!==this.mf&&!this.mf.Z_)throw new f(h.FAILED_PRECONDITION,\"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.\");return t=new pr,[2,(this.df.ps((function(){return r.__awaiter(e,void 0,void 0,(function(){var e;return r.__generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.lf.clearPersistence(this.T_,this.Ef)];case 1:return n.sent(),t.resolve(),[3,3];case 2:return e=n.sent(),t.reject(e),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},t.prototype.terminate=function(){return this.app._removeServiceInstance(\"firestore\"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,\"Vf\",{get:function(){return this.wf(),this.mf.Z_},enumerable:!1,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.wf(),this.mf.waitForPendingWrites()},t.prototype.onSnapshotsInSync=function(t){if(this.wf(),uu(t))return this.mf.X_(t);O(\"Firestore.onSnapshotsInSync\",\"function\",1,t);var e={next:t};return this.mf.X_(e)},t.prototype.wf=function(){return this.mf||this.yf(new iu,new su,{zl:!1}),this.mf},t.prototype.pf=function(){return new it(this.T_,this.Ef,this.Af.host,this.Af.ssl,this.Af.experimentalForceLongPolling)},t.prototype.yf=function(t,e,n){var r=this.pf();return this.mf=new Bu(this.If,this.df),this.mf.start(r,t,e,n)},t.Tf=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,\"projectId\"))throw new f(h.INVALID_ARGUMENT,'\"projectId\" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||\"string\"!=typeof n)throw new f(h.INVALID_ARGUMENT,\"projectId must be a string in FirebaseApp.options\");return new ot(n)},Object.defineProperty(t.prototype,\"app\",{get:function(){if(!this.ff)throw new f(h.FAILED_PRECONDITION,\"Firestore was not initialized using the Firebase SDK. 'app' is not available\");return this.ff},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){return k(\"Firestore.collection\",arguments,1),O(\"Firestore.collection\",\"non-empty string\",1,t),this.wf(),new ca(A.P(t),this,null)},t.prototype.doc=function(t){return k(\"Firestore.doc\",arguments,1),O(\"Firestore.doc\",\"non-empty string\",1,t),this.wf(),Xu.bf(A.P(t),this,null)},t.prototype.collectionGroup=function(t){if(k(\"Firestore.collectionGroup\",arguments,1),O(\"Firestore.collectionGroup\",\"non-empty string\",1,t),t.indexOf(\"/\")>=0)throw new f(h.INVALID_ARGUMENT,\"Invalid collection ID '\"+t+\"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.\");return this.wf(),new ua(function(t){return new On(A.g(),t)}(t),this,null)},t.prototype.runTransaction=function(t){var e=this;return k(\"Firestore.runTransaction\",arguments,1),O(\"Firestore.runTransaction\",\"function\",1,t),this.wf().transaction((function(n){return t(new Yu(e,n))}))},t.prototype.batch=function(){return this.wf(),new $u(this)},Object.defineProperty(t,\"logLevel\",{get:function(){switch(p()){case o.LogLevel.DEBUG:return\"debug\";case o.LogLevel.ERROR:return\"error\";case o.LogLevel.SILENT:return\"silent\";case o.LogLevel.WARN:return\"warn\";case o.LogLevel.INFO:return\"info\";case o.LogLevel.VERBOSE:return\"verbose\";default:return\"error\"}},enumerable:!1,configurable:!0}),t.setLogLevel=function(t){var e;k(\"Firestore.setLogLevel\",arguments,1),M(\"setLogLevel\",[\"debug\",\"error\",\"silent\",\"warn\",\"info\",\"verbose\"],1,t),e=t,l.setLogLevel(e)},t.prototype.vf=function(){return this.Af.timestampsInSnapshots},t.prototype.Sf=function(){return this.Af},t}(),Yu=function(){function t(t,e){this.Df=t,this.Cf=e}return t.prototype.get=function(t){var e=this;k(\"Transaction.get\",arguments,1);var n=pa(\"Transaction.get\",t,this.Df);return this.Cf.F_([n.E_]).then((function(t){if(!t||1!==t.length)return m();var r=t[0];if(r instanceof kn)return new Zu(e.Df,n.E_,null,!1,!1,n.I_);if(r instanceof xn)return new Zu(e.Df,n.E_,r,!1,!1,n.I_);throw m()}))},t.prototype.set=function(t,e,n){R(\"Transaction.set\",arguments,2,3);var r=pa(\"Transaction.set\",t,this.Df);n=ha(\"Transaction.set\",n);var i=va(r.I_,e,n),o=xu(this.Df.Rf,\"Transaction.set\",r.E_,i,null!==r.I_,n);return this.Cf.set(r.E_,o),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return\"string\"==typeof e||e instanceof hu?(L(\"Transaction.update\",arguments,3),r=pa(\"Transaction.update\",t,this.Df),i=Lu(this.Df.Rf,\"Transaction.update\",r.E_,e,n,o)):(k(\"Transaction.update\",arguments,2),r=pa(\"Transaction.update\",t,this.Df),i=ku(this.Df.Rf,\"Transaction.update\",r.E_,e)),this.Cf.update(r.E_,i),this},t.prototype.delete=function(t){k(\"Transaction.delete\",arguments,1);var e=pa(\"Transaction.delete\",t,this.Df);return this.Cf.delete(e.E_),this},t}(),$u=function(){function t(t){this.Df=t,this.Nf=[],this.Ff=!1}return t.prototype.set=function(t,e,n){R(\"WriteBatch.set\",arguments,2,3),this.$f();var r=pa(\"WriteBatch.set\",t,this.Df);n=ha(\"WriteBatch.set\",n);var i=va(r.I_,e,n),o=xu(this.Df.Rf,\"WriteBatch.set\",r.E_,i,null!==r.I_,n);return this.Nf=this.Nf.concat(o.A_(r.E_,cn.Ge())),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.$f(),\"string\"==typeof e||e instanceof hu?(L(\"WriteBatch.update\",arguments,3),r=pa(\"WriteBatch.update\",t,this.Df),i=Lu(this.Df.Rf,\"WriteBatch.update\",r.E_,e,n,o)):(k(\"WriteBatch.update\",arguments,2),r=pa(\"WriteBatch.update\",t,this.Df),i=ku(this.Df.Rf,\"WriteBatch.update\",r.E_,e)),this.Nf=this.Nf.concat(i.A_(r.E_,cn.exists(!0))),this},t.prototype.delete=function(t){k(\"WriteBatch.delete\",arguments,1),this.$f();var e=pa(\"WriteBatch.delete\",t,this.Df);return this.Nf=this.Nf.concat(new En(e.E_,cn.Ge())),this},t.prototype.commit=function(){return this.$f(),this.Ff=!0,this.Nf.length>0?this.Df.wf().write(this.Nf):Promise.resolve()},t.prototype.$f=function(){if(this.Ff)throw new f(h.FAILED_PRECONDITION,\"A write batch can no longer be used after commit() has been called.\")},t}(),Xu=function(t){function e(e,n,r){var i=this;return(i=t.call(this,n.T_,e,r)||this).E_=e,i.firestore=n,i.I_=r,i.mf=i.firestore.wf(),i}return r.__extends(e,t),e.bf=function(t,n,r){if(t.length%2!=0)throw new f(h.INVALID_ARGUMENT,\"Invalid document reference. Document references must have an even number of segments, but \"+t.R()+\" has \"+t.length);return new e(new S(t),n,r)},Object.defineProperty(e.prototype,\"id\",{get:function(){return this.E_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){return new ca(this.E_.path.h(),this.firestore,this.I_)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"path\",{get:function(){return this.E_.path.R()},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){if(k(\"DocumentReference.collection\",arguments,1),O(\"DocumentReference.collection\",\"non-empty string\",1,t),!t)throw new f(h.INVALID_ARGUMENT,\"Must provide a non-empty collection name to collection()\");var e=A.P(t);return new ca(this.E_.path.child(e),this.firestore,null)},e.prototype.isEqual=function(t){if(!(t instanceof e))throw G(\"isEqual\",\"DocumentReference\",1,t);return this.firestore===t.firestore&&this.E_.isEqual(t.E_)&&this.I_===t.I_},e.prototype.set=function(t,e){R(\"DocumentReference.set\",arguments,1,2),e=ha(\"DocumentReference.set\",e);var n=va(this.I_,t,e),r=xu(this.firestore.Rf,\"DocumentReference.set\",this.E_,n,null!==this.I_,e);return this.mf.write(r.A_(this.E_,cn.Ge()))},e.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return\"string\"==typeof t||t instanceof hu?(L(\"DocumentReference.update\",arguments,2),n=Lu(this.firestore.Rf,\"DocumentReference.update\",this.E_,t,e,r)):(k(\"DocumentReference.update\",arguments,1),n=ku(this.firestore.Rf,\"DocumentReference.update\",this.E_,t)),this.mf.write(n.A_(this.E_,cn.exists(!0)))},e.prototype.delete=function(){return k(\"DocumentReference.delete\",arguments,0),this.mf.write([new En(this.E_,cn.Ge())])},e.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];R(\"DocumentReference.onSnapshot\",arguments,1,4);var s={includeMetadataChanges:!1},u=0;\"object\"!=typeof i[u]||uu(i[u])||(B(\"DocumentReference.onSnapshot\",s=i[u],[\"includeMetadataChanges\"]),V(\"DocumentReference.onSnapshot\",\"boolean\",\"includeMetadataChanges\",s.includeMetadataChanges),u++);var a={includeMetadataChanges:s.includeMetadataChanges};if(uu(i[u])){var c=i[u];i[u]=null===(t=c.next)||void 0===t?void 0:t.bind(c),i[u+1]=null===(e=c.error)||void 0===e?void 0:e.bind(c),i[u+2]=null===(n=c.complete)||void 0===n?void 0:n.bind(c)}else O(\"DocumentReference.onSnapshot\",\"function\",u,i[u]),U(\"DocumentReference.onSnapshot\",\"function\",u+1,i[u+1]),U(\"DocumentReference.onSnapshot\",\"function\",u+2,i[u+2]);var h={next:function(t){i[u]&&i[u](r.xf(t))},error:i[u+1],complete:i[u+2]};return this.mf.listen(Pn(this.E_.path),a,h)},e.prototype.get=function(t){var e=this;R(\"DocumentReference.get\",arguments,0,1),la(\"DocumentReference.get\",t);var n=this.firestore.wf();return t&&\"cache\"===t.source?n.z_(this.E_).then((function(t){return new Zu(e.firestore,e.E_,t,!0,t instanceof xn&&t.Ye,e.I_)})):n.H_(this.E_,t).then((function(t){return e.xf(t)}))},e.prototype.withConverter=function(t){return new e(this.E_,this.firestore,t)},e.prototype.xf=function(t){var e=t.docs.get(this.E_);return new Zu(this.firestore,this.E_,e,t.fromCache,t.hasPendingWrites,this.I_)},e}(Eu),Ju=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Zu=function(){function t(t,e,n,r,i,o){this.Df=t,this.E_=e,this.kf=n,this.Mf=r,this.Of=i,this.I_=o}return t.prototype.data=function(t){var e=this;if(R(\"DocumentSnapshot.data\",arguments,0,1),t=fa(\"DocumentSnapshot.data\",t),this.kf){if(this.I_){var n=new ta(this.Df,this.E_,this.kf,this.Mf,this.Of,null);return this.I_.fromFirestore(n,t)}return new Qu(this.Df.T_,this.Df.vf(),t.serverTimestamps||\"none\",(function(t){return new Xu(t,e.Df,null)}),(function(t){return new rt(t)})).sf(this.kf.sn())}},t.prototype.get=function(t,e){var n=this;if(R(\"DocumentSnapshot.get\",arguments,1,2),e=fa(\"DocumentSnapshot.get\",e),this.kf){var r=this.kf.data().field(Cu(\"DocumentSnapshot.get\",t,this.E_));if(null!==r)return new Qu(this.Df.T_,this.Df.vf(),e.serverTimestamps||\"none\",(function(t){return new Xu(t,n.Df,n.I_)}),(function(t){return new rt(t)})).sf(r)}},Object.defineProperty(t.prototype,\"id\",{get:function(){return this.E_.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"ref\",{get:function(){return new Xu(this.E_,this.Df,this.I_)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"exists\",{get:function(){return null!==this.kf},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"metadata\",{get:function(){return new Ju(this.Of,this.Mf)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw G(\"isEqual\",\"DocumentSnapshot\",1,e);return this.Df===e.Df&&this.Mf===e.Mf&&this.E_.isEqual(e.E_)&&(null===this.kf?null===e.kf:this.kf.isEqual(e.kf))&&this.I_===e.I_},t}(),ta=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r.__extends(e,t),e.prototype.data=function(e){return t.prototype.data.call(this,e)},e}(Zu);function ea(t,e,n,r,i,o,s){var u;if(i.p()){if(\"array-contains\"===o||\"array-contains-any\"===o)throw new f(h.INVALID_ARGUMENT,\"Invalid Query. You can't perform '\"+o+\"' queries on FieldPath.documentId().\");if(\"in\"===o||\"not-in\"===o){ia(s,o);for(var a=[],c=0,l=s;c<l.length;c++){var p=l[c];a.push(ra(r,t,p))}u={arrayValue:{values:a}}}else u=ra(r,t,s)}else\"in\"!==o&&\"not-in\"!==o&&\"array-contains-any\"!==o||ia(s,o),u=Ru(n,e,s,\"in\"===o||\"not-in\"===o);var d=Xn.create(i,o,u);return function(t,e){if(e.un()){var n=Fn(t);if(null!==n&&!n.isEqual(e.field))throw new f(h.INVALID_ARGUMENT,\"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '\"+n.toString()+\"' and '\"+e.field.toString()+\"'\");var r=Mn(t);null!==r&&oa(t,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case\"!=\":return[\"!=\",\"not-in\"];case\"array-contains\":return[\"array-contains\",\"array-contains-any\",\"not-in\"];case\"in\":return[\"array-contains-any\",\"in\",\"not-in\"];case\"array-contains-any\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\"];case\"not-in\":return[\"array-contains\",\"array-contains-any\",\"in\",\"not-in\",\"!=\"];default:return[]}}(e.op));if(null!==i)throw i===e.op?new f(h.INVALID_ARGUMENT,\"Invalid query. You cannot use more than one '\"+e.op.toString()+\"' filter.\"):new f(h.INVALID_ARGUMENT,\"Invalid query. You cannot use '\"+e.op.toString()+\"' filters with '\"+i.toString()+\"' filters.\")}(t,d),d}function na(t,e,n){if(null!==t.startAt)throw new f(h.INVALID_ARGUMENT,\"Invalid query. You must not call startAt() or startAfter() before calling orderBy().\");if(null!==t.endAt)throw new f(h.INVALID_ARGUMENT,\"Invalid query. You must not call endAt() or endBefore() before calling orderBy().\");var r=new hr(e,n);return function(t,e){if(null===Mn(t)){var n=Fn(t);null!==n&&oa(t,n,e.field)}}(t,r),r}function ra(t,e,n){if(\"string\"==typeof n){if(\"\"===n)throw new f(h.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.\");if(!qn(e)&&-1!==n.indexOf(\"/\"))throw new f(h.INVALID_ARGUMENT,\"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '\"+n+\"' contains a '/' character.\");var r=e.path.child(A.P(n));if(!S.F(r))throw new f(h.INVALID_ARGUMENT,\"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '\"+r+\"' is not because it has an odd number of segments (\"+r.length+\").\");return ae(t,new S(r))}if(n instanceof Eu)return ae(t,n.E_);throw new f(h.INVALID_ARGUMENT,\"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: \"+j(n)+\".\")}function ia(t,e){if(!Array.isArray(t)||0===t.length)throw new f(h.INVALID_ARGUMENT,\"Invalid Query. A non-empty array is required for '\"+e.toString()+\"' filters.\");if(t.length>10)throw new f(h.INVALID_ARGUMENT,\"Invalid Query. '\"+e.toString()+\"' filters support a maximum of 10 elements in the value array.\");if(\"in\"===e||\"array-contains-any\"===e){if(t.indexOf(null)>=0)throw new f(h.INVALID_ARGUMENT,\"Invalid Query. '\"+e.toString()+\"' filters cannot contain 'null' in the value array.\");if(t.filter((function(t){return Number.isNaN(t)})).length>0)throw new f(h.INVALID_ARGUMENT,\"Invalid Query. '\"+e.toString()+\"' filters cannot contain 'NaN' in the value array.\")}}function oa(t,e,n){if(!n.isEqual(e))throw new f(h.INVALID_ARGUMENT,\"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '\"+e.toString()+\"' and so you must also use '\"+e.toString()+\"' as your first orderBy(), but your first orderBy() is on field '\"+n.toString()+\"' instead.\")}function sa(t){if(Cn(t)&&0===t.rn.length)throw new f(h.UNIMPLEMENTED,\"limitToLast() queries require specifying at least one orderBy() clause\")}var ua=function(){function t(t,e,n){this.Lf=t,this.firestore=e,this.I_=n}return t.prototype.where=function(e,n,r){var i;k(\"Query.where\",arguments,3),z(\"Query.where\",3,r),i=\"not-in\"===n||\"!=\"===n?n:M(\"Query.where\",[\"<\",\"<=\",\"==\",\">=\",\">\",\"array-contains\",\"in\",\"array-contains-any\"],2,n);var o=Cu(\"Query.where\",e),s=ea(this.Lf,\"Query.where\",this.firestore.Rf,this.firestore.T_,o,i,r);return new t(function(t,e){var n=t.filters.concat([e]);return new On(t.path,t.collectionGroup,t.rn.slice(),n,t.limit,t.on,t.startAt,t.endAt)}(this.Lf,s),this.firestore,this.I_)},t.prototype.orderBy=function(e,n){var r;if(R(\"Query.orderBy\",arguments,1,2),U(\"Query.orderBy\",\"non-empty string\",2,n),void 0===n||\"asc\"===n)r=\"asc\";else{if(\"desc\"!==n)throw new f(h.INVALID_ARGUMENT,\"Function Query.orderBy() has unknown direction '\"+n+\"', expected 'asc' or 'desc'.\");r=\"desc\"}var i=Cu(\"Query.orderBy\",e),o=na(this.Lf,i,r);return new t(function(t,e){var n=t.rn.concat([e]);return new On(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.on,t.startAt,t.endAt)}(this.Lf,o),this.firestore,this.I_)},t.prototype.limit=function(e){return k(\"Query.limit\",arguments,1),O(\"Query.limit\",\"number\",1,e),Q(\"Query.limit\",1,e),new t(Bn(this.Lf,e,\"F\"),this.firestore,this.I_)},t.prototype.limitToLast=function(e){return k(\"Query.limitToLast\",arguments,1),O(\"Query.limitToLast\",\"number\",1,e),Q(\"Query.limitToLast\",1,e),new t(Bn(this.Lf,e,\"L\"),this.firestore,this.I_)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];L(\"Query.startAt\",arguments,1);var i=this.Bf(\"Query.startAt\",e,n,!0);return new t(Gn(this.Lf,i),this.firestore,this.I_)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];L(\"Query.startAfter\",arguments,1);var i=this.Bf(\"Query.startAfter\",e,n,!1);return new t(Gn(this.Lf,i),this.firestore,this.I_)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];L(\"Query.endBefore\",arguments,1);var i=this.Bf(\"Query.endBefore\",e,n,!0);return new t(Qn(this.Lf,i),this.firestore,this.I_)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];L(\"Query.endAt\",arguments,1);var i=this.Bf(\"Query.endAt\",e,n,!1);return new t(Qn(this.Lf,i),this.firestore,this.I_)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw G(\"isEqual\",\"Query\",1,e);return this.firestore===e.firestore&&Wn(this.Lf,e.Lf)&&this.I_===e.I_},t.prototype.withConverter=function(e){return new t(this.Lf,this.firestore,e)},t.prototype.Bf=function(t,e,n,i){if(z(t,1,e),e instanceof Zu)return k(t,r.__spreadArrays([e],n),1),function(t,e,n,r,i){if(!r)throw new f(h.NOT_FOUND,\"Can't use a DocumentSnapshot that doesn't exist for \"+n+\"().\");for(var o=[],s=0,u=jn(t);s<u.length;s++){var a=u[s];if(a.field.p())o.push(ae(e,r.key));else{var c=r.field(a.field);if($t(c))throw new f(h.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field \"'+a.field+'\" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=a.field.R();throw new f(h.INVALID_ARGUMENT,\"Invalid query. You are trying to start or end a query using a document for which the field '\"+l+\"' (used as the orderBy) does not exist.\")}o.push(c)}}return new sr(o,i)}(this.Lf,this.firestore.T_,t,e.kf,i);var o=[e].concat(n);return function(t,e,n,r,i,o){var s=t.rn;if(i.length>s.length)throw new f(h.INVALID_ARGUMENT,\"Too many arguments provided to \"+r+\"(). The number of arguments must be less than or equal to the number of orderBy() clauses\");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.p()){if(\"string\"!=typeof c)throw new f(h.INVALID_ARGUMENT,\"Invalid query. Expected a string for document ID in \"+r+\"(), but got a \"+typeof c);if(!qn(t)&&-1!==c.indexOf(\"/\"))throw new f(h.INVALID_ARGUMENT,\"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must be a plain document ID, but '\"+c+\"' contains a slash.\");var l=t.path.child(A.P(c));if(!S.F(l))throw new f(h.INVALID_ARGUMENT,\"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to \"+r+\"() must result in a valid document path, but '\"+l+\"' is not because it contains an odd number of segments.\");var p=new S(l);u.push(ae(e,p))}else{var d=Ru(n,r,c);u.push(d)}}return new sr(u,o)}(this.Lf,this.firestore.T_,this.firestore.Rf,t,o,i)},t.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];R(\"Query.onSnapshot\",arguments,1,4);var s={},u=0;if(\"object\"!=typeof i[u]||uu(i[u])||(B(\"Query.onSnapshot\",s=i[u],[\"includeMetadataChanges\"]),V(\"Query.onSnapshot\",\"boolean\",\"includeMetadataChanges\",s.includeMetadataChanges),u++),uu(i[u])){var a=i[u];i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)}else O(\"Query.onSnapshot\",\"function\",u,i[u]),U(\"Query.onSnapshot\",\"function\",u+1,i[u+1]),U(\"Query.onSnapshot\",\"function\",u+2,i[u+2]);var c={next:function(t){i[u]&&i[u](new aa(r.firestore,r.Lf,t,r.I_))},error:i[u+1],complete:i[u+2]};return sa(this.Lf),this.firestore.wf().listen(this.Lf,s,c)},t.prototype.get=function(t){var e=this;R(\"Query.get\",arguments,0,1),la(\"Query.get\",t),sa(this.Lf);var n=this.firestore.wf();return(t&&\"cache\"===t.source?n.Y_(this.Lf):n.J_(this.Lf,t)).then((function(t){return new aa(e.firestore,e.Lf,t,e.I_)}))},t}(),aa=function(){function t(t,e,n,r){this.Df=t,this.qf=e,this.Uf=n,this.I_=r,this.Qf=null,this.Wf=null,this.metadata=new Ju(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,\"docs\",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"empty\",{get:function(){return this.Uf.docs.m()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,\"size\",{get:function(){return this.Uf.docs.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;R(\"QuerySnapshot.forEach\",arguments,1,2),O(\"QuerySnapshot.forEach\",\"function\",1,t),this.Uf.docs.forEach((function(r){t.call(e,n.jf(r,n.metadata.fromCache,n.Uf.Qt.has(r.key)))}))},Object.defineProperty(t.prototype,\"query\",{get:function(){return new ua(this.qf,this.Df,this.I_)},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){t&&(B(\"QuerySnapshot.docChanges\",t,[\"includeMetadataChanges\"]),V(\"QuerySnapshot.docChanges\",\"boolean\",\"includeMetadataChanges\",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.Uf.jt)throw new f(h.INVALID_ARGUMENT,\"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().\");return this.Qf&&this.Wf===e||(this.Qf=function(t,e,n){if(t.Ut.m()){var r=0;return t.docChanges.map((function(e){var i=n(e.doc,t.fromCache,t.Qt.has(e.doc.key));return e.doc,{type:\"added\",doc:i,oldIndex:-1,newIndex:r++}}))}var i=t.Ut;return t.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var r=n(e.doc,t.fromCache,t.Qt.has(e.doc.key)),o=-1,s=-1;return 0!==e.type&&(o=i.indexOf(e.doc.key),i=i.delete(e.doc.key)),1!==e.type&&(s=(i=i.add(e.doc)).indexOf(e.doc.key)),{type:da(e.type),doc:r,oldIndex:o,newIndex:s}}))}(this.Uf,e,this.jf.bind(this)),this.Wf=e),this.Qf},t.prototype.isEqual=function(e){if(!(e instanceof t))throw G(\"isEqual\",\"QuerySnapshot\",1,e);return this.Df===e.Df&&Wn(this.qf,e.qf)&&this.Uf.isEqual(e.Uf)&&this.I_===e.I_},t.prototype.jf=function(t,e,n){return new ta(this.Df,t.key,t,e,n,this.I_)},t}(),ca=function(t){function e(e,n,r){var i=this;if((i=t.call(this,Pn(e),n,r)||this).Kf=e,e.length%2!=1)throw new f(h.INVALID_ARGUMENT,\"Invalid collection reference. Collection references must have an odd number of segments, but \"+e.R()+\" has \"+e.length);return i}return r.__extends(e,t),Object.defineProperty(e.prototype,\"id\",{get:function(){return this.Lf.path._()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"parent\",{get:function(){var t=this.Lf.path.h();return t.m()?null:new Xu(new S(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,\"path\",{get:function(){return this.Lf.path.R()},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){R(\"CollectionReference.doc\",arguments,0,1),0===arguments.length&&(t=Y.k()),O(\"CollectionReference.doc\",\"non-empty string\",1,t);var e=A.P(t);return Xu.bf(this.Lf.path.child(e),this.firestore,this.I_)},e.prototype.add=function(t){k(\"CollectionReference.add\",arguments,1),O(\"CollectionReference.add\",\"object\",1,this.I_?this.I_.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},e.prototype.withConverter=function(t){return new e(this.Kf,this.firestore,t)},e}(ua);function ha(t,e){if(void 0===e)return{merge:!1};if(B(t,e,[\"merge\",\"mergeFields\"]),V(t,\"boolean\",\"merge\",e.merge),function(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires its \"+e+\" option to be an array, but it was: \"+j(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new f(h.INVALID_ARGUMENT,\"Function \"+t+\"() requires all \"+e+\" elements to be a string or a FieldPath, but the value at index \"+o+\" was: \"+j(r[o]))}(t,\"mergeFields\",0,r,(function(t){return\"string\"==typeof t||t instanceof hu}))}(t,0,0,e.mergeFields),void 0!==e.mergeFields&&void 0!==e.merge)throw new f(h.INVALID_ARGUMENT,\"Invalid options passed to function \"+t+'(): You cannot specify both \"merge\" and \"mergeFields\".');return e}function fa(t,e){return void 0===e?{}:(B(t,e,[\"serverTimestamps\"]),C(t,0,\"serverTimestamps\",e.serverTimestamps,[\"estimate\",\"previous\",\"none\"]),e)}function la(t,e){U(t,\"object\",1,e),e&&(B(t,e,[\"source\"]),C(t,0,\"source\",e.source,[\"default\",\"server\",\"cache\"]))}function pa(t,e,n){if(e instanceof Eu){if(e.firestore!==n)throw new f(h.INVALID_ARGUMENT,\"Provided document reference is from a different Firestore instance.\");return e}throw G(t,\"DocumentReference\",1,e)}function da(t){switch(t){case 0:return\"added\";case 2:case 3:return\"modified\";case 1:return\"removed\";default:return m()}}function va(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var ya={Firestore:Hu,GeoPoint:bu,Timestamp:ut,Blob:rt,Transaction:Yu,WriteBatch:$u,DocumentReference:Xu,DocumentSnapshot:Zu,Query:ua,QueryDocumentSnapshot:ta,QuerySnapshot:aa,CollectionReference:ca,FieldPath:hu,FieldValue:wu,setLogLevel:Hu.setLogLevel,CACHE_SIZE_UNLIMITED:Wu};function ga(t){!function(t,e){t.INTERNAL.registerComponent(new a.Component(\"firestore\",(function(t){return function(t,e){var n=new su,r=new ou(n);return new Hu(t,e,r,n)}(t.getProvider(\"app\").getImmediate(),t.getProvider(\"auth-internal\"))}),\"PUBLIC\").setServiceProps(Object.assign({},ya)))}(t),t.registerVersion(\"@firebase/firestore\",\"1.16.7\")}ga(c.default),e.__PRIVATE_registerFirestore=ga}).call(this,n(\"8oxB\"))}}]);","extractedComments":[]}